"use strict";(self.webpackChunk_deathbeds_jyg=self.webpackChunk_deathbeds_jyg||[]).push([[101],{494:(e,s,t)=>{t.d(s,{W:()=>r});var n=t(526),i=t(512);class r{constructor(e){this._client=null,this._ready=new n.PromiseDelegate,this.onRequest=async(e,s)=>{let t;await this._ready,i.eM&&console.warn(i.Dd,"message received",e);let n=null;const{request_id:r,request_type:o}=e,a={request_id:r,request_type:o};switch(o){case"app_info":t=await this._remoteCommands.getAppInfo();break;case"run":try{t=await this._remoteCommands.run(e.content.id,e.content.args||{})}catch(e){n=e}break;default:return console.warn(i.Dd,"unexpected request",e),{}}try{n?await this.sendError({error:`${n}`,...a},s):await this.sendResponse({content:t,...a},s)}catch(e){await this.sendError({error:`multiple errors\n${e}\n${n}`,...a},s)}},this._remoteCommands=e.remoteCommands}async initialize(e){this._client=await this.initClient(e)}async initClient(e){return null}async sendError(e,s){}async sendResponse(e,s){}}},101:(e,s,t)=>{t.r(s),t.d(s,{WindowProxyCommandSource:()=>r});var n=t(512),i=t(494);class r extends i.W{constructor(){super(...arguments),this._sources=[],this._listening=!1,this._settings=null,this.onSourceMessage=async e=>{if(!this.composite.enabled)return void this.unlisten();const{source:s,origin:t}=e,n=this.isAllowedSource(s,t);n&&this.onRequest(JSON.parse(e.data),n).catch(this.onError)}}async initClient(e){return await e.appReady,null}set settings(e){if(this._settings)throw new Error("already has settings");this._settings=e,e.changed.connect(this.onSettingsChanged,this),this.onSettingsChanged()}onSettingsChanged(){var e;(null===(e=this._settings)||void 0===e?void 0:e.composite.enabled)&&this._listening&&this.unlisten()}listen(){this.composite.enabled&&(window.addEventListener("message",this.onSourceMessage),this._listening=!0)}unlisten(){window.removeEventListener("message",this.onSourceMessage),this._listening=!1,this._sources=[]}addSource(e,s){const t=this.isAllowedSource(e,s);t&&(this._sources.push(t),this._listening||this.listen())}removeSource(e){const s=this._sources.indexOf(e);-1!=s&&(this._sources=this._sources.splice(s,1)),this._sources.length||this.unlisten()}get composite(){var e;return(null===(e=this._settings)||void 0===e?void 0:e.composite)||{}}isAllowedSource(e,s){if(!this.composite.enabled||!e)return null;const{composite:t}=this;return t.allow_same_origin&&s==window.origin||t.allowed_origins&&t.allowed_origins.includes(s)?e:null}async sendResponse(e,s){s.postMessage(JSON.stringify(e))}async sendError(e,s){s.postMessage(JSON.stringify(e))}async onError(e){console.error(n.Dd,"encountered an error",e)}}}}]);
//# sourceMappingURL=101.b2c924609222a0be860f.js.map?v=b2c924609222a0be860f
"use strict";(self.webpackChunk_deathbeds_jyg=self.webpackChunk_deathbeds_jyg||[]).push([[523],{494:(e,s,t)=>{t.d(s,{W:()=>o});var n=t(526),r=t(512);class o{constructor(e){this._client=null,this._ready=new n.PromiseDelegate,this.onRequest=async(e,s)=>{let t;await this._ready,r.eM&&console.warn(r.Dd,"message received",e);let n=null;const{request_id:o,request_type:a}=e,i={request_id:o,request_type:a};switch(a){case"app_info":t=await this._remoteCommands.getAppInfo();break;case"run":try{t=await this._remoteCommands.run(e.content.id,e.content.args||{})}catch(e){n=e}break;default:return console.warn(r.Dd,"unexpected request",e),{}}try{n?await this.sendError({error:`${n}`,...i},s):await this.sendResponse({content:t,...i},s)}catch(e){await this.sendError({error:`multiple errors\n${e}\n${n}`,...i},s)}},this._remoteCommands=e.remoteCommands}async initialize(e){this._client=await this.initClient(e)}async initClient(e){return null}async sendError(e,s){}async sendResponse(e,s){}}},523:(e,s,t)=>{t.r(s),t.d(s,{API_URL:()=>i,WS_URL:()=>c,WebSocketCommandSource:()=>d});var n=t(671),r=t(526),o=t(512),a=t(494);const i=n.URLExt.join(n.PageConfig.getBaseUrl(),"jyg"),c=n.URLExt.join(i,"ws").replace(/^http/,"ws");class d extends a.W{constructor(){super(...arguments),this._ready=new r.PromiseDelegate,this.onMessage=async e=>{this.onRequest(JSON.parse(e.data),this._client).catch(this.onError)},this.onClose=async e=>{console.warn(o.Dd,"websocket was closed",e)},this.onError=async e=>{console.error(o.Dd,"encountered a websocket error",e)}}async initClient(e){const s=new e.serverSettings.WebSocket(c);return s.onopen=()=>this._ready.resolve(),s.onmessage=this.onMessage,s.onclose=this.onClose,s.onerror=this.onError,s}async sendResponse(e){this._client.send(JSON.stringify(e))}async sendError(e){this._client.send(JSON.stringify(e))}}}}]);
//# sourceMappingURL=523.2dab2023938142042ed6.js.map?v=2dab2023938142042ed6
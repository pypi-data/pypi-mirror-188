# tox (https://tox.readthedocs.io/) is a tool for running tests
# in multiple virtualenvs. This configuration file will run the
# test suite on all supported python versions. To use it, "pip install tox"
# and then run "tox" from this directory.

[tox]
envlist = tests-py{37,38,39}-{nix,win},nbmake
minversion = 3.7
skipsdist = true
skip_install = true

[testenv:git_hub_nbmake]
recreate = false
passenv = DESKTOP_APP_KEY EDP_USERNAME EDP_PASSWORD DEPLOYED_PLATFORM_HOST DEPLOYED_PLATFORM_USER_NAME RDP_USERNAME RDP_PASSWORD
deps =
    asyncio
    nbmake
    pytest
    pytest-xdist
    python-dotenv
changedir = ./Example.DataLibrary.Python
commands =
    - python -m pip install ../../
    - python -m pytest --nbmake --nbmake-kernel=python3 --ignore="Examples/5-Eikon Data API/" --nbmake-timeout=300 -n=2 "./"

[testenv:post_release_check_on_bams]
recreate = false
passenv = DESKTOP_APP_KEY EDP_USERNAME EDP_PASSWORD DEPLOYED_PLATFORM_HOST DEPLOYED_PLATFORM_USER_NAME RDP_USERNAME RDP_PASSWORD
deps =
    asyncio
    nbmake
    pytest
    pytest-xdist
    python-dotenv
changedir = ./Example.DataLibrary.Python
commands =
    - python -m pip install --extra-index-url https://{env:USERNAME}:{env:PASSWORD}@bams-aws.refinitiv.com/artifactory/api/pypi/default.pypi.cloud/simple refinitiv-data=={env:RD_VERSION}
    - python -m pytest --nbmake --nbmake-kernel=python3 --ignore="Examples/5-Eikon Data API/" --nbmake-timeout=300 -n=2 "./"

[testenv:post_release_check]
recreate = false
passenv = DESKTOP_APP_KEY EDP_USERNAME EDP_PASSWORD DEPLOYED_PLATFORM_HOST DEPLOYED_PLATFORM_USER_NAME RDP_USERNAME RDP_PASSWORD
deps =
    asyncio
    nbmake
    pytest
    pytest-xdist
    python-dotenv
changedir = ./Example.DataLibrary.Python
commands =
    - python -m pip install refinitiv-data
    - python -m pytest --nbmake --nbmake-kernel=python3 --ignore="Examples/5-Eikon Data API/" --nbmake-timeout=300 -n=2 "./"
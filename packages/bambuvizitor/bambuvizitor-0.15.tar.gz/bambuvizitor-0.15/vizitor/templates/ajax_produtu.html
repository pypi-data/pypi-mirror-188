{% load i18n%}
<style>
       .bounceInRight {
  -webkit-animation-name: bounceInRight;
  animation-name: bounceInRight;
  -webkit-animation-duration: 1s;
  animation-duration: 1s;
  -webkit-animation-fill-mode: both;
  animation-fill-mode: both;
  }
  @-webkit-keyframes bounceInRight {
  0%, 60%, 75%, 90%, 100% {
  -webkit-transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
  transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
  }
  0% {
  opacity: 0;
  -webkit-transform: translate3d(3000px, 0, 0);
  transform: translate3d(3000px, 0, 0);
  }
  60% {
  opacity: 1;
  -webkit-transform: translate3d(-25px, 0, 0);
  transform: translate3d(-25px, 0, 0);
  }
  75% {
  -webkit-transform: translate3d(10px, 0, 0);
  transform: translate3d(10px, 0, 0);
  }
  90% {
  -webkit-transform: translate3d(-5px, 0, 0);
  transform: translate3d(-5px, 0, 0);
  }
  100% {
  -webkit-transform: none;
  transform: none;
  }
  }
  @keyframes bounceInRight {
  0%, 60%, 75%, 90%, 100% {
  -webkit-transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
  transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
  }
  0% {
  opacity: 0;
  -webkit-transform: translate3d(3000px, 0, 0);
  transform: translate3d(3000px, 0, 0);
  }
  60% {
  opacity: 1;
  -webkit-transform: translate3d(-25px, 0, 0);
  transform: translate3d(-25px, 0, 0);
  }
  75% {
  -webkit-transform: translate3d(10px, 0, 0);
  transform: translate3d(10px, 0, 0);
  }
  90% {
  -webkit-transform: translate3d(-5px, 0, 0);
  transform: translate3d(-5px, 0, 0);
  }
  100% {
  -webkit-transform: none;
  transform: none;
  }
  } 
</style>


<div class="row bounceInRight ">
  <center><h1>{{titulu}} </h1></center>
<br>

    {% for xxx in produtu %}




    <div class="col-md-3" >
              <div class="service-widget" style='
              box-shadow: 2px 2px 10px #dddddd;
               margin:7px;'>
               <br>
                         
               <h4>  <center><b> {{xxx.titulu}} </b></center></h4>
                              

                                <a href='#' data-toggle='modal' data-id="{{xxx.produtu.id}}" id='butaun_modal_detallu'  data-target= '#modal_detallu' >
                                <div class="post-media " style="visibility: visible;">
                                    <img src="{{xxx.produtu.imagen_main.url}}" style="width:100%; height: 200px;  object-fit: cover;" alt="" class="img-responsive img-rounded">
                                </div>
                                <div class="service-dit">
                                  <center>
                                  
                                <h2> <b>     $ {{xxx.produtu.presu}} </b></h2>
                              
                              </a>
                              {% if user.is_authenticated %}

                              <button   data-toggle='modal' data-idprodutu="{{xxx.produtu.id}}"  data-tituluprodutu="{{xxx.titulu}}" id='butaun_modal_detallu'  data-target= '#modal_addorder' style='width:100%' class="btn btn-outline-primary btn-block">
                                Aumenta Ba Lista 
                                <i class="fa fa-shopping-basket" aria-hidden="true"></i>
                              </button>
                           
    {% endif %}
                            </center>
                              </div>
                         </div>
                     </div>
  
      {% endfor %}
      


  
  
    
                 
                </div>






                <div class="modal  fade" tabindex="-1" id="modal_addorder" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-sm " role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                     
                   
                        Order Produtu
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                        
                      <div class="modal-body">
                       

                        <div>
                          <form action="" method="">

                            <center><h3>Aumenta <span id="prodututituluorder"> </span> Ba Iha Lista Order</h3></center>
                            <hr>
                           <label id=""> Total Oder </label> <input  id = 'total_order' type="number" class="form-control">
                           <input  id = 'idprodutulistaorder' value="" type="hidden" class="form-control">
                           <input  id = 'tituluprodutulistaorder' value="" type="hidden" class="form-control">
                           <br>
                         
                      

                           <button id="submitbalistaorder" style="width: 100%;" type="button" class="btn btn-primary" data-dismiss="modal" aria-label="Close">
                            Aumenta Ba Lista Order 
                            <i class="fa fa-shopping-basket" data-dismiss="modal" aria-hidden="true"></i>
                          </button>

                       

                      
                          </form>
                        </div>
                
                          <!-- <div id="loadingprosses">
                            <center> <img src ='http://minio-s3.apps06.tic.gov.tl/bambumedia/pajina/loadingspiner.gif' style="width: 130px ;"></center> 
                            </div> -->
                      </div>
                
                    </div>
                  </div>
                </div>
                </div>





                <script>




                  // localStorage.removeItem('listaorderca');



                  

// localStorage.setItem("seslistaorder", JSON.stringify(myObject));
                let listaorder = [];

                

                // const getCarStorage = localStorage.getItem('productsList')


                $(document).ready(function(){


                  function loadajaxlistaorder(){
                



                // var element = document.getElementById("butaun_modal_detallu");
                // element.classList.add("btn btn-primary bounce");

                

                var id =  document.getElementById('idprodutulistaorder').value;
                var titulu =  document.getElementById('tituluprodutulistaorder').value;
                var total =  document.getElementById('total_order').value;

                const obj = {'id': parseInt(id) , 'titulu' : titulu  , 'total' : total };
                // listaorder.push(obj);

                const getlistaorderca = localStorage.getItem('listaorderca')

   

                if(getlistaorderca){
                  listaorder = JSON.parse(localStorage.getItem('listaorderca'))
                  listaorder.push(obj)
                  localStorage.setItem('listaorderca', JSON.stringify(listaorder))
                  console.log("----------------")
                  console.log(listaorder)
                }else{
                  listaorder.push(obj)
                  localStorage.setItem('listaorderca', JSON.stringify(listaorder))
                }
                // console.log();
                // console.log(listaorder);

                var dadosid ='mamuk';
                for (var i = 0; i < listaorder.length; i++) {
                    dadosid +=  "," +listaorder[i]['id']+'-'+listaorder[i]['total'];
      
                }





                // console.log(listaorder);



  



  
                $.ajax({
                  type : 'POST',
                  url : "{% url 'vizitor:listaorderprodutu' %}",
                  data :  {
                     'dadosid' : dadosid, 
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                  },
                  success : function(data){
          
                  $('.listaorderload').html(data);
                  $("#total_order").val('');//menampilkan data ke dalam modal
                  }
              });


              $.ajax({
                  type : 'POST',
                  url : "{% url 'vizitor:detalluprodutu2button' %}",
                  data :  {
                     'dadosid' : dadosid, 
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                  },
                  success : function(data){
                  $('.buttonlistaorderload').html(data);
                  }
              });






               };



         

    

              

                  $('#modal_addorder').on('show.bs.modal', function (e) {


                  var rowid = $(e.relatedTarget).data('idprodutu');
                  var rowtitulu = $(e.relatedTarget).data('tituluprodutu');


                  $("#prodututituluorder").text(rowtitulu);
                  $("#idprodutulistaorder").val(rowid);
                  $("#tituluprodutulistaorder").val(rowtitulu);
                  
                  // alert(rowid);
                  // alert(rowtitulu)

    
               });

               $('#submitbalistaorder').on('click', function() {





                loadajaxlistaorder();
     




                
               });



        

               
          });


// cek produtu iha lista order  temporario iha ka laiha

function ceklistaorder(){


          const cekgetlistaorderca = localStorage.getItem('listaorderca')
      if(cekgetlistaorderca){
        ceklistaorder = JSON.parse(localStorage.getItem('listaorderca'))
        if (ceklistaorder.length > 0){

          var dadosid ='mamuk';
                for (var i = 0; i < ceklistaorder.length; i++) {
                    dadosid +=  "," +ceklistaorder[i]['id']+'-'+ceklistaorder[i]['total'];
      
                }




            $.ajax({
              type : 'POST',
              url : "{% url 'vizitor:listaorderprodutu' %}",
              data :  {
                  'dadosid' : dadosid, 
                'csrfmiddlewaretoken': '{{ csrf_token }}',
              },
              success : function(data){
      
              $('.listaorderload').html(data);
              $("#total_order").val('');//menampilkan data ke dalam modal
              }
          });



          $.ajax({
                  type : 'POST',
                  url : "{% url 'vizitor:detalluprodutu2button' %}",
                  data :  {
                    'dadosid' : dadosid, 
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                  },
                  success : function(data){
                  $('.buttonlistaorderload').html(data);
                  }
              });





      //  alert("iha")

        }else{
          $.ajax({
                  type : 'POST',
                  url : "{% url 'vizitor:detalluprodutu2button' %}",
                  data :  {
                    'dadosid' : "daduslaiha", 
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                  },
                  success : function(data){
                  $('.buttonlistaorderload').html(data);
                  }
              });
        }
      }else{
        $.ajax({
                  type : 'POST',
                  url : "{% url 'vizitor:detalluprodutu2button' %}",
                  data :  {
                    'dadosid' : "daduslaiha", 
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                  },
                  success : function(data){
                  $('.buttonlistaorderload').html(data);
                  }
              });
      }
}


ceklistaorder();
    
                </script>
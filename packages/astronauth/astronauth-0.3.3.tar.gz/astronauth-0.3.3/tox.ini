[tox]
# Generative environment list to test all supported Python versions
envlist = py3{6,7,8,9,10},black,pep8,pylint
minversion = 3.18.0
# Source distributions are explicitly build using tox -e build
skipsdist = True

[testenv]
usedevelop = True
setenv =
    LANGUAGE=en_US
    LC_ALL=en_US.UTF-8
    PYTHONWARNINGS=default::DeprecationWarning
deps =
    -r{toxinidir}/requirements.txt
    -r{toxinidir}/ci/requirements.txt
commands =
    {envpython} --version
    {envpython} manage.py test

[testenv:coverage]
commands =
    {envpython} --version
    {envpython} -m coverage run --omit=manage.py,tests/*,integration/* manage.py test astronauth
    {envpython} -m coverage report
    {envpython} -m coverage xml

# Use generative name and command prefixes to reuse the same virtualenv
# for all linting jobs.
[testenv:{pep8,black,pylint,format}]
usedevelop = False
envdir = {toxworkdir}/linting
commands =
    pep8: {envpython} -m flake8 --version
    pep8: {envpython} -m flake8 --extend-exclude './.venv/','./venv/'
    black: {envpython} -m black --version
    black: {envpython} -m black --check --diff .
    pylint: {envpython} -m pylint --version
    pylint: {envpython} -m pylint astronauth integration
    format: {envpython} -m autopep8 -v -aa --in-place --recursive astronauth
    format: {envpython} -m autopep8 -v -aa --in-place --recursive integration
    format: {envpython} -m black -v .

[testenv:build]
usedevelop = False
commands = {envpython} -m build

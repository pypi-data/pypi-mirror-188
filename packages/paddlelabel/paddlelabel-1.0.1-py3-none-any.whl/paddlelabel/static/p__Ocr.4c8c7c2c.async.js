(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[473],{16850:function(ke){ke.exports={conTent:"conTent___3tIpi","editable-cell":"editable-cell___29ByY","ant-table-content":"ant-table-content___371_P","ant-table-thead":"ant-table-thead___3SC5q","editable-cell-value-wrap":"editable-cell-value-wrap___1Ducl","editable-row":"editable-row___2d-EK"}},92086:function(ke){ke.exports={det:"det___1LaWK",mainStage:"mainStage___D5D-c",draw:"draw___15iZW",pblock:"pblock___B0IOl",progress:"progress___2-yD3",rightSideBar:"rightSideBar___34VZw",determinOutline:"determinOutline___2F44n",titles:"titles___1n-ow",tableConent:"tableConent___RT4LO","ant-table-wrapper":"ant-table-wrapper___2B8ou"}},44887:function(){},93181:function(ke,De,t){"use strict";t.d(De,{Z:function(){return L}});var xe=t(91220),A=t(11849),j=t(67294),ue=t(65031),We=t(57406);function te(e,N,g){if(!(!e||!N))if(g==="/optical_character_recognition"){var J=N.join("|"),a=J+"||\u5F85\u8BC6\u522B|0|";return a}else return N.join(",")}function p(e,N,g){var J,a,c=e.annotation;if(!c||!c.result||c.result.length<2||!((J=c.label)!==null&&J!==void 0&&J.color))return j.createElement(j.Fragment,null);var C=c.result.split(",").map(Number);console.log("points",C.length);var I=c.label.color,X=(0,We.oo)(I);if(!X)return j.createElement(j.Fragment,null);var k=((a=e.currentAnnotation)===null||a===void 0?void 0:a.frontendId)==c.frontendId,$=k?.5:.2,u=void 0,d=[];return C.forEach(function(h,D){if(D%2==0){u=h;return}d.push(j.createElement(ue.Cd,{onMouseDown:function(){e.currentTool=="editor"&&e.onSelect(c)},draggable:e.currentTool=="editor",onDragEnd:function(P){var y;P.cancelBubble=!0;var ae=(y=e.stageRef)===null||y===void 0?void 0:y.current,w=ae.findOne(".baseImage"),re=!1,de=P.target.x();de>w.width()/2&&(de=w.width()/2,re=!0),de<-w.width()/2&&(de=-w.width()/2,re=!0);var Pe=P.target.y();if(Pe>w.height()/2&&(Pe=w.height()/2,re=!0),Pe<-w.height()/2&&(Pe=-w.height()/2,re=!0),re&&P.target.setPosition({x:de,y:Pe}),C[D-1]=de,C[D]=Pe,e.pathName==="/optical_character_recognition"){var Ue=g?"||".concat(g,"|0|"):"||\u5F85\u8BC6\u522B|0|",Ze=C.join("|")+Ue,Be=(0,A.Z)((0,A.Z)({},c),{},{result:Ze});e.onDragUP(Be)}else{var he=(0,A.Z)((0,A.Z)({},c),{},{result:C.join(",")});e.onDragUP(he)}},onMouseOver:function(){var P,y;e.currentTool=="editor"&&(P=e.stageRef)!==null&&P!==void 0&&P.current&&(e.stageRef.current.container().style.cursor="cell"),(y=e.layerRef.current)===null||y===void 0||y.batchDraw()},onMouseOut:function(){var P;(P=e.stageRef)!==null&&P!==void 0&&P.current&&(e.stageRef.current.container().style.cursor="default")},x:u,y:h,radius:5/e.scale,fill:I})),u=void 0}),j.createElement(ue.ZA,{key:c.frontendId,onClick:function(){(e.currentTool==="editor"||e.currentTool==="mover")&&e.onSelect(c)}},j.createElement(ue.x1,{onMouseOver:function(){e.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},stroke:I,strokeWidth:2/e.scale,globalCompositeOperation:"source-over",lineCap:"round",points:C,tension:0,closed:N,fill:"rgba(".concat(X.r,", ").concat(X.g,", ").concat(X.b,", ").concat($,")")}),d)}function G(e){var N=0;if(!e)return N;var g=(0,xe.Z)(e),J;try{for(g.s();!(J=g.n()).done;){var a=J.value;!a||!a.frontendId||a.frontendId>N&&(N=a.frontendId)}}catch(c){g.e(c)}finally{g.f()}return N}function L(e){var N=function(I,X,k,$,u){var d,h,D=te((d=e.currentLabel)===null||d===void 0?void 0:d.color,[I,X],$);if(!!D){var b={dataId:e.dataId,frontendId:(k==null?void 0:k.frontendId)!==void 0?k==null?void 0:k.frontendId:G(u)+1,label:e.currentLabel,labelId:(h=e.currentLabel)===null||h===void 0?void 0:h.labelId,result:D,type:""};$==="/optical_character_recognition"?(b.type="ocr_polygon",b.frontendId=G(u)+1):b.type="polygon",e.onAnnotationAdd(b)}},g=function(I,X,k){var $;if(!(!e.currentAnnotation||!e.currentAnnotation.result||!(($=e.currentLabel)!==null&&$!==void 0&&$.color))){var u="";if(k==="/optical_character_recognition"){var d,h=(d=e.currentAnnotation.result)===null||d===void 0?void 0:d.split("||"),D=h[0]+"|".concat(I,"|").concat(X);u=D+"||"+h[1]}else u=e.currentAnnotation.result+",".concat(I,",").concat(X);var b=(0,A.Z)((0,A.Z)({},e.currentAnnotation),{},{result:u});e.onAnnotationModify(b)}},J=function(I){if(e.currentTool=="polygon"){var X=I.mouseX+I.offsetX,k=I.mouseY+I.offsetY;!e.currentAnnotation&&I.flags?N(X,k,e.selectFinly,I.pathName,e.annotations):g(X,k,I.pathName),e.onMouseDown&&e.onMouseDown()}},a=function(){},c=function(I){e.currentTool=="polygon"&&I.e.evt.button!==2&&e.onMouseUp&&e.onMouseUp()};return{onMouseDown:J,onMouseMove:a,onMouseUp:c,drawAnnotation:p}}},59519:function(ke,De,t){"use strict";t.d(De,{Z:function(){return J}});var xe=t(11849),A=t(67294),j=t(65031),ue=t(57406);function We(a){if(!(!a||a.length<2))return a.join(",")}var te={x:0,y:0},p={x:0,y:0},G=!1;function L(a,c,C){console.log("drawGuidewires\u51FD\u6570\u6267\u884C\u4E86"),C.save(),C.strokeStyle="rgba(0,0,230,0.9)",C.lineWidth=.8,N(a,C),e(c,C),C.restore()}function e(a,c){c.beginPath(),c.moveTo(0,a+.5),c.lineTo(c.canvas.width,a+.5),c.stroke()}function N(a,c){c.beginPath(),c.moveTo(a+.5,0),c.lineTo(a+.5,c.canvas.height),c.stroke()}function g(a){var c,C=0;if(a.annotation.type=="ocr_rectangle"){var I,X=(I=a.annotation.result)===null||I===void 0?void 0:I.split("||")[0],k=X&&X.split("|").join(",");C=k==null?void 0:k.split(",").length}else{var $,u;C=a==null||($=a.annotation)===null||$===void 0||(u=$.result)===null||u===void 0?void 0:u.split(",").length}if(C&&C<4)return A.createElement(A.Fragment,null);var d=a.annotation;if(!d||!d.result||!d.label||!d.label.color||!d.annotationId)return A.createElement(A.Fragment,null);var h=[];if(d.type=="ocr_rectangle"){var D,b=(D=d.result)===null||D===void 0?void 0:D.split("||")[0],P=b&&b.split("|").join(",");h=P.split(",")}else h=d.result.split(",");var y={xmin:parseInt(h[0]),ymin:parseInt(h[1]),xmax:h.length>=3?parseInt(h[2]):void 0,ymax:h.length>=4?parseInt(h[3]):void 0},ae=d.label.color,w=(0,ue.oo)(ae);if(!w)return A.createElement(A.Fragment,null);var re=((c=a.currentAnnotation)===null||c===void 0?void 0:c.frontendId)==d.frontendId,de=re?.5:.2,Pe=y.xmax!=null&&y.ymax!=null?A.createElement(j.UL,{onMouseOver:function(){a.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){(a.currentTool==="editor"||a.currentTool==="mover")&&a.onSelect(d)},stroke:ae,strokeWidth:2/a.scale,globalCompositeOperation:"source-over",lineCap:"round",x:y.xmin,y:y.ymin,width:y.xmax-y.xmin,height:y.ymax-y.ymin,closed:!0,fill:"rgba(".concat(w.r,", ").concat(w.g,", ").concat(w.b,", ").concat(de,")")}):A.createElement(A.Fragment,null);function Ue(Ze){return!Ze&&(y.xmax==null||y.ymax==null)?A.createElement(A.Fragment,null):A.createElement(j.Cd,{onMouseDown:function(){a.currentTool=="editor"&&a.onSelect(d)},onMouseOver:function(){var he;a.currentTool=="editor"&&(he=a.stageRef)!==null&&he!==void 0&&he.current&&(a.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var he;(he=a.stageRef)!==null&&he!==void 0&&he.current&&(a.stageRef.current.container().style.cursor="default")},x:Ze?y.xmin:y.xmax,y:Ze?y.ymin:y.ymax,radius:5/a.scale,fill:ae})}return A.createElement(j.ZA,{key:d.annotationId},Pe,Ue(!0),Ue(!1))}function J(a){var c=function(u,d,h){var D,b=We([u,d]);if(!(!b||!a.dataId)){var P={dataId:a.dataId,type:"rectangle",frontendId:(0,ue.pL)(a.annotations)+1,label:a.currentLabel,labelId:(D=a.currentLabel)===null||D===void 0?void 0:D.labelId};if(h==="/optical_character_recognition"){var y=b.split(",").join("|"),ae=y+"||\u5F85\u8BC6\u522B|0|";P.result=ae,P.type="ocr_rectangle"}else P.result=b;a.onAnnotationAdd(P)}},C=function(u,d,h){var D;if(!(!a.currentAnnotation||!a.currentAnnotation.result||!((D=a.currentLabel)!==null&&D!==void 0&&D.color))){var b="";if(h==="/optical_character_recognition"){var P,y=(P=a.currentAnnotation.result)===null||P===void 0?void 0:P.split("||"),ae=y&&y[0].split("|");if(ae.length<4)b=ae.join("|")+"|".concat(u,"|").concat(d)+"||"+y[1];else{var w=ae;w[2]=u+"",w[3]=d+"",b=w.join("|")+"||"+y[1]}}else if(a.currentAnnotation.result.length<4)b=a.currentAnnotation.result+",".concat(u,",").concat(d);else{var re=a.currentAnnotation.result.split(",");re[2]=u+"",re[3]=d+"",b=re.join(",")}var de=(0,xe.Z)((0,xe.Z)({},a.currentAnnotation),{},{result:b});a.onAnnotationModify(de),a.onMouseUp&&a.onMouseUp()}},I=function(u){if(a.currentTool==="rectangle"||a.currentTool==="editor"){G=!0;var d=u.mouseX+u.offsetX,h=u.mouseY+u.offsetY;te.x=u.mouseX,te.y=u.mouseY,a.currentAnnotation||c(d,h,u.pathName),a.onMouseDown&&a.onMouseDown()}},X=function(u){a.currentTool!="rectangle"&&G!==!0||(p.x=u.mouseX,p.y=u.mouseY)},k=function(u){if(!(a.currentTool!="rectangle"&&a.currentTool!="editor"&&G)){G=!1;var d=u.mouseX+u.offsetX,h=u.mouseY+u.offsetY;C(d,h,u==null?void 0:u.pathName)}};return{onMouseDown:I,onMouseMove:X,onMouseUp:k,drawAnnotation:g,drawGuidewires:L}}},11151:function(ke,De,t){"use strict";t.r(De),t.d(De,{default:function(){return Vn}});var xe=t(20228),A=t(11382),j=t(39428),ue=t(3182),We=t(34792),te=t(48086),p=t(11849),G=t(91220),L=t(2824),e=t(67294),N=t(51505),g=t(48971),J=t(92086),a=t.n(J),c=t(19466),C=t(93926),I=t(86582),X=t(38663),k=t(57663),$=t(20136),u=t(44887),d=t(22122),h=t(28481),D=t(47918),b=t(94184),P=t.n(b),y=t(21770),ae=t(15105),w=t(53124),re=t(55241),de=t(96159),Pe=t(71577),Ue=t(93887),Ze=t(86743),Be=t(42051),he=t(5767),mn=t(81643),gn=function(l){var x=l.prefixCls,Z=l.okButtonProps,R=l.cancelButtonProps,U=l.title,F=l.cancelText,ye=l.okText,Q=l.okType,Ce=l.icon,Y=l.showCancel,se=Y===void 0?!0:Y,Se=l.close,Ee=l.onConfirm,ve=l.onCancel,Ie=e.useContext(w.E_),be=Ie.getPrefixCls;return e.createElement(Be.Z,{componentName:"Popconfirm",defaultLocale:he.Z.Popconfirm},function(m){return e.createElement("div",{className:"".concat(x,"-inner-content")},e.createElement("div",{className:"".concat(x,"-message")},Ce&&e.createElement("span",{className:"".concat(x,"-message-icon")},Ce),e.createElement("div",{className:"".concat(x,"-message-title")},(0,mn.Z)(U))),e.createElement("div",{className:"".concat(x,"-buttons")},se&&e.createElement(Pe.Z,(0,d.Z)({onClick:ve,size:"small"},R),F!=null?F:m.cancelText),e.createElement(Ze.Z,{buttonProps:(0,d.Z)((0,d.Z)({size:"small"},(0,Ue.n)(Q)),Z),actionFn:Ee,close:Se,prefixCls:be("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},ye!=null?ye:m.okText)))})},_e=void 0,hn=function(s,l){var x={};for(var Z in s)Object.prototype.hasOwnProperty.call(s,Z)&&l.indexOf(Z)<0&&(x[Z]=s[Z]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var R=0,Z=Object.getOwnPropertySymbols(s);R<Z.length;R++)l.indexOf(Z[R])<0&&Object.prototype.propertyIsEnumerable.call(s,Z[R])&&(x[Z[R]]=s[Z[R]]);return x},yn=e.forwardRef(function(s,l){var x=e.useContext(w.E_),Z=x.getPrefixCls,R=(0,y.Z)(!1,{value:s.open!==void 0?s.open:s.visible,defaultValue:s.defaultOpen!==void 0?s.defaultOpen:s.defaultVisible}),U=(0,h.Z)(R,2),F=U[0],ye=U[1],Q=function(B,W){var q,Ve;ye(B,!0),(q=s.onVisibleChange)===null||q===void 0||q.call(s,B,W),(Ve=s.onOpenChange)===null||Ve===void 0||Ve.call(s,B,W)},Ce=function(B){Q(!1,B)},Y=function(B){var W;return(W=s.onConfirm)===null||W===void 0?void 0:W.call(_e,B)},se=function(B){var W;Q(!1,B),(W=s.onCancel)===null||W===void 0||W.call(_e,B)},Se=function(B){B.keyCode===ae.Z.ESC&&F&&Q(!1,B)},Ee=function(B){var W=s.disabled,q=W===void 0?!1:W;q||Q(B)},ve=s.prefixCls,Ie=s.placement,be=Ie===void 0?"top":Ie,m=s.trigger,v=m===void 0?"click":m,O=s.okType,M=O===void 0?"primary":O,fe=s.icon,K=fe===void 0?e.createElement(D.Z,null):fe,oe=s.children,Re=s.overlayClassName,ze=hn(s,["prefixCls","placement","trigger","okType","icon","children","overlayClassName"]),je=Z("popover",ve),He=Z("popconfirm",ve),Le=P()(He,Re);return e.createElement(re.Z,(0,d.Z)({},ze,{trigger:v,prefixCls:je,placement:be,onOpenChange:Ee,open:F,ref:l,overlayClassName:Le,_overlay:e.createElement(gn,(0,d.Z)({okType:M,icon:K},s,{prefixCls:je,close:Ce,onConfirm:Y,onCancel:se}))}),(0,de.Tm)(oe,{onKeyDown:function(B){var W,q;e.isValidElement(oe)&&((q=oe==null?void 0:(W=oe.props).onKeyDown)===null||q===void 0||q.call(W,B)),Se(B)}}))}),Cn=yn,ut=t(47673),En=t(35920),In=t(32059),dt=t(9715),Je=t(96709),en=t(93224),nn=t(28991),bn=t(51213),Pn=t(47699),tn=function(l,x){return e.createElement(Pn.Z,(0,nn.Z)((0,nn.Z)({},l),{},{ref:x,icon:bn.Z}))};tn.displayName="CloseCircleOutlined";var Zn=e.forwardRef(tn),Sn=t(16850),An=t.n(Sn),On=["index"],Mn=["title","editable","children","dataIndex","record","handleSave"],an=e.createContext(null),Tn=function(l){var x=l.index,Z=(0,en.Z)(l,On),R=Je.Z.useForm(),U=(0,L.Z)(R,1),F=U[0];return e.createElement(Je.Z,{form:F,component:!1},e.createElement(an.Provider,{value:F},e.createElement("tr",Z)))},Dn=function(l){var x=l.title,Z=l.editable,R=l.children,U=l.dataIndex,F=l.record,ye=l.handleSave,Q=(0,en.Z)(l,Mn),Ce=(0,e.useState)(!1),Y=(0,L.Z)(Ce,2),se=Y[0],Se=Y[1],Ee=(0,e.useRef)(null),ve=(0,e.useContext)(an);(0,e.useEffect)(function(){se&&Ee.current.focus()},[se]);var Ie=function(){Se(!se),ve.setFieldsValue((0,In.Z)({},U,F[U]))},be=function(){var v=(0,ue.Z)((0,j.Z)().mark(function O(){var M;return(0,j.Z)().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.prev=0,K.next=3,ve.validateFields();case 3:M=K.sent,Ie(),ye((0,p.Z)((0,p.Z)({},F),M)),K.next=10;break;case 8:K.prev=8,K.t0=K.catch(0);case 10:case"end":return K.stop()}},O,null,[[0,8]])}));return function(){return v.apply(this,arguments)}}(),m=R;return Z&&(m=se?e.createElement(Je.Z.Item,{style:{margin:0},name:U,rules:[{required:!0,message:"".concat(x," is required.")}]},e.createElement(En.Z,{ref:Ee,onPressEnter:be,onBlur:be})):e.createElement("div",{className:"editable-cell-value-wrap",style:{paddingRight:24},onClick:Ie},R)),e.createElement("td",Q,m)},xn=function(l,x){var Z=(0,e.useState)([]),R=(0,L.Z)(Z,2),U=R[0],F=R[1],ye=(0,e.useState)([]),Q=(0,L.Z)(ye,2),Ce=Q[0],Y=Q[1];(0,e.useEffect)(function(){if(!!l.annotations){var m=l.annotations.map(function(v){var O,M=v.result&&((O=v.result)===null||O===void 0?void 0:O.split("||")),fe=M&&M[1].split("|")[0];return(0,p.Z)({key:v==null?void 0:v.annotationId,address:fe},v)});F(m)}},[l.annotations]),(0,e.useEffect)(function(){var m;if(l.currentAnnotation&&(m=l.currentAnnotation)!==null&&m!==void 0&&m.annotationId){var v;Y([(v=l.currentAnnotation)===null||v===void 0?void 0:v.annotationId])}},[l.currentAnnotation]);var se=function(v){var O=U[U.findIndex(function(M){return M.key===v})];l.onAnnotationDelete(O)},Se=[{title:"",dataIndex:"address",render:function(v){return e.createElement("div",{style:{whiteSpace:"nowrap"}},v)},editable:!0},{title:"",dataIndex:"operation",render:function(v,O){return U.length>=1?e.createElement(Cn,{title:"Sure to delete?",onConfirm:function(){return se(O.key)}},e.createElement(Zn,null)):null}}],Ee=function(v){var O,M=v==null||(O=v.result)===null||O===void 0?void 0:O.split("||")[0],fe=M+"||"+v.address+"|0|",K=(0,p.Z)((0,p.Z)({},v),{},{result:fe});delete K.address,delete K.key,l.onAnnotationModify(K),l.updataAnno(K);var oe=(0,I.Z)(U),Re=oe.findIndex(function(je){return v.key===je.key}),ze=oe[Re];oe.splice(Re,1,(0,p.Z)((0,p.Z)({},ze),v)),F(oe)},ve={body:{row:Tn,cell:Dn}},Ie={onChange:function(v,O){var M=O[0];l.selectAnnotation(M)},getCheckboxProps:function(v){return{disabled:v.name==="Disabled User",name:v.name}}},be=Se.map(function(m){return m.editable?(0,p.Z)((0,p.Z)({},m),{},{onCell:function(O){return{record:O,editable:m.editable,dataIndex:m.dataIndex,title:m.title,handleSave:Ee}}}):m});return(0,e.useImperativeHandle)(x,function(){return{}}),e.createElement("div",{className:An().conTent,style:{overflow:"auto",height:"100%"}},e.createElement(C.Z,{rowSelection:(0,p.Z)((0,p.Z)({type:"radio"},Ie),{},{selectedRowKeys:Ce}),pagination:!1,components:ve,rowClassName:function(){return"editable-row"},bordered:!1,dataSource:U,columns:be}))},Rn=(0,e.forwardRef)(xn),Ln=t(8088),ce=t(61541),rn=t(44434),pn=t(57436),kn=t(84420),wn=t.n(kn),Un=t(28271),on=t(83721),Bn=t(59519),jn=t(93181),Nn=t(10137),Fn=t(36505),ln=t(27992),Kn=window.location.port=="8000"?"1234":window.location.port,Wn="http://".concat(window.location.hostname,":").concat(Kn,"/"),zn=function(){var l,x,Z,R,U,F,ye=(0,e.useState)(0),Q=(0,L.Z)(ye,2),Ce=Q[0],Y=Q[1],se=(0,e.useState)(!0),Se=(0,L.Z)(se,2),Ee=Se[0],ve=Se[1],Ie=(0,e.useState)(!0),be=(0,L.Z)(Ie,2),m=be[0],v=be[1],O=(0,g.tT)("InteractorData"),M=O.interactorData,fe=O.setInteractorData,K=(0,e.useState)(.8),oe=(0,L.Z)(K,2),Re=oe[0],ze=oe[1],je=(0,e.useState)(!1),He=(0,L.Z)(je,2),Le=He[0],Ae=He[1],B=(0,e.useState)(),W=(0,L.Z)(B,2),q=W[0],Ve=W[1],Xn=(0,e.useState)(!1),un=(0,L.Z)(Xn,2),$n=un[0],Qe=un[1],Yn=(0,e.useState)(60),dn=(0,L.Z)(Yn,2),cn=dn[0],Hn=dn[1],pe=(0,on.RZ)(e.useState,Wn),Oe=(0,e.useRef)(null),z=(0,Fn.I)("pages.toolBar"),Te=(0,on.$L)(e.useState,e.useEffect,{effectTrigger:{postTaskChange:function(n,o){we.init({annos:o})}},label:{oneHot:!0,postSelect:function(){r.setCurr(void 0),Y(0)},preUnsetCurr:qn},tool:{defaultTool:"mover"},task:{push:!1}}),le=Te.tool,Gn=Te.loading,Xe=Te.scale,r=Te.annotation,Ge=Te.task,V=Te.data,_=Te.project,Ne=Te.label,we=Te.annHistory,sn=(0,e.useRef)(V);sn.current=V;var Jn=wn()(V.imgSrc||"","anonymous"),Qn=(0,L.Z)(Jn,1),Fe=Qn[0];function qn(){r.setCurr(void 0),Y(0),le.setCurr("mover")}var ee=function(n){r.setCurr(n),n!=null&&n.frontendId?Y(n.frontendId):Y(0)},qe=function(n){var o=[];if(n.type==="ocr_polygon"){if(!n)return;var f=(0,G.Z)(r.all),S;try{for(f.s();!(S=f.n()).done;){var T=S.value;T.frontendId===n.frontendId?(o.push((0,p.Z)((0,p.Z)({},T),{},{result:n.result})),ee(n)):o.push(T)}}catch(Ye){f.e(Ye)}finally{f.f()}}else{var E=(0,G.Z)(r.all),ne;try{for(E.s();!(ne=E.n()).done;){var ie=ne.value,Me="";if(ie.frontendId===n.frontendId){var me,ge;if((g.m8===null||g.m8===void 0||(me=g.m8.location)===null||me===void 0?void 0:me.pathname)==="/optical_character_recognition"){var Ke;Me=n==null||(Ke=n.result)===null||Ke===void 0?void 0:Ke.split("||")[0].split("|").join(",")}else Me=n==null?void 0:n.result;var $e=(ge=Me)===null||ge===void 0?void 0:ge.split(",").map(function(Ye){return Number(Ye)}),H=($e[2]-$e[0])*($e[3]-$e[1]);Math.abs(H)>10&&(ie.result=n==null?void 0:n.result,ee(n),o.push(ie))}else o.push(ie)}}catch(Ye){E.e(Ye)}finally{E.f()}}r.setAll(o)},_n=function(n){var o=[],f=(0,G.Z)(r.all),S;try{for(f.s();!(S=f.n()).done;){var T=S.value;T.frontendId==n.frontendId?o.push(n):o.push(T)}}catch(E){f.e(E)}finally{f.f()}ee(n),r.setAll(o),r.update(n),te.default.success(z("saveSuccess"))},et=function(){ve(!0)},nt=function(){M.active||(we.record({annos:r.all,currAnno:r.curr}),ve(!1))},tt=function(){var i=(0,ue.Z)((0,j.Z)().mark(function n(){var o,f,S,T,E,ne,ie,Me,me,ge,Ke;return(0,j.Z)().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(we.record({annos:r.all,currAnno:r.curr}),r.curr){H.next=3;break}return H.abrupt("return");case 3:if(r.curr.result){H.next=5;break}return H.abrupt("return");case 5:if(r.curr.type!=="ocr_polygon"){H.next=8;break}H.next=24;break;case 8:if(S=r.all.length-1,T=r.all[S],E=T==null?void 0:T.result.split("||")[0],T&&(E==null?void 0:E.split("|").length)===2&&(ie=r==null||(ne=r.curr)===null||ne===void 0?void 0:ne.result,Me=ie.split("||")[0],me=E.split("|").concat(Me.split("|")),ge=me.join("|")+(T==null?void 0:T.result.split("||")[1]),r.curr.result=ge),Ke=r==null||(o=r.curr)===null||o===void 0?void 0:o.result.split("||")[0],!(Ke.length<3)){H.next=16;break}return ee(void 0),H.abrupt("return");case 16:if((r==null||(f=r.curr)===null||f===void 0?void 0:f.annotationId)!=null){H.next=21;break}return H.next=19,r.create(r==null?void 0:r.curr);case 19:H.next=22;break;case 21:r.update(r==null?void 0:r.curr);case 22:ee(void 0),te.default.success(z("saveSuccess"));case 24:case"end":return H.stop()}},n)}));return function(){return i.apply(this,arguments)}}(),vn={dataId:(l=V.curr)===null||l===void 0?void 0:l.dataId,currentLabel:Ne.all&&Ne.all[0],scale:Xe.curr,currentTool:le.curr,annotations:r.all,currentAnnotation:r.curr,onAnnotationAdd:function(n){ee(n);var o=r.all.concat([n]);r.setAll(o)},onAnnotationModify:qe,onMouseUp:nt,onMouseDown:et,frontendIdOps:{frontendId:Ce,setFrontendId:Y},pathName:g.m8===null||g.m8===void 0||(x=g.m8.location)===null||x===void 0?void 0:x.pathname},at=function(n){if(!n||n.length==0)return 0;var o=0,f=(0,G.Z)(n),S;try{for(f.s();!(S=f.n()).done;){var T=S.value;T.frontendId>o&&(o=T.frontendId)}}catch(E){f.e(E)}finally{f.f()}return o},rt=function(n){if(!n)return"";var o=document.createElement("canvas");o.width=n.width,o.height=n.height;var f=o.getContext("2d");f==null||f.drawImage(n,0,0,n.width,n.height);var S=o.toDataURL("image/png");return S.replace(/^data:image\/(png|jpg);base64,/,"")},fn=function(n){var o=rt(n),f=Re||.5,S=V==null?void 0:V.curr,T=pe.predict("PaddleOCR",{format:"b64",img:o,piggyback:{dataId:S==null?void 0:S.dataId}});!T||T.then(function(E){if(E){var ne,ie,Me=(ne=sn.current.curr)===null||ne===void 0?void 0:ne.dataId;if(Me!==E.piggyback.dataId)return;var me=E.predictions.map(function(ge){if(ge.score>f)return ge});Ae(!1),V.updatePredicted((ie=V.all[0])===null||ie===void 0?void 0:ie.dataId,!0),fe({active:!0,mousePoints:M.mousePoints,predictData:me})}},function(E){alert("error",E),pe.setLoading(!1)})},ot={polygon:(0,jn.Z)(vn),rectangle:(0,Bn.Z)(vn)};(0,N.Z)(function(){if(V.all.length>0)if(V.all[0].predicted){var i=!1;i!==Le&&Ae(i)}else{var n=!0;n!==Le&&Ae(n)}},[V.all]),(0,e.useEffect)(function(){Ee||tt()},[Ee]),(0,N.Z)(function(){if(Le){var i;if(pe.loading){te.default.error(z("modelLoading"));return}var n=(i=_.curr)!==null&&i!==void 0&&i.otherSettings?_.curr.otherSettings:{};if(!(n!=null&&n.mlBackendUrl))return;pe.setMlBackendUrl(n.mlBackendUrl||""),pe.setLoading(!0);var o={lang:n.lang};pe.load(n.modelName,o).then(function(){pe.setLoading(!1),m&&v(!1)},function(){pe.setLoading(!1),m||v(!0)})}else{var f;Ve((f=_.curr)===null||f===void 0?void 0:f.otherSettings)}},[Le,(Z=_.curr)===null||Z===void 0?void 0:Z.otherSettings]),(0,N.Z)(function(){var i=!m&&Fe&&Le;i&&fn(Fe)},[m,Le,Fe]),(0,N.Z)(function(){var i;M.predictData.length&&((i=_.curr)===null||i===void 0?void 0:i.projectId)!==void 0&&Ne.getAll(_.curr.projectId).then(function(n){var o,f=[],S=(o=r.all)!==null&&o!==void 0&&o.length?at(r.all)+1:1;M.predictData.map(function(E){if(E){var ne=E.result,ie=q==null?void 0:q.modelName,Me=n&&n[0];if(M.active){var me,ge=(0,Un.tx)(S,ne,(me=V.curr)===null||me===void 0?void 0:me.dataId,Me,ie);ge&&(f.push(ge),S++)}}});var T=!0;r.create(f,"",T),fe({active:!1,predictData:[],mousePoints:[]}),Qe(!1)})},[_==null||(R=_.curr)===null||R===void 0?void 0:R.projectId,M.predictData,q,$n]);var lt=function(){var i=(0,ue.Z)((0,j.Z)().mark(function n(o){var f,S;return(0,j.Z)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return S=r.all.filter(function(ne){return ne.frontendId!=o.frontendId}),we.record({annos:S}),r.setAll(S),ee(void 0),E.next=6,r.pushToBackend((f=V.curr)===null||f===void 0?void 0:f.dataId,S);case 6:case"end":return E.stop()}},n)}));return function(o){return i.apply(this,arguments)}}(),it=function(n){var o;r.setAll(n),r.pushToBackend((o=V.curr)===null||o===void 0?void 0:o.dataId,n)};return e.createElement(Ln.Z,{className:a().det},e.createElement(rn.Z,null,e.createElement(ce.Z,{imgSrc:"./pics/buttons/polygon.png",active:le.curr=="polygon",disabled:M.active,onClick:function(){var n;if(!Ne.curr&&(g.m8===null||g.m8===void 0||(n=g.m8.location)===null||n===void 0?void 0:n.pathname)!=="/optical_character_recognition"){te.default.error(z("chooseCategoryFirst"));return}le.setCurr("polygon"),ee(void 0)}},z("polygon")),e.createElement(ce.Z,{imgSrc:"./pics/buttons/rectangle.png",active:le.curr=="rectangle",onClick:function(){var n;if(!Ne.curr&&(g.m8===null||g.m8===void 0||(n=g.m8.location)===null||n===void 0?void 0:n.pathname)!=="/optical_character_recognition"){te.default.error(z("chooseCategoryFirst"));return}le.setCurr("rectangle"),ee(void 0)}},z("rectangle")),e.createElement(ce.Z,{active:le.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){le.setCurr("editor")}},z("edit")),e.createElement(ce.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){Xe.change(.1)}},z("zoomIn")),e.createElement(ce.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){Xe.change(-.1)}},z("zoomOut")),e.createElement(ce.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var n;r.pushToBackend((n=V.curr)===null||n===void 0?void 0:n.dataId)}},z("save")),e.createElement(ce.Z,{imgSrc:"./pics/buttons/move.png",active:le.curr=="mover",onClick:function(){le.setCurr("mover")}},z("move")),e.createElement(ce.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){we.backward().then(function(n){if(n){var o;r.setAll(n.annos),ee(n.currAnno),r.pushToBackend((o=V.curr)===null||o===void 0?void 0:o.dataId,n.annos)}})}},z("unDo")),e.createElement(ce.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){we.forward().then(function(n){if(n){var o;r.pushToBackend((o=V.curr)===null||o===void 0?void 0:o.dataId,n.annos),ee(n.currAnno)}})}},z("reDo")),e.createElement(ce.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){var n;r.clear(),we.record({annos:[]}),le.setCurr(void 0),(g.m8===null||g.m8===void 0||(n=g.m8.location)===null||n===void 0?void 0:n.pathname)!=="/optical_character_recognition"&&Ne.setCurr(void 0)}},z("clearMark"))),e.createElement("div",{id:"dr",className:"mainStage"},e.createElement(A.Z,{tip:"loading",spinning:!!Gn.curr},e.createElement("div",{className:"draw"},e.createElement(pn.Z,{ref:Oe,taskIndex:Ge.currIdx,scale:Xe.curr,scaleChange:Xe.setScale,annotations:r.all,currentTool:le.curr,currentAnnotation:r.curr,setCurrentAnnotation:ee,onAnnotationModify:qe,annotationDelete:it,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:Ce,setFrontendId:Y},imgSrc:V.imgSrc,transparency:cn,onAnnotationAdd:function(n){var o=r.all.concat([n]);r.setAll(o)},tool:le,drawTool:ot,threshold:0,onAnnotationModifyUP:_n})),e.createElement("div",{className:"pblock"},e.createElement(Nn.Z,{task:Ge,project:_})),e.createElement("div",{className:"prevTask","data-test-id":"prevTask",onClick:function(){if(!!Ge.prevTask()&&(fe({active:!1,predictData:[],mousePoints:[]}),ee(void 0),Qe(!1),Oe!=null&&Oe.current)){var n;Oe==null||(n=Oe.current)===null||n===void 0||n.setDragEndPos({x:0,y:0})}}}),e.createElement("div",{className:"nextTask","data-test-id":"nextTask",onClick:function(){var n;!Ge.nextTask()||(fe({active:!1,predictData:[],mousePoints:[]}),ee(void 0),Qe(!1),Oe==null||(n=Oe.current)===null||n===void 0||n.setDragEndPos({x:0,y:0}))}}))),e.createElement(rn.Z,{disLoc:"right"},e.createElement(ce.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){g.m8.push("/project_overview?projectId=".concat(_.curr.projectId))}},z("projectOverview")),e.createElement(ce.Z,{imgSrc:"./pics/buttons/intelligent_interaction.png",disabled:!Fe||!(_!=null&&(U=_.curr)!==null&&U!==void 0&&(F=U.otherSettings)!==null&&F!==void 0&&F.mlBackendUrl),onClick:function(){Fe&&fn(Fe)}},z("autoInference")),e.createElement(ln.Z,{disabled:M.active,imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:Re,maxSize:1,minSize:.1,step:.1,onChange:function(n){ze(n)}},z("autoInferenceThreshold")),e.createElement(ln.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:cn,maxSize:100,minSize:0,disabled:M.active,onChange:function(n){Hn(n)}},z("transparency"))),e.createElement("div",{className:"rightSideBar",style:{padding:"10px"}},e.createElement("div",{className:"titles",style:{textAlign:"center",padding:"20px",background:"#1727C2",color:"white"}},"\u8BC6\u522B\u7ED3\u679C"),e.createElement("div",{style:{height:"500px",border:"3px solid"}},e.createElement(Rn,{onAnnotationDelete:lt,onAnnotationModify:qe,updataAnno:r.update,annotations:r.all,currentAnnotation:r.curr,selectAnnotation:r.setCurr})),e.createElement("div",{style:{display:"flex",justifyContent:"space-around",marginTop:"20px"}})))},Vn=zn},51505:function(ke,De,t){"use strict";t.d(De,{Z:function(){return ue}});var xe=t(67294),A=function(te){return function(p,G){var L=(0,xe.useRef)(!1);te(function(){return function(){L.current=!1}},[]),te(function(){if(!L.current)L.current=!0;else return p()},G)}},j=null,ue=A(xe.useEffect)}}]);

(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[672],{52822:function(A){A.exports={roundBall:"roundBall___1pqu1",popover:"popover___1-PR6"}},5882:function(A){A.exports={listItem:"listItem___vtDXn",eye:"eye___AsLBS",roundBall:"roundBall___1J_R3",popover:"popover___1x-2R",delete:"delete___WHPf2",listItemActive:"listItemActive___3FRb7"}},56131:function(A){A.exports={labelList:"labelList___jvD05",listHeader:"listHeader___UM5UF",eye:"eye___II3Po",roundBall:"roundBall___j752J"}},73199:function(){},63097:function(A,W,e){"use strict";var $=e(20136),B=e(55241),oe=e(2824),f=e(67294),L=e(52822),a=e.n(L),b=e(63144),Z=function(P){var l=(0,f.useState)(P.color||"#FFF"),V=(0,oe.Z)(l,2),I=V[0],J=V[1];return(0,f.useEffect)(function(){J(P.color||"#FFF")},[P]),P.changeable?f.createElement(B.Z,{getPopupContainer:function(Y){return Y.parentElement||document.body},overlayClassName:a().popover,openClassName:a().popoverOpenClassName,placement:"bottom",content:f.createElement(b.xS,{disableAlpha:!0,color:I,onChange:function(Y){J(Y.hex)},onChangeComplete:P.onChange}),trigger:"click"},f.createElement("div",{className:a().roundBall,style:{backgroundColor:I}})):f.createElement("div",{className:a().roundBall,style:{backgroundColor:I}})};W.Z=Z},5041:function(A,W,e){"use strict";e.d(W,{Z:function(){return Pe}});var $=e(54421),B=e(38272),oe=e(57663),f=e(71577),L=e(2824),a=e(67294),b=e(56131),Z=e.n(b),H=e(49111),P=e(19650),l=e(11849),V=e(5882),I=e.n(V),J=e(63097),K=function(o){var s=(0,l.Z)({},o.label),m=(0,a.useState)(s.invisible),E=(0,L.Z)(m,2),c=E[0],p=E[1],N=(0,a.useState)(0),g=(0,L.Z)(N,2),T=g[0],U=g[1],M=o.hideEye?" ":a.createElement(a.Fragment,null,a.createElement("a",{className:I().eye,style:{backgroundImage:c?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(F){F.stopPropagation(),p(!c),o.onLabelModify&&o.onLabelModify(s)}})," "),C=o.hideColorPicker?a.createElement(a.Fragment,null):a.createElement(J.Z,{color:s.color,changeable:!1,onChange:function(F){s.color=F.hex,o.onLabelModify(s)}}),D=a.createElement(B.ZP.Item,{className:"".concat(I().listItem," ").concat(o.active?I().listItemActive:""),unselectable:"on",onClick:function(){o.onClick(s)},"data-test-id":"category-".concat(s.ith)},a.createElement(P.Z,{align:"center",size:5},M,s.name,C),a.createElement("a",{className:I().delete,onClick:function(F){F.stopPropagation();var u=new Date().getTime();u-T<300||(U(u),o.onLabelDelete(s))},"data-test-id":"deleteCategory-".concat(s.ith)}));return D},Y=K,k=e(71194),le=e(50146),be=e(47673),me=e(35920),Me=e(9715),y=e(96709),re=e(48971),se=["#FF0000","#008000","#0000FF","#FFFF00","#FFA500","#00FFFF","#8B00FF","#FFC0CB","#7CFC00","#007FFF","#800080","#36BF36","#DAA520","#800000","#008B8B","#B22222","#E6D933","#000080","#FF00FF","#FFFF99","#87CEEB","#5C50E6","#CD5C5C","#20B2AA","#E680FF","#4D1F00","#006374","#B399FF","#8B4513","#BA55D3","#C0C0C0","#808080","#000000"],ve=function(o){var s,m,E=(0,re.YB)(),c=E.formatMessage({id:"component.PPAddLabelModal.selectColor"}),p=E.formatMessage({id:"component.PPAddLabelModal.addLabel"}),N=E.formatMessage({id:"component.PPAddLabelModal.labelName"}),g=E.formatMessage({id:"component.PPCreater.cancel"}),T=E.formatMessage({id:"component.PPSegMode.ok"}),U=(0,a.useState)(((s=o.defaultLabel)===null||s===void 0?void 0:s.color)||se[o.order||0]),M=(0,L.Z)(U,2),C=M[0],D=M[1];(0,a.useEffect)(function(){var R;D(((R=o.defaultLabel)===null||R===void 0?void 0:R.color)||se[o.order||0])},[o]);var G=o.hideColorPicker?a.createElement(a.Fragment,null):a.createElement(y.Z.Item,{label:c,name:"color"},a.createElement(J.Z,{color:C,changeable:!0,onChange:function(v){D(v.hex)}})),F=y.Z.useForm(),u=(0,L.Z)(F,1),te=u[0];return a.createElement(le.Z,{title:p,visible:o.visible,onCancel:o.onCancel,footer:null},a.createElement(y.Z,{form:te,name:"basic",labelCol:{span:8},wrapperCol:{span:16},initialValues:{remember:!1,labelname:(m=o.defaultLabel)===null||m===void 0?void 0:m.name},onFinish:function(v){var Ee={name:v.labelname,color:C};o.onLabelAdd(Ee),te.resetFields()},autoComplete:"off"},a.createElement(y.Z.Item,{label:N,name:"labelname",rules:[{required:!0,message:"Please input label name!"}]},a.createElement(me.Z,{autoComplete:"off"})),G,a.createElement(y.Z.Item,{wrapperCol:{offset:8,span:16}},a.createElement(P.Z,null,a.createElement(f.Z,{onClick:function(){var v;(v=o.onCancel)===null||v===void 0||v.call(0),te.resetFields()}},g),a.createElement(f.Z,{type:"primary",htmlType:"submit"},T)))))},_e=ve,fe=function(o){var s,m=(0,re.YB)(),E=m.formatMessage({id:"component.PPLabelList.addLabel"}),c=m.formatMessage({id:"component.PPLabelList.labelList"});if(o.labels)for(var p=0;p<o.labels.length;p++)o.labels[p].ith=p;var N=(0,a.useState)(!1),g=(0,L.Z)(N,2),T=g[0],U=g[1];return a.createElement(a.Fragment,null,a.createElement(B.ZP,{className:Z().labelList,size:"large",header:a.createElement("div",{className:Z().listHeader},c),footer:a.createElement("div",null,a.createElement(f.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",disabled:o.disabled,onClick:function(){U(!0)},block:!0},E)),bordered:!0,dataSource:o.labels,renderItem:function(C){var D;return a.createElement(Y,{hideColorPicker:o.hideColorPicker,hideEye:o.hideEye,onClick:o.onLabelSelect,label:C,active:(D=o.activeIds)===null||D===void 0?void 0:D.has(C.labelId),onLabelDelete:o.onLabelDelete,onLabelModify:o.onLabelModify})}}),a.createElement(_e,{hideColorPicker:o.hideColorPicker,order:(s=o.labels)===null||s===void 0?void 0:s.length,visible:T,onLabelAdd:function(C){o.onLabelAdd(C),U(!1)},onCancel:function(){U(!1)}}))},Pe=fe},29214:function(A,W,e){"use strict";e.r(W);var $=e(39428),B=e(11849),oe=e(20228),f=e(11382),L=e(91220),a=e(34792),b=e(48086),Z=e(86582),H=e(3182),P=e(2824),l=e(67294),V=e(48971),I=e(73199),J=e.n(I),K=e(51505),Y=e(8088),k=e(61541),le=e(44434),be=e(5041),me=e(57436),Me=e(10137),y=e(83721),re=e(36505),se=e(84420),ve=e.n(se),_e=e(27992),fe=window.location.port=="8000"?"1234":window.location.port,Pe="http://".concat(window.location.hostname,":").concat(fe,"/"),ie=function(){var s,m=(0,l.useRef)(null),E=(0,y.Ad)("pages.classification"),c=(0,re.I)("pages.toolBar"),p=(0,l.useState)(!1),N=(0,P.Z)(p,2),g=N[0],T=N[1],U=(0,l.useState)(!0),M=(0,P.Z)(U,2),C=M[0],D=M[1],G=(0,l.useState)(),F=(0,P.Z)(G,2),u=F[0],te=F[1],R=(0,V.tT)("InteractorData"),v=R.interactorData,Ee=R.setInteractorData,Oe=(0,l.useState)(.9),De=(0,P.Z)(Oe,2),ge=De[0],Se=De[1],j=(0,y.$L)(l.useState,l.useEffect,{label:{oneHot:!1,postSelect:Ue},tool:{defaultTool:"mover"},effectTrigger:{postTaskChange:Re,postProjectChanged:ye}}),Ce=j.tool,Le=j.loading,de=j.scale,X=j.annotation,ae=j.task,x=j.data,O=j.project,_=j.label,Ae=j.refreshVar,Be=ve()(x.imgSrc||"","anonymous"),Ze=(0,P.Z)(Be,1),ce=Ze[0],z=(0,y.RZ)(l.useState,Pe);function ye(){var n;((n=O.curr)===null||n===void 0?void 0:n.labelFormat)=="single_class"&&_.setOneHot(!0)}var Te=function(t){if(console.log("getBase64Image",t),!t)return"";var i=document.createElement("canvas");i.width=t.width,i.height=t.height,console.log("img.width",t.width);var d=i.getContext("2d");d==null||d.drawImage(t,0,0,t.width,t.height);var r=i.toDataURL("image/png");return console.log("dataURL",r),r.replace(/^data:image\/(png|jpg);base64,/,"")};function Ue(n,t){return he.apply(this,arguments)}function he(){return he=(0,H.Z)((0,$.Z)().mark(function n(t,i){var d,r,Q,q;return(0,$.Z)().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(console.log("+_+_+",t,i,i.has(t.labelId)),i.has(t.labelId))console.log("+_+_+_","here"),_.isOneHot&&X.all.map(function(S){return X.remove(S)}),X.create({taskId:ae.curr.taskId,labelId:t.labelId,dataId:x.curr.dataId}).then(function(){return b.default.success(c("saveSuccess"))});else{d=X.all.filter(function(S){return S.labelId==t.labelId}),r=(0,L.Z)(d);try{for(r.s();!(Q=r.n()).done;)q=Q.value,X.remove(q.annotationId)}catch(S){r.e(S)}finally{r.f()}}case 2:case"end":return ee.stop()}},n)})),he.apply(this,arguments)}function Re(n,t){Le.setCurr(!0),!(!n||!t)&&(_.initActive(t),Le.setCurr(!1),console.log("post task change"))}var Ie=function(t){var i=Te(t),d=z.predict("PPLCNetV2",{format:"b64",img:i});!d||d.then(function(r){if(r){console.log("resss",r);var Q=r==null?void 0:r.predictions;T(!1),x.updatePredicted(x.all[0].dataId,!0),Ee({active:!0,mousePoints:v.mousePoints,predictData:Q})}},function(r){z.setLoading(!1),console.log("line.error",r)})},je=function(t){var i=(0,Z.Z)(t).map(function(d){var r={name:d,projectId:O.curr.projectId};return r});i.length>0&&_.create(i).then(function(d){d==null||d.forEach(function(r){_.onSelect(r)})})};return(0,K.Z)(function(){if(x.all.length>0)if(x.all[0].predicted){var n=!1;n!==g&&T(n)}else{var t=!0;t!==g&&T(t)}},[x.all]),(0,K.Z)(function(){var n,t;if(g&&(n=O.curr)!==null&&n!==void 0&&(t=n.otherSettings)!==null&&t!==void 0&&t.labelMapping){var i;if(z.loading){b.default.error(c("modelLoading"));return}var d=(i=O.curr)!==null&&i!==void 0&&i.otherSettings?O.curr.otherSettings:{};z.setMlBackendUrl(d.mlBackendUrl||""),z.setLoading(!0),z.load(d.modelName).then(function(){z.setLoading(!1),C&&D(!1)},function(){z.setLoading(!1),C||D(!0)})}else{var r;te((r=O.curr)===null||r===void 0?void 0:r.otherSettings)}},[g,(s=O.curr)===null||s===void 0?void 0:s.otherSettings]),(0,K.Z)(function(){var n=!C&&ce&&g;n&&Ie(ce)},[C,g,ce]),(0,K.Z)(function(){if(console.log("interactorData.predictData",u,v.predictData.length),v.predictData.length&&u!==null&&u!==void 0&&u.labelMapping&&_.all){var n,t=new Set,i=new Map,d={},r=(0,L.Z)(_.all),Q;try{for(r.s();!(Q=r.n()).done;){var q=Q.value;q.name&&i.set(q.name,q)}}catch(w){r.e(w)}finally{r.f()}if((u==null||(n=u.labelMapping)===null||n===void 0?void 0:n.length)>0){var ne=(0,L.Z)(u==null?void 0:u.labelMapping),ee;try{for(ne.s();!(ee=ne.n()).done;){var S=ee.value;d[S.model]=S.project,i.has(S.project)||t.add(S.project)}}catch(w){ne.e(w)}finally{ne.f()}}var pe=ge||.5,ue=(0,L.Z)(v.predictData),Fe;try{for(ue.s();!(Fe=ue.n()).done;){var h=Fe.value;(h==null?void 0:h.score)>pe&&(console.log("!oldLabel.has(labelItem?.label_name)",i),h&&!i.has(h==null?void 0:h.label_name)&&!d[h==null?void 0:h.label_name]&&t.add(h==null?void 0:h.label_name))}}catch(w){ue.e(w)}finally{ue.f()}var We=v.predictData.some(function(w){return w.score>pe});We||b.default.error(E("noHighScoreResult")),je(t),!(0,Z.Z)(t).length}},[v,u]),console.log("label.activeIds",_.activeIds.size),l.createElement(Y.Z,{className:J().classes},l.createElement(le.Z,null,l.createElement(k.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){de.change(.1)}},c("zoomIn")),l.createElement(k.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){de.change(-.1)}},c("zoomOut")),l.createElement(k.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){b.default.success(c("autoSave"))}},c("save")),l.createElement(k.Z,{imgSrc:"./pics/buttons/move.png",active:Ce.curr=="mover",onClick:function(){Ce.setCurr("mover")}},c("move")),l.createElement(k.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){X.clear()}},c("clearMark"))),l.createElement("div",{id:"dr",className:"mainStage"},l.createElement(f.Z,{tip:c("loading","global"),spinning:Le.curr},l.createElement("div",{className:"draw"},l.createElement(me.Z,{ref:m,scale:de.curr,currentTool:Ce.curr,scaleChange:de.setScale,taskIndex:ae.currIdx,setCurrentAnnotation:function(){},onAnnotationModify:function(){},onAnnotationModifyComplete:function(){},imgSrc:x.imgSrc,annotations:X.all})),l.createElement("div",{className:"pblock"},l.createElement(Me.Z,{task:ae,project:O})),l.createElement("div",{className:"prevTask",onClick:function(){var t;_.activeIds.size||b.default.info(E("preNext")),ae.prevTask(),m==null||(t=m.current)===null||t===void 0||t.setDragEndPos({x:0,y:0})},"data-test-id":"prevTask"}),l.createElement("div",{className:"nextTask",onClick:function(){var t;_.activeIds.size||b.default.info(E("preNext")),ae.nextTask(),m==null||(t=m.current)===null||t===void 0||t.setDragEndPos({x:0,y:0})},"data-test-id":"nextTask"}))),l.createElement(le.Z,{disLoc:"right"},l.createElement(k.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){V.m8.push("/project_overview?projectId=".concat(O.curr.projectId))}},c("projectOverview")),l.createElement(k.Z,{imgSrc:"./pics/buttons/intelligent_interaction.png",disabled:!(u!=null&&u.labelMapping),onClick:function(){Ie(ce)}},c("autoInference")),l.createElement(_e.Z,{disabled:!v.active,imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:ge,maxSize:1,minSize:.1,step:.1,onChange:function(t){Se(t)}},c("autoInferenceThreshold"))),l.createElement("div",{className:"rightSideBar"},l.createElement(be.Z,{labels:_.all,activeIds:_.activeIds,onLabelSelect:_.onSelect,onLabelAdd:function(t){return _.create((0,B.Z)((0,B.Z)({},t),{},{projectId:O.curr.projectId}))},onLabelDelete:_.remove,hideColorPicker:!0,hideEye:!0,refresh:Ae})))};W.default=ie},51505:function(A,W,e){"use strict";e.d(W,{Z:function(){return f}});var $=e(67294),B=function(a){return function(b,Z){var H=(0,$.useRef)(!1);a(function(){return function(){H.current=!1}},[]),a(function(){if(!H.current)H.current=!0;else return b()},Z)}},oe=null,f=B($.useEffect)}}]);

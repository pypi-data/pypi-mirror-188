(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[540],{13237:function(Ie){Ie.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___26yoA",toolBarButtonContainer:"toolBarButtonContainer___3TAcy",toolBarButton:"toolBarButton___utzQD",buttonText:"buttonText___10yo3",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___UC85Z",popover:"popover___V2uUa",slider:"slider___293AL",popoverLeft:"popoverLeft___2uQ3J"}},92005:function(Ie){Ie.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___lgjXv",toolBarButtonContainer:"toolBarButtonContainer___9-mqN",toolBarButton:"toolBarButton___3mwy2",buttonText:"buttonText___2t3jE",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___3k6_F",popover:"popover___2HFqy",slider:"slider___2R_WW",popoverLeft:"popoverLeft___XK8Bw"}},93181:function(Ie,Ee,s){"use strict";s.d(Ee,{Z:function(){return ae}});var oe=s(91220),ue=s(11849),G=s(67294),Q=s(65031),Pe=s(57406);function xe(f,y,t){if(!(!f||!y))if(t==="/optical_character_recognition"){var B=y.join("|"),$=B+"||\u5F85\u8BC6\u522B|0|";return $}else return y.join(",")}function Re(f,y,t){var B,$,A=f.annotation;if(!A||!A.result||A.result.length<2||!((B=A.label)!==null&&B!==void 0&&B.color))return G.createElement(G.Fragment,null);var j=A.result.split(",").map(Number);console.log("points",j.length);var T=A.label.color,X=(0,Pe.oo)(T);if(!X)return G.createElement(G.Fragment,null);var U=(($=f.currentAnnotation)===null||$===void 0?void 0:$.frontendId)==A.frontendId,ee=U?.5:.2,Y=void 0,H=[];return j.forEach(function(N,te){if(te%2==0){Y=N;return}H.push(G.createElement(Q.Cd,{onMouseDown:function(){f.currentTool=="editor"&&f.onSelect(A)},draggable:f.currentTool=="editor",onDragEnd:function(w){var ne;w.cancelBubble=!0;var Me=(ne=f.stageRef)===null||ne===void 0?void 0:ne.current,J=Me.findOne(".baseImage"),de=!1,le=w.target.x();le>J.width()/2&&(le=J.width()/2,de=!0),le<-J.width()/2&&(le=-J.width()/2,de=!0);var ie=w.target.y();if(ie>J.height()/2&&(ie=J.height()/2,de=!0),ie<-J.height()/2&&(ie=-J.height()/2,de=!0),de&&w.target.setPosition({x:le,y:ie}),j[te-1]=le,j[te]=ie,f.pathName==="/optical_character_recognition"){var je=t?"||".concat(t,"|0|"):"||\u5F85\u8BC6\u522B|0|",Ze=j.join("|")+je,we=(0,ue.Z)((0,ue.Z)({},A),{},{result:Ze});f.onDragUP(we)}else{var ce=(0,ue.Z)((0,ue.Z)({},A),{},{result:j.join(",")});f.onDragUP(ce)}},onMouseOver:function(){var w,ne;f.currentTool=="editor"&&(w=f.stageRef)!==null&&w!==void 0&&w.current&&(f.stageRef.current.container().style.cursor="cell"),(ne=f.layerRef.current)===null||ne===void 0||ne.batchDraw()},onMouseOut:function(){var w;(w=f.stageRef)!==null&&w!==void 0&&w.current&&(f.stageRef.current.container().style.cursor="default")},x:Y,y:N,radius:5/f.scale,fill:T})),Y=void 0}),G.createElement(Q.ZA,{key:A.frontendId,onClick:function(){(f.currentTool==="editor"||f.currentTool==="mover")&&f.onSelect(A)}},G.createElement(Q.x1,{onMouseOver:function(){f.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},stroke:T,strokeWidth:2/f.scale,globalCompositeOperation:"source-over",lineCap:"round",points:j,tension:0,closed:y,fill:"rgba(".concat(X.r,", ").concat(X.g,", ").concat(X.b,", ").concat(ee,")")}),H)}function Ue(f){var y=0;if(!f)return y;var t=(0,oe.Z)(f),B;try{for(t.s();!(B=t.n()).done;){var $=B.value;!$||!$.frontendId||$.frontendId>y&&(y=$.frontendId)}}catch(A){t.e(A)}finally{t.f()}return y}function ae(f){var y=function(T,X,U,ee,Y){var H,N,te=xe((H=f.currentLabel)===null||H===void 0?void 0:H.color,[T,X],ee);if(!!te){var x={dataId:f.dataId,frontendId:(U==null?void 0:U.frontendId)!==void 0?U==null?void 0:U.frontendId:Ue(Y)+1,label:f.currentLabel,labelId:(N=f.currentLabel)===null||N===void 0?void 0:N.labelId,result:te,type:""};ee==="/optical_character_recognition"?(x.type="ocr_polygon",x.frontendId=Ue(Y)+1):x.type="polygon",f.onAnnotationAdd(x)}},t=function(T,X,U){var ee;if(!(!f.currentAnnotation||!f.currentAnnotation.result||!((ee=f.currentLabel)!==null&&ee!==void 0&&ee.color))){var Y="";if(U==="/optical_character_recognition"){var H,N=(H=f.currentAnnotation.result)===null||H===void 0?void 0:H.split("||"),te=N[0]+"|".concat(T,"|").concat(X);Y=te+"||"+N[1]}else Y=f.currentAnnotation.result+",".concat(T,",").concat(X);var x=(0,ue.Z)((0,ue.Z)({},f.currentAnnotation),{},{result:Y});f.onAnnotationModify(x)}},B=function(T){if(f.currentTool=="polygon"){var X=T.mouseX+T.offsetX,U=T.mouseY+T.offsetY;!f.currentAnnotation&&T.flags?y(X,U,f.selectFinly,T.pathName,f.annotations):t(X,U,T.pathName),f.onMouseDown&&f.onMouseDown()}},$=function(){},A=function(T){f.currentTool=="polygon"&&T.e.evt.button!==2&&f.onMouseUp&&f.onMouseUp()};return{onMouseDown:B,onMouseMove:$,onMouseUp:A,drawAnnotation:Re}}},91525:function(Ie,Ee,s){"use strict";s.r(Ee),s.d(Ee,{default:function(){return Rt}});var oe=s(11849),ue=s(57663),G=s(71577),Q=s(39428),Pe=s(3182),xe=s(20228),Re=s(11382),Ue=s(34792),ae=s(48086),f=s(91220),y=s(2824),t=s(67294),B=s(48971),$=s(8088),A=s(61541),j=s(44434),T=s(27992),X=s(20136),U=s(55241),ee=s(13062),Y=s(71230),H=s(89032),N=s(15746),te=s(43358),x=s(42239),w=s(36505),ne=s(92005),Me=s.n(ne),J=x.Z.Option,de=function(r){var a=(0,w.I)("pages.toolBar.colorMode");return t.createElement(U.Z,{overlayClassName:"".concat(Me().popover," ").concat(r.disLoc=="left"?Me().popoverLeft:""),placement:r.disLoc||"right",content:t.createElement(Y.Z,null,t.createElement(N.Z,{span:24},t.createElement("div",{style:{padding:"10px"}},t.createElement(x.Z,{defaultValue:"label",style:{width:120},onChange:r.onChange},t.createElement(J,{value:"label"},a("label")),t.createElement(J,{value:"inStance"},a("object")))))),trigger:"hover",visible:r.disabled?!1:void 0}," ",t.createElement(A.Z,{imgSrc:r.imgSrc||"",onClick:!r.disabled&&r.onClick||void 0,active:r.active,disabled:r.disabled},r.children))},le=de,ie=s(5041),je=s(57436),Ze=s(14836);function we(e){if(!e||!e.width||!e.color||!e.points||e.points.length<2||e.frontendId==null)return"";var r=e.type=="rubber"?0:e.frontendId;return"".concat(e.width,",").concat(r,",").concat(e.points.join(","))}var ce="";function ct(e){var r,a=e.canvasRef2,i=e.annotation,u=a,o=i.result;if(!o)return t.createElement(t.Fragment,null);var g=(r=u.current)===null||r===void 0?void 0:r.getContext("2d");if(!g)return t.createElement(t.Fragment,null);for(var c=[],h=0,l=0;l<o.length;l++)o.at(l)==","?(c.push(parseFloat(o.slice(h,l))),h=l+1):o.at(l)=="|"?(c.push(parseFloat(o.slice(h,l))),Ge(c,g,i),c=[],h=l+1):l==o.length-1&&(c.push(parseFloat(o.slice(h,o.length))),Ge(c,g,i));return t.createElement(t.Fragment,null)}var st=function(r,a,i,u){i.save(),i.beginPath(),i==null||i.arc(r,a,u/16,0,2*Math.PI),i.strokeStyle="red",i.stroke()};function Ge(e,r,a){var i;if(!(e.length<4)){var u=e[0],o=e[1];if(u===0){var g;vt(r,e.slice(2),(g=a.label)===null||g===void 0?void 0:g.color);return}if(o==0){Ye(r,u,e.slice(2),void 0);return}Ye(r,u,e.slice(2),(i=a.label)===null||i===void 0?void 0:i.color)}}function Ye(e,r,a,i){e.beginPath(),e.moveTo(a[0],a[1]);for(var u=0;u<=a.length/2-1;u++){var o=a[2*u],g=a[2*u+1];e.lineTo(o,g)}e.lineCap="round",e.lineJoin="round",e.lineWidth=r,i&&(e.strokeStyle=i),e.globalCompositeOperation=i?"source-over":"destination-out",e.stroke()}function vt(e,r,a){e.globalCompositeOperation=a?"source-over":"destination-out",a&&(e.fillStyle=a);for(var i=0;i<=r.length/2-1;i++){var u=r[2*i],o=r[2*i+1];e.fillRect(u,o,1,1)}}function ze(e){if(!e||e.length==0)return 0;var r=0,a=(0,f.Z)(e),i;try{for(a.s();!(i=a.n()).done;){var u=i.value;u.frontendId>r&&(r=u.frontendId)}}catch(o){a.e(o)}finally{a.f()}return r}function ft(e,r){return e=="rubber"||r==2?"rubber":"brush"}function mt(e){var r=(0,t.useState)(),a=(0,y.Z)(r,2),i=a[0],u=a[1],o=function(l){var b,S,C;if(!(e.currentTool!="brush"&&e.currentTool!="rubber"||!((b=e.currentLabel)!==null&&b!==void 0&&b.color)||!e.brushSize)){var Z=l.mouseX,E=l.mouseY,D=ft(e.currentTool,l.e.evt.button),L;if((B.m8===null||B.m8===void 0||(S=B.m8.location)===null||S===void 0?void 0:S.pathname)==="/instance_segmentation"){var ve,_,K;if(e.finlyList&&((ve=e.finlyList)===null||ve===void 0?void 0:ve.length)>0&&e.selectFinly)L=e.selectFinly.frontendId;else if(e.finlyList&&((_=e.finlyList)===null||_===void 0?void 0:_.length)>0&&!e.selectFinly){var V;L=((V=e.finlyList)===null||V===void 0?void 0:V.length)>0?ze(e.finlyList)+1:1}else((K=e.finlyList)===null||K===void 0?void 0:K.length)===0&&!e.selectFinly&&(L=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:ze(e.annotations)+1)}else L=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:ze(e.annotations)+1;L!=e.frontendIdOps.frontendId&&e.frontendIdOps.setFrontendId(L);var fe=we({width:e.brushSize||10,color:((C=e.currentLabel)===null||C===void 0?void 0:C.color)||"blue",points:[Z,E,Z,E],type:D,frontendId:L});if(!!fe){if(u(D),e.currentLabel){var Ce,re={dataId:e.dataId,label:e.currentLabel,labelId:(Ce=e.currentLabel)===null||Ce===void 0?void 0:Ce.labelId,frontendId:L,result:fe,type:"brush"};e.onAnnotationAdd(re)}ce=fe}}},g=function(l){var b;if(!(!i||!e.currentAnnotation||!e.currentAnnotation.result||e.currentAnnotation.result.length<2||!((b=e.currentLabel)!==null&&b!==void 0&&b.color))){var S=l.mouseX,C=l.mouseY;ce=ce+",".concat(S,",").concat(C)}},c=function(){var l,b;if(!(!i||!e.currentAnnotation||!e.currentAnnotation.result||e.currentAnnotation.result.length<2||!((l=e.currentLabel)!==null&&l!==void 0&&l.color))){var S=e.annotations[((b=e.annotations)===null||b===void 0?void 0:b.length)-1];e.onAnnotationupdata((0,oe.Z)((0,oe.Z)({},S),{},{result:ce})),ce="",u(void 0),e.onMouseUp()}};return{onMouseDown:o,onMouseMove:g,onMouseUp:c,drawGuidewires:st,drawAnnotation:ct}}function gt(e){if(!e||!e.width||e.color==null||!e.points||e.points.length<2||e.frontendId==null)return"";var r=e.type=="rubber"?0:e.frontendId;return"".concat(e.width,",").concat(r,",").concat(e.points.join(","))}var ye="";function ht(e){var r,a=e.canvasRef2,i=e.annotation,u=a,o=i.result;if(!o)return t.createElement(t.Fragment,null);var g=(r=u.current)===null||r===void 0?void 0:r.getContext("2d");if(!g)return t.createElement(t.Fragment,null);for(var c=[],h=0,l=0;l<o.length;l++)o.at(l)==","?(c.push(parseFloat(o.slice(h,l))),h=l+1):o.at(l)=="|"?(c.push(parseFloat(o.slice(h,l))),He(c,g,i),c=[],h=l+1):l==o.length-1&&(c.push(parseFloat(o.slice(h,o.length))),He(c,g,i));return t.createElement(t.Fragment,null)}function He(e,r,a){var i;if(!(e.length<4)){var u=e[0],o=e[1];if(u==0){var g;bt(r,e.slice(2),(g=a.label)===null||g===void 0?void 0:g.color);return}if(o==0){Je(r,u,e.slice(2),void 0);return}Je(r,u,e.slice(2),(i=a.label)===null||i===void 0?void 0:i.color)}}function Je(e,r,a,i){e.beginPath(),e.moveTo(a[0],a[1]);for(var u=0;u<=a.length/2-1;u++){var o=a[2*u],g=a[2*u+1];e.lineTo(o,g)}e.lineCap="round",e.lineJoin="round",e.lineWidth=r,e.strokeStyle="",e.globalCompositeOperation=i?"source-over":"destination-out",e.stroke()}function bt(e,r,a){console.log("renderPixel: ",r,a,e),e.globalCompositeOperation=a?"source-over":"destination-out",a&&(e.fillStyle=a);for(var i=0;i<=r.length/2-1;i++){var u=r[2*i],o=r[2*i+1];e.fillRect(u,o,1,1)}}function Ct(e){if(!e||e.length==0)return 0;var r=0,a=(0,f.Z)(e),i;try{for(a.s();!(i=a.n()).done;){var u=i.value;u.frontendId>r&&(r=u.frontendId)}}catch(o){a.e(o)}finally{a.f()}return r}function St(e,r){return e=="rubber"||r==2?"rubber":"brush"}function It(e){var r=(0,t.useState)(),a=(0,y.Z)(r,2),i=a[0],u=a[1],o=function(l){var b;if(!(e.currentTool!="brush"&&e.currentTool!="rubber"||!e.brushSize)){var S=l.mouseX,C=l.mouseY,Z=St(e.currentTool,l.e.evt.button),E=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:Ct(e.annotations)+1;E!=e.frontendIdOps.frontendId&&e.frontendIdOps.setFrontendId(E);var D=gt({width:e.brushSize||10,color:Z==="brush"&&((b=e.currentLabel)===null||b===void 0?void 0:b.color)||"",points:[S,C,S,C],type:Z,frontendId:E});if(u(Z),!!D){if(Z==="brush"){if(e.currentLabel){var L,ve={dataId:e.dataId,label:e.currentLabel,labelId:(L=e.currentLabel)===null||L===void 0?void 0:L.labelId,frontendId:E,result:D,type:"brush"};e.onAnnotationAdd(ve)}}else{var _,K,V,fe={dataId:e.dataId,label:e.currentAnnotation?(_=e.currentAnnotation)===null||_===void 0?void 0:_.label:e.labels[0],labelId:e.currentAnnotation?(K=e.currentAnnotation)===null||K===void 0?void 0:K.labelId:(V=e.labels[0])===null||V===void 0?void 0:V.labelId,frontendId:E,result:D,type:"rubber"};e.onAnnotationAdd(fe)}ye=D}}},g=function(l){if(!!i){var b=l.mouseX,S=l.mouseY;ye=ye+",".concat(b,",").concat(S)}},c=function(){var l;if(e.currentTool=="rubber"){var b=e.annotations[((l=e.annotations)===null||l===void 0?void 0:l.length)-1];e.onAnnotationModify((0,oe.Z)((0,oe.Z)({},b),{},{result:ye})),ye="",u(void 0),e.onMouseUp()}};return{onMouseDown:o,onMouseMove:g,onMouseUp:c,drawAnnotation:ht}}var Pt=s(93181),yt=s(10137),Te=s(83721);function At(){this.TextColor="FFFFFF",this.Color="FF0000"}var se={TotalColors:300,GetColor:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=new At,i=r%se.TotalColors,u=se._CalColor(i);return a.Color=u.toString(16).padStart(6,"0"),a.TextColor=se._CalTextColor(a.Color),a},_CalColor:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=16711680,i=16777215,u=se.TotalColors>0?se.TotalColors:255,o=i/u;return r>=0&&r<=u&&(a=o*r),a=Math.round(a),a},_CalTextColor:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=r.substr(0,2),i=r.substr(2,2),u=r.substr(4,2),o=parseInt(a,16),g=parseInt(i,16),c=parseInt(u,16),h=Et(o,g,c);h.L=(h.L+.5)%1;var l=Mt(h.H,h.S,h.L),b=(l.R<<16)+(l.G<<8)+l.B;return b.toString(16).padStart(6,"0")}},Et=function(r,a,i){var u=r/255,o=a/255,g=i/255,c=Math.max(u,o,g),h=Math.min(u,o,g),l,b=(c+h)/2,S=(c+h)/2;if(c==h)l=b=0;else{var C=c-h;switch(b=S>.5?C/(2-c-h):C/(c+h),c){case u:l=(o-g)/C+(o<g?6:0);break;case o:l=(g-u)/C+2;break;case g:l=(u-o)/C+4;break}l/=6}return{H:l,S:b,L:S}},Mt=function(r,a,i){var u,o,g;if(a==0)u=o=g=i;else{var c=function(S,C,Z){var E=Z;return E<0&&(E+=1),E>1&&(E-=1),E<1/6?S+(C-S)*6*E:E<1/2?C:E<2/3?S+(C-S)*(2/3-E)*6:S},h=i<.5?i*(1+a):i+a-i*a,l=2*i-h;u=c(l,h,r+1/3),o=c(l,h,r),g=c(l,h,r-1/3)}return{R:Math.round(u*255),G:Math.round(o*255),B:Math.round(g*255)}},dn=s(71194),Zt=s(50146),cn=s(49111),Tt=s(19650),sn=s(47673),$e=s(35920),vn=s(9715),be=s(96709),Ne="http://127.0.0.1:1234",Bt=function(r){var a=be.Z.useForm(),i=(0,y.Z)(a,1),u=i[0],o=(0,Te.Ad)("component.PPInteractorModal"),g=r.model,c=r.project;(0,t.useEffect)(function(){var l,b,S,C;if(!!c.curr){var Z=c.curr.otherSettings?c.curr.otherSettings:{},E={mlBackendUrl:Z.mlBackendUrl,modelFilePath:(l=Z.modelSettings)===null||l===void 0||(b=l.EISeg)===null||b===void 0?void 0:b.modelFilePath,paramFilePath:(S=Z.modelSettings)===null||S===void 0||(C=S.EISeg)===null||C===void 0?void 0:C.paramFilePath};if(u.setFieldsValue(E),Z.mlBackendUrl?g.setMlBackendUrl(Z.mlBackendUrl):g.setMlBackendUrl(Ne),Z.modelFilePath&&Z.paramFilePath){var D={model_path:Z.modelFilePath,param_path:Z.paramFilePath};g.load("EISeg",D)}}},[c.curr]);function h(){var l,b,S,C,Z,E,D,L;c.curr||ae.default.error("Please select project first!"),c.curr.otherSettings||(c.curr.otherSettings={}),c.curr.otherSettings.mlBackendUrl=u.getFieldValue("mlBackendUrl"),c.curr.otherSettings.modelSettings={},c.curr.otherSettings.modelSettings.EISeg={},c.curr.otherSettings.modelSettings.EISeg.modelFilePath=u.getFieldValue("modelFilePath"),c.curr.otherSettings.modelSettings.EISeg.paramFilePath=u.getFieldValue("paramFilePath"),c.update(c.curr.projectId,{otherSettings:c.curr.otherSettings}),g.setMlBackendUrl(c.curr.otherSettings.mlBackendUrl),r.model.setLoading(!0),g.load("EISeg",(l=c.curr)===null||l===void 0||(b=l.otherSettings)===null||b===void 0||(S=b.models)===null||S===void 0||(C=S.EISeg)===null||C===void 0?void 0:C.modelFilePath,(Z=c.curr)===null||Z===void 0||(E=Z.otherSettings)===null||E===void 0||(D=E.models)===null||D===void 0||(L=D.EISeg)===null||L===void 0?void 0:L.paramFilePath).then(function(){ae.default.info(o("modelLoaded")),r.model.setLoading(!1)},function(){r.model.setLoading(!1)})}return t.createElement(Zt.Z,{title:o("title"),visible:r.visible,onCancel:r.onCancel,footer:null,width:"60rem"},t.createElement(be.Z,{form:u,name:"basic",labelCol:{span:8},wrapperCol:{span:16},onFinish:function(b){h(b),r.setVisible(!1)},autoComplete:"off"},t.createElement(be.Z.Item,{name:"mlBackendUrl",label:o("mlBackendUrl"),labelCol:{span:6},wrapperCol:{span:18},initialValue:Ne,style:{fontSize:"1.5rem"}},t.createElement($e.Z,{autoComplete:"off",placeholder:Ne})),t.createElement(be.Z.Item,{name:"modelFilePath",label:o("modelPath"),labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"}},t.createElement($e.Z,{autoComplete:"off",placeholder:o("modelPathPh")})),t.createElement(be.Z.Item,{name:"paramFilePath",label:o("weightPath"),labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"}},t.createElement($e.Z,{autoComplete:"off",placeholder:o("weightPathPh")})),t.createElement(be.Z.Item,{wrapperCol:{offset:8,span:16}},t.createElement(Tt.Z,null,t.createElement(G.Z,{onClick:function(){var b;(b=r.onCancel)===null||b===void 0||b.call(0)}},o("cancel","global")),t.createElement(G.Z,{type:"primary",htmlType:"submit"},o("ok","global"))))),t.createElement("div",{style:{fontSize:"16px",color:"red"}},o("Warintoast")))},Lt=Bt,Ft=s(13237),Ke=s.n(Ft),Ot=function(r){var a=(0,Te.Ad)("component.PPInteractorModal"),i=r.model,u=r.project,o=(0,t.useState)(!1),g=(0,y.Z)(o,2),c=g[0],h=g[1];return t.createElement(t.Fragment,null,t.createElement(U.Z,{overlayClassName:"".concat(Ke().popover," ").concat(Ke().popoverLeft),placement:"left",content:t.createElement(G.Z,{onClick:function(){return h(!0)},type:"primary",style:{height:"2.5rem"},block:!0},a("title")),trigger:"hover"}," ",t.createElement(A.Z,{imgSrc:r.imgSrc||"",onClick:r.onClick,active:r.active},r.children)),t.createElement(Lt,{visible:c,setVisible:h,model:i,project:u,onCancel:function(){h(!1)}}))},kt=Ot,pe=s(28271),Dt=function(){var r,a,i,u,o=(0,w.I)("pages.toolBar"),g=(0,t.useState)(0),c=(0,y.Z)(g,2),h=c[0],l=c[1],b=(0,t.useState)(!(B.m8!==null&&B.m8!==void 0&&(r=B.m8.location)!==null&&r!==void 0&&r.pathname.includes("/instance_segmentation"))),S=(0,y.Z)(b,1),C=S[0],Z=(0,t.useState)([]),E=(0,y.Z)(Z,2),D=E[0],L=E[1],ve=(0,t.useState)(),_=(0,y.Z)(ve,2),K=_[0],V=_[1],fe=(0,t.useState)("label"),Ce=(0,y.Z)(fe,2),re=Ce[0],Ut=Ce[1],jt=(0,t.useState)(10),Qe=(0,y.Z)(jt,2),Be=Qe[0],_e=Qe[1],wt=(0,t.useState)(.7),qe=(0,y.Z)(wt,2),Ve=qe[0],zt=qe[1],$t=(0,t.useState)(),et=(0,y.Z)($t,2),Le=et[0],Nt=et[1],Vt=(0,t.useState)(60),tt=(0,y.Z)(Vt,2),We=tt[0],Wt=tt[1],nt=(0,B.tT)("VisualRadius"),Xt=nt.radius,xt=nt.setRadius,rt=(0,B.tT)("InteractorData"),M=rt.interactorData,Xe=rt.setInteractorData,Gt=(0,t.useState)(!1),ot=(0,y.Z)(Gt,2),Yt=ot[0],Ht=ot[1],Jt=(0,t.useState)(!1),at=(0,y.Z)(Jt,2),lt=at[0],Kt=at[1],pt=(0,t.useState)(!1),it=(0,y.Z)(pt,2),Qt=it[0],_t=it[1],Fe=(0,Te.RZ)(t.useState),me=(0,t.useRef)(null),q=(0,Te.$L)(t.useState,t.useEffect,{effectTrigger:{postTaskChange:function(n,v){ge.init({annos:v})}},label:{oneHot:!0,postSelect:function(){d.setCurr(void 0),l(0)},preUnsetCurr:en},tool:{defaultTool:"mover"},task:{push:!0}}),F=q.tool,Oe=q.loading,Ae=q.scale,d=q.annotation,ke=q.task,p=q.data,Se=q.project,W=q.label,qt=q.refreshVar,ge=q.annHistory;function en(){d.setCurr(void 0),l(0)}var O=function(n){d.setCurr(n),n!=null&&n.frontendId?l(n.frontendId):l(0)},tn=function(){if(M.active){var n,v=(0,pe.VL)(Ve,d.all,M==null?void 0:M.predictData,(n=p.curr)===null||n===void 0?void 0:n.dataId,D,K,W.curr);if(v){var I,P=d.all.concat([v]);d.setAll(P),O(v),d.pushToBackend((I=p.curr)===null||I===void 0?void 0:I.dataId,P)}Xe({mousePoints:[],active:!0,predictData:[]}),Ht(!0)}},ut=function(){var n;if(((n=d.all)===null||n===void 0?void 0:n.length)>0){var v=new Map,I=[];re!=="label"?d.all.forEach(function(P){var k=se.GetColor(P.frontendId),z=JSON.parse(JSON.stringify(P));z.label.color="#"+k.Color,v.set(P.frontendId,z)}):d.all.forEach(function(P){v.set(P.frontendId,P)}),v.forEach(function(P){I.push(P)}),L(I),V(null)}else L([]),V(null)};(0,t.useEffect)(function(){ut()},[Oe.curr,re,Yt]),(0,t.useEffect)(function(){M.active&&M.predictData.length&&tn()},[lt]),(0,t.useEffect)(function(){if(!Oe.curr&&re!=="label"){var m=d.all.map(function(n){var v=se.GetColor(n.frontendId),I=JSON.parse(JSON.stringify(n));return I.label.color="#"+v.Color,I});Nt(m)}},[re,d.all,Oe.curr]);var nn=function(n){!n||(d.all.pop(),d.all.push(n),O(n),d.setAll(d.all))},rn=function(n){var v;!n||(d.all.pop(),d.all.push(n),O(n),d.setAll(d.all),d.pushToBackend((v=p.curr)===null||v===void 0?void 0:v.dataId,d.all))},on=function(n){var v=[],I=(0,f.Z)(d.all),P;try{for(I.s();!(P=I.n()).done;){var k=P.value;k.frontendId==n.frontendId?v.push(n):v.push(k)}}catch(z){I.e(z)}finally{I.f()}O(n),d.setAll(v),d.update(n),ae.default.success(o("saveSuccess"))},dt=function(n){var v=[],I=(0,f.Z)(d.all),P;try{for(I.s();!(P=I.n()).done;){var k=P.value;k.frontendId==n.frontendId?v.push(n):v.push(k)}}catch(z){I.e(z)}finally{I.f()}O(n),d.setAll(v)},an=function(n){var v;d.setAll(n),d.pushToBackend((v=p.curr)===null||v===void 0?void 0:v.dataId,n)},De={dataId:(a=p.curr)===null||a===void 0?void 0:a.dataId,currentLabel:W.curr,brushSize:Be,scale:Ae.curr,currentTool:F.curr,annotations:d.all,labels:W.all,currentAnnotation:d.curr,onAnnotationAdd:function(n){var v=d.all.concat([n]);d.setAll(v),O(n)},onAnnotationModify:nn,onAnnotationupdata:rn,modifyAnnoByFrontendId:dt,onMouseUp:function(){M.active||ge.record({annos:d.all,currAnno:d.curr})},frontendIdOps:{frontendId:h,setFrontendId:l},model:Fe,finlyList:D,selectFinly:K,isLabel:re,pathName:B.m8===null||B.m8===void 0||(i=B.m8.location)===null||i===void 0?void 0:i.pathname},ln={polygon:(0,Pt.Z)(De),brush:mt(De),interactor:(0,pe.ZP)(De),rubber:It(De)},un=function(n){Ut(n)};return t.createElement($.Z,{className:"segment"},t.createElement(j.Z,null,t.createElement(A.Z,{imgSrc:"./pics/buttons/polygon.png",active:F.curr=="polygon",disabled:M.active,onClick:function(){if(!W.curr){ae.default.error(o("chooseCategoryFirst"));return}F.setCurr("polygon"),O(void 0)}},o("polygon")),t.createElement(A.Z,{active:F.curr=="editor",disabled:M.active,imgSrc:"./pics/buttons/edit.png",onClick:function(){F.setCurr("editor")}},o("edit")),t.createElement(T.Z,{imgSrc:"./pics/buttons/brush.png",size:Be,active:F.curr=="brush",disabled:M.active,onClick:function(){if(!W.curr){ae.default.error(o("chooseCategoryFirst"));return}F.curr!="rubber"&&F.curr!="brush"&&O(void 0),F.setCurr("brush")},onChange:function(n){n>=1&&_e(n)}},o("brush")),t.createElement(T.Z,{size:Be,active:F.curr=="rubber",disabled:C&&M.active||!((u=d.all)!==null&&u!==void 0&&u.length),onClick:function(){F.curr!="rubber"&&F.curr!="brush"&&O(void 0),F.setCurr("rubber")},onChange:function(n){_e(n)},imgSrc:"./pics/buttons/rubber.png"},o("rubber")),t.createElement(A.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){Ae.change(.1)}},o("zoomIn")),t.createElement(A.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){Ae.change(-.1)}},o("zoomOut")),t.createElement(A.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var n;d.pushToBackend((n=p.curr)===null||n===void 0?void 0:n.dataId)},disabled:M.active},o("save")),t.createElement(A.Z,{active:F.curr=="mover",imgSrc:"./pics/buttons/move.png",onClick:function(){F.curr=="mover"?M.active?F.setCurr("interactor"):F.setCurr(void 0):F.setCurr("mover")}},o("move")),t.createElement(A.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){ge.backward().then(function(n){if(n){var v;d.setAll(n.annos),O(n.currAnno),d.pushToBackend((v=p.curr)===null||v===void 0?void 0:v.dataId,n.annos)}})},disabled:M.active},o("unDo")),t.createElement(A.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){ge.forward().then(function(n){if(n){var v;d.pushToBackend((v=p.curr)===null||v===void 0?void 0:v.dataId,n.annos),O(n.currAnno)}})},disabled:M.active},o("reDo")),t.createElement(A.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){d.setCurr(void 0),d.clear(),ge.record({annos:[]}),V(null),L([]),F.setCurr(void 0),W.setCurr(void 0)},disabled:M.active},o("clearMark"))),t.createElement("div",{id:"dr",className:"mainStage"},t.createElement(Re.Z,{tip:"loading",spinning:!!Oe.curr},t.createElement("div",{className:"draw"},t.createElement(je.Z,{ref:me,scale:Ae.curr,taskIndex:ke.currIdx,scaleChange:Ae.setScale,annotations:re=="label"?d.all:Le||[],currentTool:F.curr,labels:W.all,tool:F,currentAnnotation:d.curr,currentLabel:W.curr,setCurrentAnnotation:O,onAnnotationModify:dt,onAnnotationModifyUP:on,onAnnotationModifyComplete:function(){!M.active},onMousepoint:function(){Kt(!lt)},onMousepoint2:function(){_t(!Qt)},annotationDelete:an,frontendIdOps:{frontendId:h,setFrontendId:l},imgSrc:p.imgSrc,transparency:We,threshold:Ve,onAnnotationAdd:function(n){var v=d.all.concat([n]);d.setAll(v),d.curr||O(n)},drawTool:ln,refresh:qt,brushSize:Be})),t.createElement("div",{className:"prevTask","data-test-id":"prevTask",onClick:function(){var n,v=ke.prevTask();!v||(O(void 0),V(null),L([]),me==null||(n=me.current)===null||n===void 0||n.setDragEndPos({x:0,y:0}))}}),t.createElement("div",{className:"nextTask","data-test-id":"nextTask",onClick:function(){var n,v=ke.nextTask();!v||(O(void 0),V(null),L([]),me==null||(n=me.current)===null||n===void 0||n.setDragEndPos({x:0,y:0}))}})),t.createElement("div",{className:"pblock"},t.createElement(yt.Z,{task:ke,project:Se}))),t.createElement(j.Z,{disLoc:"right"},t.createElement(A.Z,{imgSrc:"./pics/buttons/data_division.png",disabled:M.active,onClick:function(){B.m8.push("/project_overview?projectId=".concat(Se.curr.projectId))}},o("projectOverview")),t.createElement(kt,{imgSrc:"./pics/buttons/intelligent_interaction.png",active:M.active,onClick:(0,Pe.Z)((0,Q.Z)().mark(function m(){var n,v,I,P,k,z;return(0,Q.Z)().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(!Fe.loading){R.next=3;break}return ae.default.error(o("modelLoading")),R.abrupt("return");case 3:if(!M.active){R.next=8;break}F.setCurr(void 0),Xe({active:!1,predictData:[],mousePoints:[]}),R.next=20;break;case 8:return k=Se.curr.otherSettings?Se.curr.otherSettings:{},z={model_path:k==null||(n=k.modelSettings)===null||n===void 0||(v=n.EISeg)===null||v===void 0?void 0:v.modelFilePath,param_path:k==null||(I=k.modelSettings)===null||I===void 0||(P=I.EISeg)===null||P===void 0?void 0:P.paramFilePath},R.prev=10,R.next=13,Fe.load("EISeg",z);case 13:R.next=18;break;case 15:return R.prev=15,R.t0=R.catch(10),R.abrupt("return");case 18:F.setCurr("interactor"),Xe({active:!0,predictData:[],mousePoints:[]});case 20:case"end":return R.stop()}},m,null,[[10,15]])})),model:Fe,project:Se},o("interactor")),t.createElement(T.Z,{disabled:!M.active,imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:Ve,maxSize:1,minSize:.1,step:.1,onChange:function(n){zt(n)}},o("segmentThreshold")),t.createElement(T.Z,{disabled:!M.active,imgSrc:"./pics/buttons/radius.png",disLoc:"left",size:Xt,maxSize:50,minSize:5,step:5,onChange:function(n){xt(n)}},o("visualRadius")),t.createElement(T.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:We,maxSize:100,minSize:0,disabled:M.active,onChange:function(n){Wt(n)}},o("transparency")),!C&&t.createElement(le,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:We,maxSize:100,minSize:0,disabled:M.active,onChange:un},o("colorMode"))),t.createElement("div",{className:"rightSideBar"},!C&&t.createElement("div",{className:"determinOutline"},t.createElement(G.Z,{disabled:C,style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){ut()}},o("determineOutline"))),t.createElement(ie.Z,{hideColorPicker:!1,labels:W.all,activeIds:W.activeIds,onLabelSelect:W.onSelect,onLabelDelete:W.remove,onLabelAdd:function(n){W.create((0,oe.Z)((0,oe.Z)({},n),{},{projectId:Se.curr.projectId})).then(function(v){O(void 0),W.setCurr(v)})}}),C?t.createElement(Ze.Z,{currAnnotation:d.curr,annotations:re=="label"?d.all:Le||[],onAnnotationSelect:function(n){n!=null&&n.delete||O(n)},onAnnotationAdd:function(){O(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(){var m=(0,Pe.Z)((0,Q.Z)().mark(function n(v){var I,P;return(0,Q.Z)().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return P=d.all.filter(function(he){return he.frontendId!=v.frontendId}),ge.record({annos:P}),d.setAll(P),O(void 0),z.next=6,d.pushToBackend((I=p.curr)===null||I===void 0?void 0:I.dataId,P);case 6:case"end":return z.stop()}},n)}));return function(n){return m.apply(this,arguments)}}(),disabled:M.active}):t.createElement(Ze.Z,{currAnnotation:K,currAnnotations:d.curr,annotations:D,onAnnotationSelect:function(n){n!=null&&n.delete||V(n)},onAnnotationAdd:function(){O(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(){var m=(0,Pe.Z)((0,Q.Z)().mark(function n(v){var I,P,k;return(0,Q.Z)().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return P=d.all.filter(function(R){return R.frontendId!=v.frontendId}),k=D.filter(function(R){return R.frontendId!=v.frontendId}),ge.record({annos:P}),d.setAll(P),L(k),O(void 0),he.next=8,d.pushToBackend((I=p.curr)===null||I===void 0?void 0:I.dataId,P);case 8:case"end":return he.stop()}},n)}));return function(n){return m.apply(this,arguments)}}(),disabled:M.active})))},Rt=Dt}}]);

(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[18],{72285:function(se){se.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},59519:function(se,q,i){"use strict";i.d(q,{Z:function(){return he}});var N=i(11849),E=i(67294),ee=i(65031),z=i(57406);function Ee(n){if(!(!n||n.length<2))return n.join(",")}var W={x:0,y:0},L={x:0,y:0},M=!1;function r(n,c,P){console.log("drawGuidewires\u51FD\u6570\u6267\u884C\u4E86"),P.save(),P.strokeStyle="rgba(0,0,230,0.9)",P.lineWidth=.8,Y(n,P),X(c,P),P.restore()}function X(n,c){c.beginPath(),c.moveTo(0,n+.5),c.lineTo(c.canvas.width,n+.5),c.stroke()}function Y(n,c){c.beginPath(),c.moveTo(n+.5,0),c.lineTo(n+.5,c.canvas.height),c.stroke()}function Pe(n){var c,P=0;if(n.annotation.type=="ocr_rectangle"){var V,ne=(V=n.annotation.result)===null||V===void 0?void 0:V.split("||")[0],J=ne&&ne.split("|").join(",");P=J==null?void 0:J.split(",").length}else{var R,s;P=n==null||(R=n.annotation)===null||R===void 0||(s=R.result)===null||s===void 0?void 0:s.split(",").length}if(P&&P<4)return E.createElement(E.Fragment,null);var v=n.annotation;if(!v||!v.result||!v.label||!v.label.color||!v.annotationId)return E.createElement(E.Fragment,null);var g=[];if(v.type=="ocr_rectangle"){var p,D=(p=v.result)===null||p===void 0?void 0:p.split("||")[0],T=D&&D.split("|").join(",");g=T.split(",")}else g=v.result.split(",");var _={xmin:parseInt(g[0]),ymin:parseInt(g[1]),xmax:g.length>=3?parseInt(g[2]):void 0,ymax:g.length>=4?parseInt(g[3]):void 0},U=v.label.color,B=(0,z.oo)(U);if(!B)return E.createElement(E.Fragment,null);var Q=((c=n.currentAnnotation)===null||c===void 0?void 0:c.frontendId)==v.frontendId,ve=Q?.5:.2,le=_.xmax!=null&&_.ymax!=null?E.createElement(ee.UL,{onMouseOver:function(){n.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){(n.currentTool==="editor"||n.currentTool==="mover")&&n.onSelect(v)},stroke:U,strokeWidth:2/n.scale,globalCompositeOperation:"source-over",lineCap:"round",x:_.xmin,y:_.ymin,width:_.xmax-_.xmin,height:_.ymax-_.ymin,closed:!0,fill:"rgba(".concat(B.r,", ").concat(B.g,", ").concat(B.b,", ").concat(ve,")")}):E.createElement(E.Fragment,null);function te(k){return!k&&(_.xmax==null||_.ymax==null)?E.createElement(E.Fragment,null):E.createElement(ee.Cd,{onMouseDown:function(){n.currentTool=="editor"&&n.onSelect(v)},onMouseOver:function(){var w;n.currentTool=="editor"&&(w=n.stageRef)!==null&&w!==void 0&&w.current&&(n.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var w;(w=n.stageRef)!==null&&w!==void 0&&w.current&&(n.stageRef.current.container().style.cursor="default")},x:k?_.xmin:_.xmax,y:k?_.ymin:_.ymax,radius:5/n.scale,fill:U})}return E.createElement(ee.ZA,{key:v.annotationId},le,te(!0),te(!1))}function he(n){var c=function(s,v,g){var p,D=Ee([s,v]);if(!(!D||!n.dataId)){var T={dataId:n.dataId,type:"rectangle",frontendId:(0,z.pL)(n.annotations)+1,label:n.currentLabel,labelId:(p=n.currentLabel)===null||p===void 0?void 0:p.labelId};if(g==="/optical_character_recognition"){var _=D.split(",").join("|"),U=_+"||\u5F85\u8BC6\u522B|0|";T.result=U,T.type="ocr_rectangle"}else T.result=D;n.onAnnotationAdd(T)}},P=function(s,v,g){var p;if(!(!n.currentAnnotation||!n.currentAnnotation.result||!((p=n.currentLabel)!==null&&p!==void 0&&p.color))){var D="";if(g==="/optical_character_recognition"){var T,_=(T=n.currentAnnotation.result)===null||T===void 0?void 0:T.split("||"),U=_&&_[0].split("|");if(U.length<4)D=U.join("|")+"|".concat(s,"|").concat(v)+"||"+_[1];else{var B=U;B[2]=s+"",B[3]=v+"",D=B.join("|")+"||"+_[1]}}else if(n.currentAnnotation.result.length<4)D=n.currentAnnotation.result+",".concat(s,",").concat(v);else{var Q=n.currentAnnotation.result.split(",");Q[2]=s+"",Q[3]=v+"",D=Q.join(",")}var ve=(0,N.Z)((0,N.Z)({},n.currentAnnotation),{},{result:D});n.onAnnotationModify(ve),n.onMouseUp&&n.onMouseUp()}},V=function(s){if(n.currentTool==="rectangle"||n.currentTool==="editor"){M=!0;var v=s.mouseX+s.offsetX,g=s.mouseY+s.offsetY;W.x=s.mouseX,W.y=s.mouseY,n.currentAnnotation||c(v,g,s.pathName),n.onMouseDown&&n.onMouseDown()}},ne=function(s){n.currentTool!="rectangle"&&M!==!0||(L.x=s.mouseX,L.y=s.mouseY)},J=function(s){if(!(n.currentTool!="rectangle"&&n.currentTool!="editor"&&M)){M=!1;var v=s.mouseX+s.offsetX,g=s.mouseY+s.offsetY;P(v,g,s==null?void 0:s.pathName)}};return{onMouseDown:V,onMouseMove:ne,onMouseUp:J,drawAnnotation:Pe,drawGuidewires:r}}},74333:function(se,q,i){"use strict";i.r(q);var N=i(11849),E=i(20228),ee=i(11382),z=i(86582),Ee=i(34792),W=i(48086),L=i(91220),M=i(2824),r=i(67294),X=i(51505),Y=i(48971),Pe=i(72285),he=i.n(Pe),n=i(8088),c=i(61541),P=i(44434),V=i(5041),ne=i(57436),J=i(84420),R=i.n(J),s=i(28271),v=i(14836),g=i(83721),p=i(59519),D=i(10137),T=i(36505),_=i(27992),U=window.location.port=="8000"?"1234":window.location.port,B="http://".concat(window.location.hostname,":").concat(U,"/"),Q=function(){var le,te,k,oe,w=(0,r.useState)(0),Le=(0,M.Z)(w,2),pe=Le[0],ae=Le[1],Fe=(0,r.useState)(!0),Te=(0,M.Z)(Fe,2),be=Te[0],ye=Te[1],Ne=(0,r.useState)(!0),Se=(0,M.Z)(Ne,2),fe=Se[0],Ue=Se[1],Ze=(0,Y.tT)("InteractorData"),K=Ze.interactorData,_e=Ze.setInteractorData,ze=(0,r.useState)(.9),Re=(0,M.Z)(ze,2),Me=Re[0],Ge=Re[1],He=(0,r.useState)(!1),Be=(0,M.Z)(He,2),re=Be[0],Ae=Be[1],Xe=(0,r.useState)(),ke=(0,M.Z)(Xe,2),m=ke[0],Ye=ke[1],Ve=(0,r.useState)(!1),je=(0,M.Z)(Ve,2),We=je[0],ie=je[1],G=(0,g.RZ)(r.useState,B),$=(0,r.useRef)(null),A=(0,T.I)("pages.toolBar"),x=(0,g.$L)(r.useState,r.useEffect,{effectTrigger:{postTaskChange:function(e,t){ue.init({annos:t})}},label:{oneHot:!0,postSelect:function(){o.setCurr(void 0),ae(0)},preUnsetCurr:qe},tool:{defaultTool:"mover"},task:{push:!1}}),Z=x.tool,Je=x.loading,de=x.scale,o=x.annotation,me=x.task,b=x.data,I=x.project,C=x.label,ue=x.annHistory,Qe=R()(b.imgSrc||"","anonymous"),$e=(0,M.Z)(Qe,1),ge=$e[0];function qe(){o.setCurr(void 0),ae(0),Z.setCurr("mover")}var h=function(e){o.setCurr(e),e!=null&&e.frontendId?ae(e.frontendId):ae(0)},De=function(e){var t=[],l=(0,L.Z)(o.all),d;try{for(l.s();!(d=l.n()).done;){var u=d.value;if(u.frontendId==e.frontendId){var f,O=e==null||(f=e.result)===null||f===void 0?void 0:f.split(",").map(function(y){return Number(y)}),j=(O[2]-O[0])*(O[3]-O[1]);Math.abs(j)>10&&(t.push(e),h(e))}else t.push(u)}}catch(y){l.e(y)}finally{l.f()}o.setAll(t),o.update(e)},we=function(e){var t=[],l=(0,L.Z)(o.all),d;try{for(l.s();!(d=l.n()).done;){var u=d.value;u.frontendId==e.frontendId?t.push(e):t.push(u)}}catch(f){l.e(f)}finally{l.f()}h(e),o.setAll(t),o.update(e)},en=function(){ye(!0)},nn=function(){ye(!1)},tn=function(){var e,t,l;if(ue.record({annos:o.all,currAnno:o.curr}),!!o.curr&&!!o.curr.result){var d=o.all.length-1,u=o.all[d];if(u&&(u==null||(e=u.result)===null||e===void 0?void 0:e.split(",").length)===2){var f,O=u==null?void 0:u.result.split(",").concat(o==null||(f=o.curr)===null||f===void 0?void 0:f.result.split(","));o.curr.result=O.join(",")}if((o==null||(t=o.curr)===null||t===void 0?void 0:t.result.split(",").length)<3){h(void 0);return}(o==null||(l=o.curr)===null||l===void 0?void 0:l.annotationId)==null?o.create(o==null?void 0:o.curr):o.update(o==null?void 0:o.curr),W.default.success(A("saveSuccess")),Z.curr=="rectangle"&&h(void 0)}},on={dataId:(le=b.curr)===null||le===void 0?void 0:le.dataId,currentLabel:C.curr,scale:de.curr,currentTool:Z.curr,annotations:o.all,currentAnnotation:o.curr,onAnnotationAdd:function(e){var t=o.all.concat([e]);o.setAll(t),h(e)},onAnnotationModify:De,onDragUP:we,modifyAnnoByFrontendId:De,onMouseUp:nn,onMouseDown:en,frontendIdOps:{frontendId:pe,setFrontendId:ae},pathName:Y.m8===null||Y.m8===void 0||(te=Y.m8.location)===null||te===void 0?void 0:te.pathname},an=(0,p.Z)(on),rn={rectangle:an,brush:void 0},ln=function(e){var t=o.all,l=e.annotationId,d=t.find(function(f){return f.annotationId===l});if(d){var u=t.indexOf(d);t.splice(u,1),t.push(d),o.setAll(t)}},dn=function(e){if(!e||e.length==0)return 0;var t=0,l=(0,L.Z)(e),d;try{for(l.s();!(d=l.n()).done;){var u=d.value;u.frontendId>t&&(t=u.frontendId)}}catch(f){l.e(f)}finally{l.f()}return t},un=function(e){if(!e)return"";var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var l=t.getContext("2d");l==null||l.drawImage(e,0,0,e.width,e.height);var d=t.toDataURL("image/png");return d.replace(/^data:image\/(png|jpg);base64,/,"")},Ke=function(e){var t=un(e),l=Me||.5,d=G.predict("PicoDet",{format:"b64",img:t});!d||d.then(function(u){if(u){var f,O=u.predictions.map(function(j){if(j.score>l)return j});Ae(!1),b.updatePredicted((f=b.all[0])===null||f===void 0?void 0:f.dataId,!0),_e({active:!0,mousePoints:K.mousePoints,predictData:O})}},function(u){alert("error",u),G.setLoading(!1)})},cn=function(e){var t=(0,z.Z)(e).map(function(l){var d={name:l,projectId:I.curr.projectId};return d});t.length>0&&C.create(t).then(function(l){h(void 0),C.setCurr(l),ie(!0)})};return(0,X.Z)(function(){if(b.all.length>0)if(b.all[0].predicted){var a=!1;a!==re&&Ae(a)}else{var e=!0;e!==re&&Ae(e)}},[b.all]),(0,r.useEffect)(function(){be||tn()},[be]),(0,X.Z)(function(){var a,e;if(re&&(a=I.curr)!==null&&a!==void 0&&(e=a.otherSettings)!==null&&e!==void 0&&e.labelMapping){var t;if(G.loading){W.default.error(A("modelLoading"));return}var l=(t=I.curr)!==null&&t!==void 0&&t.otherSettings?I.curr.otherSettings:{};G.setMlBackendUrl(l.mlBackendUrl||""),G.setLoading(!0),G.load(l.modelName).then(function(){G.setLoading(!1),fe&&Ue(!1)},function(){G.setLoading(!1),fe||Ue(!0)})}else{var d;Ye((d=I.curr)===null||d===void 0?void 0:d.otherSettings)}},[re,(k=I.curr)===null||k===void 0?void 0:k.otherSettings]),(0,X.Z)(function(){var a=!fe&&ge&&re;a&&Ke(ge)},[fe,re,ge]),(0,X.Z)(function(){if(K.predictData.length&&m!==null&&m!==void 0&&m.labelMapping&&C.all){var a,e=new Set,t=new Map,l=(0,L.Z)(C.all),d;try{for(l.s();!(d=l.n()).done;){var u=d.value;u.name&&t.set(u.name,u)}}catch(H){l.e(H)}finally{l.f()}if((m==null||(a=m.labelMapping)===null||a===void 0?void 0:a.length)>0){var f=(0,L.Z)(m==null?void 0:m.labelMapping),O;try{for(f.s();!(O=f.n()).done;){var j=O.value;t.has(j.project)||e.add(j.project)}}catch(H){f.e(H)}finally{f.f()}}else{var y=(0,L.Z)(K.predictData),ce;try{for(y.s();!(ce=y.n()).done;){var S=ce.value;S&&!t.has(S==null?void 0:S.label_name)&&e.add(S==null?void 0:S.label_name)}}catch(H){y.e(H)}finally{y.f()}(0,z.Z)(e).length&&cn(e)}(0,z.Z)(e).length||ie(!0)}},[K,m]),(0,X.Z)(function(){var a;if(K.predictData.length&&((a=I.curr)===null||a===void 0?void 0:a.projectId)!==void 0&&m!==null&&m!==void 0&&m.labelMapping&&We){var e=new Map;C.getAll(I.curr.projectId).then(function(t){var l,d,u=(0,L.Z)(t),f;try{for(u.s();!(f=u.n()).done;){var O=f.value;e.set(O.name,O)}}catch(F){u.e(F)}finally{u.f()}var j=[],y=new Map,ce=(l=o.all)!==null&&l!==void 0&&l.length?dn(o.all)+1:1;if((m==null||(d=m.labelMapping)===null||d===void 0?void 0:d.length)>0){var S=(0,L.Z)(m.labelMapping),H;try{for(S.s();!(H=S.n()).done;){var xe=H.value;y.set(xe.model,xe.project)}}catch(F){S.e(F)}finally{S.f()}}K.predictData.map(function(F){if(F){var Ie="";y.has(F.label_name)?Ie=y.get(F.label_name):Ie=F.label_name;var vn=e.get(Ie),fn=F.result,_n=m.modelName;if(K.active){var Ce,Oe=(0,s.tx)(ce,fn,(Ce=b.curr)===null||Ce===void 0?void 0:Ce.dataId,vn,_n);Oe.type="rectangle",Oe&&(j.push(Oe),ce++)}}});var sn=!0;o.create(j,"",sn),_e({active:!1,predictData:[],mousePoints:[]}),ie(!1)})}},[I==null||(oe=I.curr)===null||oe===void 0?void 0:oe.projectId,K.predictData,m,We]),r.createElement(n.Z,{className:he().det},r.createElement(P.Z,null,r.createElement(c.Z,{imgSrc:"./pics/buttons/rectangle.png",active:Z.curr=="rectangle",onClick:function(){if(!C.curr){W.default.error(A("chooseCategoryFirst"));return}Z.setCurr("rectangle"),h(void 0)}},A("rectangle")),r.createElement(c.Z,{active:Z.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){Z.setCurr("editor")}},A("edit")),r.createElement(c.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){de.change(.1)}},A("zoomIn")),r.createElement(c.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){de.change(-.1)}},A("zoomOut")),r.createElement(c.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var e;o.pushToBackend((e=b.curr)===null||e===void 0?void 0:e.dataId)}},A("save")),r.createElement(c.Z,{imgSrc:"./pics/buttons/move.png",active:Z.curr=="mover",onClick:function(){Z.setCurr("mover")}},A("move")),r.createElement(c.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){ue.backward().then(function(e){if(e){var t;o.setAll(e.annos),h(e.currAnno),o.pushToBackend((t=b.curr)===null||t===void 0?void 0:t.dataId,e.annos)}})}},A("unDo")),r.createElement(c.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){ue.forward().then(function(e){if(e){var t;o.pushToBackend((t=b.curr)===null||t===void 0?void 0:t.dataId,e.annos),h(e.currAnno)}})}},A("reDo")),r.createElement(c.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){o.clear(),ue.record({annos:[]}),Z.setCurr(void 0),C.setCurr(void 0)}},A("clearMark"))),r.createElement("div",{id:"dr",className:"mainStage"},r.createElement(ee.Z,{tip:"loading",spinning:!!Je.curr},r.createElement("div",{className:"draw"},r.createElement(ne.Z,{ref:$,taskIndex:me.currIdx,scale:de.curr,scaleChange:de.setScale,annotations:o.all,currentTool:Z.curr,currentAnnotation:o.curr,setCurrentAnnotation:h,onAnnotationModify:De,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:pe,setFrontendId:ae},imgSrc:b.imgSrc,transparency:100,onAnnotationAdd:function(e){var t=o.all.concat([e]);o.setAll(t)},drawTool:rn,threshold:0,onAnnotationModifyUP:we})),r.createElement("div",{className:"pblock"},r.createElement(D.Z,{task:me,project:I})),r.createElement("div",{className:"prevTask","data-test-id":"prevTask",onClick:function(){var e;!me.prevTask()||(_e({active:!1,predictData:[],mousePoints:[]}),h(void 0),ie(!1),$==null||(e=$.current)===null||e===void 0||e.setDragEndPos({x:0,y:0}))}}),r.createElement("div",{className:"nextTask","data-test-id":"nextTask",onClick:function(){var e;!me.nextTask()||(_e({active:!1,predictData:[],mousePoints:[]}),h(void 0),ie(!1),$==null||(e=$.current)===null||e===void 0||e.setDragEndPos({x:0,y:0}))}}))),r.createElement(P.Z,{disLoc:"right"},r.createElement(c.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){Y.m8.push("/project_overview?projectId=".concat(I.curr.projectId))}},A("projectOverview")),r.createElement(c.Z,{imgSrc:"./pics/buttons/intelligent_interaction.png",disabled:!(m!=null&&m.labelMapping),onClick:function(){Ke(ge)}},A("autoInference")),r.createElement(_.Z,{disabled:K.active,imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:Me,maxSize:1,minSize:.1,step:.1,onChange:function(e){Ge(e)}},A("autoInferenceThreshold"))),r.createElement("div",{className:"rightSideBar"},r.createElement(V.Z,{labels:C.all,activeIds:C.activeIds,onLabelSelect:C.onSelect,onLabelDelete:C.remove,disabled:!1,onLabelAdd:function(e){C.create((0,N.Z)((0,N.Z)({},e),{},{projectId:I.curr.projectId})).then(function(t){h(void 0),C.setCurr(t)})}}),r.createElement(v.Z,{disabled:!1,type:"Detection",currAnnotation:o.curr,annotations:o.all,onAnnotationSelect:function(e){e!=null&&e.delete||h(e),ln(e)},onAnnotationAdd:function(){console.log("onAnnotationAdd"),h(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(e){o.setAll(o.all.filter(function(t){return t.frontendId!=e.frontendId})),h(void 0),o.remove(e)}})))};q.default=Q},51505:function(se,q,i){"use strict";i.d(q,{Z:function(){return z}});var N=i(67294),E=function(W){return function(L,M){var r=(0,N.useRef)(!1);W(function(){return function(){r.current=!1}},[]),W(function(){if(!r.current)r.current=!0;else return L()},M)}},ee=null,z=E(N.useEffect)}}]);

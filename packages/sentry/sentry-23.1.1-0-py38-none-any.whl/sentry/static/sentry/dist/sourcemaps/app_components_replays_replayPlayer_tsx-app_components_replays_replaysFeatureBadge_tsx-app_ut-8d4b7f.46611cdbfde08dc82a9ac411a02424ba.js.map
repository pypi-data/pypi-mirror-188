{"version":3,"file":"chunks/app_components_replays_replayPlayer_tsx-app_components_replays_replaysFeatureBadge_tsx-app_ut-8d4b7f.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/replays/player/bufferingOverlay.tsx","webpack:///./app/components/replays/player/fastForwardBadge.tsx","webpack:///./app/components/replays/playerDOMAlert.tsx","webpack:///./app/components/replays/replayPlayer.tsx","webpack:///./app/components/replays/replaysFeatureBadge.tsx","webpack:///./app/utils/replays/replayReader.tsx","webpack:///./app/utils/replays/hooks/useReplayData.tsx","webpack:///./app/views/replays/detail/layout/fluidHeight.tsx"],"sourcesContent":["import styled from '@emotion/styled';\n\nimport {IconClock} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport space from 'sentry/styles/space';\n\ntype Props = {\n  className?: string;\n};\n\nfunction BufferingOverlay({className}: Props) {\n  return (\n    <Overlay className={className}>\n      <Message>\n        <IconClock size=\"sm\" />\n        {t('Buffering...')}\n      </Message>\n    </Overlay>\n  );\n}\n\n/* Position the badge in the corner */\nconst Overlay = styled('div')`\n  user-select: none;\n  display: grid;\n  place-items: center;\n`;\n\n/* Badge layout and style */\nconst Message = styled('div')`\n  display: grid;\n  grid-template-columns: max-content max-content;\n  gap: ${space(0.75)};\n  place-items: center;\n\n  padding: ${space(3)};\n  background: ${p => p.theme.gray300};\n  border-radius: ${p => p.theme.borderRadius};\n  color: ${p => p.theme.white};\n  z-index: ${p => p.theme.zIndex.initial};\n`;\n\nexport default BufferingOverlay;\n","import styled from '@emotion/styled';\n\nimport {Tooltip} from 'sentry/components/tooltip';\nimport {IconArrow} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport space from 'sentry/styles/space';\n\ntype Props = {\n  speed: number;\n  className?: string;\n};\n\nfunction FastForwardBadge({speed, className}: Props) {\n  return (\n    <Badge className={className}>\n      <FastForwardTooltip title={t('Fast forwarding at %sx', speed)}>\n        {t('Fast forwarding through inactivity')}\n        <IconArrow size=\"sm\" direction=\"right\" />\n      </FastForwardTooltip>\n    </Badge>\n  );\n}\n\n/* Position the badge in the corner */\nconst Badge = styled('div')`\n  user-select: none;\n  display: grid;\n  align-items: end;\n  justify-items: start;\n`;\n\n/* Badge layout and style */\nconst FastForwardTooltip = styled(Tooltip)`\n  display: grid;\n  grid-template-columns: max-content max-content;\n  gap: ${space(0.5)};\n  align-items: center;\n\n  background: ${p => p.theme.gray300};\n  color: ${p => p.theme.white};\n  padding: ${space(1.5)} ${space(2)};\n  border-top-right-radius: ${p => p.theme.borderRadius};\n  z-index: ${p => p.theme.zIndex.initial};\n`;\n\nexport default FastForwardBadge;\n","import {useEffect, useState} from 'react';\nimport styled from '@emotion/styled';\n\nimport {Button} from 'sentry/components/button';\nimport {IconClose, IconInfo} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport localStorage from 'sentry/utils/localStorage';\n\nconst LOCAL_STORAGE_KEY = 'replay-player-dom-alert-dismissed';\n\nfunction PlayerDOMAlert() {\n  const [isDismissed, setIsDismissed] = useState(true);\n\n  const handleDismiss = () => {\n    localStorage.setItem(LOCAL_STORAGE_KEY, '1');\n    setIsDismissed(true);\n  };\n\n  useEffect(() => {\n    const val = localStorage.getItem(LOCAL_STORAGE_KEY);\n    setIsDismissed(val === '1');\n  }, []);\n\n  if (isDismissed) {\n    return null;\n  }\n\n  return (\n    <DOMAlertContainer data-test-id=\"player-dom-alert\">\n      <DOMAlert>\n        <IconInfo size=\"xs\" />\n        {t(\"Right click & inspect your app's DOM\")}\n        <DismissButton\n          priority=\"link\"\n          size=\"sm\"\n          icon={<IconClose size=\"xs\" />}\n          aria-label={t('Close Alert')}\n          onClick={handleDismiss}\n        />\n      </DOMAlert>\n    </DOMAlertContainer>\n  );\n}\n\nexport default PlayerDOMAlert;\n\nconst DOMAlertContainer = styled('div')`\n  position: absolute;\n  bottom: ${space(1)};\n  left: 0;\n  width: 100%;\n  text-align: center;\n  font-size: ${p => p.theme.fontSizeMedium};\n  pointer-events: none;\n`;\n\nconst DOMAlert = styled('div')`\n  display: inline-flex;\n  align-items: center;\n  justify-items: center;\n  padding: ${space(1)} ${space(2)};\n  margin: 0 ${space(1)};\n  color: ${p => p.theme.white};\n  background-color: ${p => p.theme.blue400};\n  border-radius: ${p => p.theme.borderRadius};\n  gap: 0 ${space(1)};\n  line-height: 0;\n`;\n\nconst DismissButton = styled(Button)`\n  color: ${p => p.theme.white};\n  pointer-events: all;\n  &:hover {\n    color: ${p => p.theme.white};\n    opacity: 0.5;\n  }\n`;\n","import {useCallback, useEffect, useRef, useState} from 'react';\nimport styled from '@emotion/styled';\nimport {useResizeObserver} from '@react-aria/utils';\n\nimport {Panel as _Panel} from 'sentry/components/panels';\nimport BufferingOverlay from 'sentry/components/replays/player/bufferingOverlay';\nimport FastForwardBadge from 'sentry/components/replays/player/fastForwardBadge';\nimport {useReplayContext} from 'sentry/components/replays/replayContext';\nimport trackAdvancedAnalyticsEvent from 'sentry/utils/analytics/trackAdvancedAnalyticsEvent';\nimport useOrganization from 'sentry/utils/useOrganization';\n\nimport PlayerDOMAlert from './playerDOMAlert';\n\ntype Dimensions = ReturnType<typeof useReplayContext>['dimensions'];\n\ninterface Props {\n  className?: string;\n  isPreview?: boolean;\n}\n\nfunction useVideoSizeLogger({\n  videoDimensions,\n  windowDimensions,\n}: {\n  videoDimensions: Dimensions;\n  windowDimensions: Dimensions;\n}) {\n  const organization = useOrganization();\n  const [didLog, setDidLog] = useState<boolean>(false);\n  useEffect(() => {\n    if (didLog || (videoDimensions.width === 0 && videoDimensions.height === 0)) {\n      return;\n    }\n\n    const aspect_ratio =\n      videoDimensions.width > videoDimensions.height ? 'landscape' : 'portrait';\n\n    const scale = Math.min(\n      windowDimensions.width / videoDimensions.width,\n      windowDimensions.height / videoDimensions.height,\n      1\n    );\n    const scale_bucket = (Math.floor(scale * 10) * 10) as Parameters<\n      typeof trackAdvancedAnalyticsEvent<'replay.render-player'>\n    >[1]['scale_bucket'];\n\n    trackAdvancedAnalyticsEvent('replay.render-player', {\n      organization,\n      aspect_ratio,\n      scale_bucket,\n    });\n    setDidLog(true);\n  }, [organization, windowDimensions, videoDimensions, didLog]);\n}\n\nfunction BasePlayerRoot({className, isPreview = false}: Props) {\n  const {\n    initRoot,\n    dimensions: videoDimensions,\n    fastForwardSpeed,\n    isBuffering,\n  } = useReplayContext();\n\n  const windowEl = useRef<HTMLDivElement>(null);\n  const viewEl = useRef<HTMLDivElement>(null);\n\n  const [windowDimensions, setWindowDimensions] = useState<Dimensions>({\n    width: 0,\n    height: 0,\n  });\n\n  useVideoSizeLogger({videoDimensions, windowDimensions});\n\n  // Create the `rrweb` instance which creates an iframe inside `viewEl`\n  useEffect(() => initRoot(viewEl.current), [initRoot]);\n\n  // Read the initial width & height where the player will be inserted, this is\n  // so we can shrink the video into the available space.\n  // If the size of the container changes, we can re-calculate the scaling factor\n  const updateWindowDimensions = useCallback(\n    () =>\n      setWindowDimensions({\n        width: windowEl.current?.clientWidth || 0,\n        height: windowEl.current?.clientHeight || 0,\n      }),\n    [setWindowDimensions]\n  );\n  useResizeObserver({ref: windowEl, onResize: updateWindowDimensions});\n  // If your browser doesn't have ResizeObserver then set the size once.\n  useEffect(() => {\n    if (typeof window.ResizeObserver !== 'undefined') {\n      return;\n    }\n    updateWindowDimensions();\n  }, [updateWindowDimensions]);\n\n  // Update the scale of the view whenever dimensions have changed.\n  useEffect(() => {\n    if (viewEl.current) {\n      const scale = Math.min(\n        windowDimensions.width / videoDimensions.width,\n        windowDimensions.height / videoDimensions.height,\n        1\n      );\n      if (scale) {\n        viewEl.current.style['transform-origin'] = 'top left';\n        viewEl.current.style.transform = `scale(${scale})`;\n        viewEl.current.style.width = `${videoDimensions.width * scale}px`;\n        viewEl.current.style.height = `${videoDimensions.height * scale}px`;\n      }\n    }\n  }, [windowDimensions, videoDimensions]);\n\n  return (\n    <SizingWindow ref={windowEl} className=\"sentry-block\">\n      <div ref={viewEl} className={className} />\n      {fastForwardSpeed ? <PositionedFastForward speed={fastForwardSpeed} /> : null}\n      {isBuffering ? <PositionedBuffering /> : null}\n      {!isPreview ? <PlayerDOMAlert /> : null}\n    </SizingWindow>\n  );\n}\n\n// Center the viewEl inside the windowEl.\n// This is useful when the window is inside a container that has large fixed\n// dimensions, like when in fullscreen mode.\n// If the container has a dimensions that can grow/shrink then it is\n// important to also set `overflow: hidden` on the container, so that the\n// SizingWindow can calculate size as things shrink.\nconst SizingWindow = styled('div')`\n  width: 100%;\n  display: flex;\n  flex-grow: 1;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  overflow: hidden;\n\n  background-color: ${p => p.theme.backgroundSecondary};\n  background-image: repeating-linear-gradient(\n      -145deg,\n      transparent,\n      transparent 8px,\n      ${p => p.theme.backgroundSecondary} 8px,\n      ${p => p.theme.backgroundSecondary} 11px\n    ),\n    repeating-linear-gradient(\n      -45deg,\n      transparent,\n      transparent 15px,\n      ${p => p.theme.gray100} 15px,\n      ${p => p.theme.gray100} 16px\n    );\n`;\n\nconst PositionedFastForward = styled(FastForwardBadge)`\n  position: absolute;\n  left: 0;\n  bottom: 0;\n`;\n\nconst PositionedBuffering = styled(BufferingOverlay)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n`;\n\n// Base styles, to make the Replayer instance work\nconst PlayerRoot = styled(BasePlayerRoot)`\n  .replayer-wrapper {\n    user-select: none;\n  }\n\n  .replayer-wrapper > .replayer-mouse {\n    pointer-events: none;\n  }\n  .replayer-wrapper > .replayer-mouse-tail {\n    position: absolute;\n    pointer-events: none;\n  }\n\n  /* Override default user-agent styles */\n  .replayer-wrapper > iframe {\n    border: none;\n    background: white;\n\n    /* Set pointer-events to make it easier to right-click & inspect */\n    pointer-events: initial !important;\n  }\n`;\n\n// Sentry-specific styles for the player.\n// The elements we have to work with are:\n// ```css\n// div.replayer-wrapper {}\n// div.replayer-wrapper > div.replayer-mouse {}\n// div.replayer-wrapper > canvas.replayer-mouse-tail {}\n// div.replayer-wrapper > iframe {}\n// ```\n// The mouse-tail is also configured for color/size in `app/components/replays/replayContext.tsx`\nconst SentryPlayerRoot = styled(PlayerRoot)`\n  .replayer-mouse {\n    position: absolute;\n    width: 32px;\n    height: 32px;\n    transition: left 0.05s linear, top 0.05s linear;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTkiIHZpZXdCb3g9IjAgMCAxMiAxOSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAgMTZWMEwxMS42IDExLjZINC44TDQuNCAxMS43TDAgMTZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNOS4xIDE2LjdMNS41IDE4LjJMMC43OTk5OTkgNy4xTDQuNSA1LjZMOS4xIDE2LjdaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNNC42NzQ1MSA4LjYxODUxTDIuODMwMzEgOS4zOTI3MUw1LjkyNzExIDE2Ljc2OTVMNy43NzEzMSAxNS45OTUzTDQuNjc0NTEgOC42MTg1MVoiIGZpbGw9ImJsYWNrIi8+CjxwYXRoIGQ9Ik0xIDIuNFYxMy42TDQgMTAuN0w0LjQgMTAuNkg5LjJMMSAyLjRaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K');\n    border-color: transparent;\n  }\n  .replayer-mouse:after {\n    content: '';\n    display: inline-block;\n    width: 32px;\n    height: 32px;\n    background: ${p => p.theme.purple300};\n    border-radius: 100%;\n    transform: translate(-50%, -50%);\n    opacity: 0.3;\n  }\n  .replayer-mouse.active:after {\n    animation: click 0.2s ease-in-out 1;\n  }\n  .replayer-mouse.touch-device {\n    background-image: none;\n    width: 70px;\n    height: 70px;\n    border-radius: 100%;\n    margin-left: -37px;\n    margin-top: -37px;\n    border: 4px solid rgba(73, 80, 246, 0);\n    transition: left 0s linear, top 0s linear, border-color 0.2s ease-in-out;\n  }\n  .replayer-mouse.touch-device.touch-active {\n    border-color: ${p => p.theme.purple200};\n    transition: left 0.25s linear, top 0.25s linear, border-color 0.2s ease-in-out;\n  }\n  .replayer-mouse.touch-device:after {\n    opacity: 0;\n  }\n  .replayer-mouse.touch-device.active:after {\n    animation: touch-click 0.2s ease-in-out 1;\n  }\n  @keyframes click {\n    0% {\n      opacity: 0.3;\n      width: 20px;\n      height: 20px;\n    }\n    50% {\n      opacity: 0.5;\n      width: 10px;\n      height: 10px;\n    }\n  }\n  @keyframes touch-click {\n    0% {\n      opacity: 0;\n      width: 20px;\n      height: 20px;\n    }\n    50% {\n      opacity: 0.5;\n      width: 10px;\n      height: 10px;\n    }\n  }\n`;\n\nexport default SentryPlayerRoot;\n","import FeatureBadge from 'sentry/components/featureBadge';\n\nfunction ReplaysFeatureBadge(\n  props: Omit<React.ComponentProps<typeof FeatureBadge>, 'type'>\n) {\n  return <FeatureBadge {...props} type=\"beta\" />;\n}\n\nexport default ReplaysFeatureBadge;\n","import {duration} from 'moment';\n\nimport type {Crumb} from 'sentry/types/breadcrumbs';\nimport {\n  breadcrumbFactory,\n  getBreadcrumbsByCategory,\n  isMemorySpan,\n  isNetworkSpan,\n  mapRRWebAttachments,\n  replayTimestamps,\n  rrwebEventListFactory,\n  spansFactory,\n} from 'sentry/utils/replays/replayDataUtils';\nimport type {\n  MemorySpanType,\n  RecordingEvent,\n  ReplayError,\n  ReplayRecord,\n  ReplaySpan,\n} from 'sentry/views/replays/types';\n\ninterface ReplayReaderParams {\n  /**\n   * Loaded segment data\n   *\n   * This is a mix of rrweb data, breadcrumbs and spans/transactions sorted by time\n   * All three types are mixed together.\n   */\n  attachments: unknown[] | undefined;\n  errors: ReplayError[] | undefined;\n\n  /**\n   * The root Replay event, created at the start of the browser session.\n   */\n  replayRecord: ReplayRecord | undefined;\n}\n\ntype RequiredNotNull<T> = {\n  [P in keyof T]: NonNullable<T[P]>;\n};\n\nexport default class ReplayReader {\n  static factory({attachments, replayRecord, errors}: ReplayReaderParams) {\n    if (!attachments || !replayRecord || !errors) {\n      return null;\n    }\n\n    return new ReplayReader({attachments, replayRecord, errors});\n  }\n\n  private constructor({\n    attachments,\n    replayRecord,\n    errors,\n  }: RequiredNotNull<ReplayReaderParams>) {\n    const {breadcrumbs, rrwebEvents, spans} = mapRRWebAttachments(attachments);\n\n    // TODO(replays): We should get correct timestamps from the backend instead\n    // of having to fix them up here.\n    const {startTimestampMs, endTimestampMs} = replayTimestamps(\n      replayRecord,\n      rrwebEvents,\n      breadcrumbs,\n      spans\n    );\n    replayRecord.started_at = new Date(startTimestampMs);\n    replayRecord.finished_at = new Date(endTimestampMs);\n    replayRecord.duration = duration(\n      replayRecord.finished_at.getTime() - replayRecord.started_at.getTime()\n    );\n\n    const sortedSpans = spansFactory(spans);\n    this.networkSpans = sortedSpans.filter(isNetworkSpan);\n    this.memorySpans = sortedSpans.filter(isMemorySpan);\n\n    this.breadcrumbs = breadcrumbFactory(replayRecord, errors, breadcrumbs, sortedSpans);\n    this.consoleCrumbs = getBreadcrumbsByCategory(this.breadcrumbs, ['console', 'issue']);\n\n    this.rrwebEvents = rrwebEventListFactory(replayRecord, rrwebEvents);\n\n    this.replayRecord = replayRecord;\n  }\n\n  private replayRecord: ReplayRecord;\n  private rrwebEvents: RecordingEvent[];\n  private breadcrumbs: Crumb[];\n  private consoleCrumbs: ReturnType<typeof getBreadcrumbsByCategory>;\n  private networkSpans: ReplaySpan[];\n  private memorySpans: MemorySpanType[];\n\n  /**\n   * @returns Duration of Replay (milliseonds)\n   */\n  getDurationMs = () => {\n    return this.replayRecord.duration.asMilliseconds();\n  };\n\n  getReplay = () => {\n    return this.replayRecord;\n  };\n\n  getRRWebEvents = () => {\n    return this.rrwebEvents;\n  };\n\n  getRawCrumbs = () => {\n    return this.breadcrumbs;\n  };\n\n  getConsoleCrumbs = () => {\n    return this.consoleCrumbs;\n  };\n\n  getNetworkSpans = () => {\n    return this.networkSpans;\n  };\n\n  getMemorySpans = () => {\n    return this.memorySpans;\n  };\n}\n","import {useCallback, useEffect, useMemo, useState} from 'react';\nimport * as Sentry from '@sentry/react';\nimport chunk from 'lodash/chunk';\n\nimport parseLinkHeader, {ParsedHeader} from 'sentry/utils/parseLinkHeader';\nimport {mapResponseToReplayRecord} from 'sentry/utils/replays/replayDataUtils';\nimport ReplayReader from 'sentry/utils/replays/replayReader';\nimport RequestError from 'sentry/utils/requestError/requestError';\nimport useApi from 'sentry/utils/useApi';\nimport type {ReplayError, ReplayRecord} from 'sentry/views/replays/types';\n\nconst SEGMENTS_PER_PAGE = 50; // p95 is 44 segments\nconst ERRORS_PER_PAGE = 50; // Need to make sure the url is not too large\n\ntype State = {\n  attachments: undefined | unknown[];\n\n  /**\n   * List of errors that occurred during replay\n   */\n  errors: undefined | ReplayError[];\n\n  /**\n   * If any request returned an error then nothing is being returned\n   */\n  fetchError: undefined | RequestError;\n\n  /**\n   * If a fetch is underway for the requested root reply.\n   * This includes fetched all the sub-resources like attachments and `sentry-replay-event`\n   */\n  fetching: boolean;\n\n  /**\n   * The root replay event\n   */\n  replayRecord: undefined | ReplayRecord;\n};\n\ntype Options = {\n  /**\n   * The organization slug\n   */\n  orgSlug: string;\n\n  /**\n   * The projectSlug and replayId concatenated together\n   */\n  replaySlug: string;\n};\n\ninterface Result extends Pick<State, 'fetchError' | 'fetching'> {\n  onRetry: () => void;\n  replay: ReplayReader | null;\n  replayRecord: ReplayRecord | undefined;\n}\n\nconst INITIAL_STATE: State = Object.freeze({\n  attachments: undefined,\n  errors: undefined,\n  fetchError: undefined,\n  fetching: true,\n  replayRecord: undefined,\n});\n\n/**\n * A react hook to load core replay data over the network.\n *\n * Core replay data includes:\n * 1. The root replay EventTransaction object\n *    - This includes `startTimestamp` and `tags` data\n * 2. Breadcrumb and Span data from all the related Event objects\n *    - Data is merged for consumption\n * 3. RRWeb payloads for the replayer video stream\n *    - TODO(replay): incrementally load the stream to speedup pageload\n *\n * This function should stay focused on loading data over the network.\n * Front-end processing, filtering and re-mixing of the different data streams\n * must be delegated to the `ReplayReader` class.\n *\n * @param {orgSlug, replaySlug} Where to find the root replay event\n * @returns An object representing a unified result of the network requests. Either a single `ReplayReader` data object or fetch errors.\n */\nfunction useReplayData({replaySlug, orgSlug}: Options): Result {\n  const [projectSlug, replayId] = replaySlug.split(':');\n\n  const api = useApi();\n  const [state, setState] = useState<State>(INITIAL_STATE);\n\n  // Fetch every field of the replay. We're overfetching, not every field is needed\n  const fetchReplay = useCallback(async () => {\n    const response = await api.requestPromise(\n      `/projects/${orgSlug}/${projectSlug}/replays/${replayId}/`\n    );\n    return response.data;\n  }, [api, orgSlug, projectSlug, replayId]);\n\n  const fetchAllAttachments = useCallback(async () => {\n    const rootUrl = `/projects/${orgSlug}/${projectSlug}/replays/${replayId}/recording-segments/?download&per_page=${SEGMENTS_PER_PAGE}`;\n    const firstFourCursors = [\n      `${SEGMENTS_PER_PAGE}:0:1`,\n      `${SEGMENTS_PER_PAGE}:1:0`,\n      `${SEGMENTS_PER_PAGE}:2:0`,\n      `${SEGMENTS_PER_PAGE}:3:0`,\n    ];\n    const firstFourUrls = firstFourCursors.map(cursor => `${rootUrl}&cursor=${cursor}`);\n\n    const parallelResponses = await Promise.allSettled(\n      firstFourUrls.map(url =>\n        api.requestPromise(url, {\n          includeAllArgs: true,\n        })\n      )\n    );\n\n    const responses: any = parallelResponses.map(resp =>\n      resp.status === 'fulfilled' ? resp.value[0] : []\n    );\n\n    const lastResponse = parallelResponses[firstFourCursors.length - 1];\n    const [_lastData, _lastTextStatus, lastResp] =\n      lastResponse.status === 'fulfilled' ? lastResponse.value : [];\n\n    let next: ParsedHeader = lastResp\n      ? parseLinkHeader(lastResp.getResponseHeader('Link') ?? '').next\n      : {href: rootUrl, results: true, cursor: ''};\n\n    // TODO(replay): It would be good to load the first page of results then\n    // start to render the UI while the next N pages continue to get fetched in\n    // the background.\n    while (next.results) {\n      const url = `${rootUrl}&cursor=${next.cursor}`;\n\n      const [data, _textStatus, resp] = await api.requestPromise(url, {\n        includeAllArgs: true,\n      });\n      responses.push(data);\n      const links = parseLinkHeader(resp?.getResponseHeader('Link') ?? '');\n      next = links.next;\n    }\n\n    // Each response returns an array of segments\n    const segments = responses.flatMap(_ => _);\n    // Each segment includes an array of attachments\n    const attachments = segments.flatMap(_ => _);\n\n    return attachments;\n  }, [api, orgSlug, projectSlug, replayId]);\n\n  const fetchErrors = useCallback(\n    async (replayRecord: ReplayRecord) => {\n      if (!replayRecord.error_ids.length) {\n        return [];\n      }\n\n      // Clone the `finished_at` time and bump it up one second because finishedAt\n      // has the `ms` portion truncated, while replays-events-meta operates on\n      // timestamps with `ms` attached. So finishedAt could be at time `12:00:00.000Z`\n      // while the event is saved with `12:00:00.450Z`.\n      const finishedAtClone = new Date(replayRecord.finished_at);\n      finishedAtClone.setSeconds(finishedAtClone.getSeconds() + 1);\n\n      const chunks = chunk(replayRecord.error_ids, ERRORS_PER_PAGE);\n      const responses = await Promise.allSettled(\n        chunks.map(errorIds =>\n          api.requestPromise(`/organizations/${orgSlug}/replays-events-meta/`, {\n            query: {\n              start: replayRecord.started_at.toISOString(),\n              end: finishedAtClone.toISOString(),\n              query: `id:[${String(errorIds)}]`,\n            },\n          })\n        )\n      );\n\n      return responses.flatMap(resp =>\n        resp.status === 'fulfilled' ? resp.value.data : []\n      );\n    },\n    [api, orgSlug]\n  );\n\n  const fetchReplayAndErrors = useCallback(async (): Promise<[ReplayRecord, any]> => {\n    const fetchedRecord = await fetchReplay();\n    const mappedRecord = mapResponseToReplayRecord(fetchedRecord);\n    setState(prev => ({\n      ...prev,\n      replayRecord: mappedRecord,\n    }));\n    const fetchedErrors = await fetchErrors(mappedRecord);\n    return [mappedRecord, fetchedErrors];\n  }, [fetchReplay, fetchErrors]);\n\n  const loadEvents = useCallback(async () => {\n    setState(INITIAL_STATE);\n\n    try {\n      const [replayAndErrors, attachments] = await Promise.all([\n        fetchReplayAndErrors(),\n        fetchAllAttachments(),\n      ]);\n      const [replayRecord, errors] = replayAndErrors;\n\n      setState(prev => ({\n        ...prev,\n        attachments,\n        errors,\n        fetchError: undefined,\n        fetching: false,\n        replayRecord,\n      }));\n    } catch (error) {\n      Sentry.captureException(error);\n      setState({\n        ...INITIAL_STATE,\n        fetchError: error,\n        fetching: false,\n      });\n    }\n  }, [fetchReplayAndErrors, fetchAllAttachments]);\n\n  useEffect(() => {\n    loadEvents();\n  }, [loadEvents]);\n\n  const replay = useMemo(() => {\n    return ReplayReader.factory({\n      attachments: state.attachments,\n      errors: state.errors,\n      replayRecord: state.replayRecord,\n    });\n  }, [state.attachments, state.errors, state.replayRecord]);\n\n  return {\n    fetchError: state.fetchError,\n    fetching: state.fetching,\n    onRetry: loadEvents,\n    replay,\n    replayRecord: state.replayRecord,\n  };\n}\n\nexport default useReplayData;\n","import styled from '@emotion/styled';\n\nconst FluidHeight = styled('div')`\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  flex-grow: 1;\n  overflow: hidden;\n`;\n\nexport default FluidHeight;\n"],"names":["BufferingOverlay","className","Overlay","Message","size","t","space","p","theme","gray300","borderRadius","white","zIndex","initial","FastForwardBadge","speed","Badge","FastForwardTooltip","title","direction","Tooltip","LOCAL_STORAGE_KEY","PlayerDOMAlert","isDismissed","setIsDismissed","useState","useEffect","val","localStorage","DOMAlertContainer","DOMAlert","DismissButton","priority","icon","onClick","fontSizeMedium","blue400","Button","BasePlayerRoot","isPreview","initRoot","dimensions","videoDimensions","fastForwardSpeed","isBuffering","useReplayContext","windowEl","useRef","viewEl","windowDimensions","setWindowDimensions","width","height","organization","useOrganization","didLog","setDidLog","aspect_ratio","scale","Math","min","scale_bucket","floor","trackAdvancedAnalyticsEvent","useVideoSizeLogger","current","updateWindowDimensions","useCallback","clientWidth","clientHeight","useResizeObserver","ref","onResize","window","ResizeObserver","style","transform","SizingWindow","PositionedFastForward","PositionedBuffering","backgroundSecondary","gray100","PlayerRoot","purple300","purple200","ReplaysFeatureBadge","props","type","ReplayReader","static","attachments","replayRecord","errors","constructor","this","duration","asMilliseconds","rrwebEvents","breadcrumbs","consoleCrumbs","networkSpans","memorySpans","spans","mapRRWebAttachments","startTimestampMs","endTimestampMs","replayTimestamps","started_at","Date","finished_at","getTime","sortedSpans","spansFactory","filter","isNetworkSpan","isMemorySpan","breadcrumbFactory","getBreadcrumbsByCategory","rrwebEventListFactory","INITIAL_STATE","Object","freeze","undefined","fetchError","fetching","replaySlug","orgSlug","projectSlug","replayId","split","api","useApi","state","setState","fetchReplay","async","requestPromise","data","fetchAllAttachments","rootUrl","firstFourCursors","firstFourUrls","map","cursor","parallelResponses","Promise","allSettled","url","includeAllArgs","responses","resp","status","value","lastResponse","length","_lastData","_lastTextStatus","lastResp","next","parseLinkHeader","getResponseHeader","href","results","_textStatus","push","flatMap","_","fetchErrors","error_ids","finishedAtClone","setSeconds","getSeconds","chunks","chunk","errorIds","query","start","toISOString","end","String","fetchReplayAndErrors","fetchedRecord","mappedRecord","mapResponseToReplayRecord","prev","fetchedErrors","loadEvents","replayAndErrors","all","error","Sentry","replay","useMemo","factory","onRetry"],"sourceRoot":""}
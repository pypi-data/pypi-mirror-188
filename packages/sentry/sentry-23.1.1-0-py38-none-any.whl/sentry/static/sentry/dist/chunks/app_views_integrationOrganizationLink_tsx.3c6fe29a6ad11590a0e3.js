"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_integrationOrganizationLink_tsx"],{"./app/components/narrowLayout.tsx":(t,e,n)=>{n.d(e,{Z:()=>p});var i=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=n("../node_modules/react/index.js"),s=n("./app/actionCreators/account.tsx"),a=n("./app/icons/index.tsx"),r=n("./app/locale.tsx"),l=n("./app/utils/useApi.tsx"),d=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c(t){let{maxWidth:e,showLogout:n,children:i}=t;const c=(0,l.Z)();return(0,o.useEffect)((()=>(document.body.classList.add("narrow"),()=>document.body.classList.remove("narrow"))),[]),(0,d.BX)("div",{className:"app",children:[(0,d.tZ)("div",{className:"pattern-bg"}),(0,d.tZ)("div",{className:"container",style:{maxWidth:e},children:(0,d.BX)("div",{className:"box box-modal",children:[(0,d.BX)("div",{className:"box-header",children:[(0,d.tZ)("a",{href:"/",children:(0,d.tZ)(a.iW,{size:"lg"})}),n&&(0,d.tZ)("a",{className:"logout pull-right",onClick:async function(){await(0,s.kS)(c),window.location.assign("/auth/login")},children:(0,d.tZ)(g,{children:(0,r.t)("Sign out")})})]}),(0,d.tZ)("div",{className:"box-content with-padding",children:i})]})})]})}c.displayName="NarrowLayout";const g=(0,i.Z)("span",{target:"ezeisnw0"})("font-size:",(t=>t.theme.fontSizeLarge),";"),p=c},"./app/views/asyncView.tsx":(t,e,n)=>{n.d(e,{Z:()=>a});var i=n("./app/components/asyncComponent.tsx"),o=n("./app/components/sentryDocumentTitle.tsx"),s=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class a extends i.Z{getTitle(){return""}render(){return(0,s.tZ)(o.Z,{title:this.getTitle(),children:this.renderComponent()})}}a.displayName="AsyncView"},"./app/views/integrationOrganizationLink.tsx":(t,e,n)=>{n.r(e),n.d(e,{default:()=>b});var i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(n("../node_modules/core-js/modules/es.error.cause.js"),n("../node_modules/core-js/modules/es.array.push.js"),n("../node_modules/react/index.js")),a=n("../node_modules/react-select/dist/index-4bd03571.esm.js"),r=n("../node_modules/@sentry/utils/esm/object.js"),l=n("./app/actionCreators/indicator.tsx"),d=n("./app/components/alert.tsx"),c=n("./app/components/button.tsx"),g=n("./app/components/forms/controls/selectControl.tsx"),p=n("./app/components/forms/fieldGroup/index.tsx"),u=n("./app/components/idBadge/index.tsx"),h=n("./app/components/loadingIndicator.tsx"),m=n("./app/components/narrowLayout.tsx"),w=n("./app/locale.tsx"),y=n("./app/utils/integrationUtil.tsx"),Z=n("./app/utils/marked.tsx"),x=n("./app/utils/withDomainRequired.tsx"),v=n("./app/views/asyncView.tsx"),f=n("./app/views/organizationIntegrations/addIntegration.tsx"),z=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class b extends v.Z{constructor(){super(...arguments),(0,i.Z)(this,"disableErrorReport",!1),(0,i.Z)(this,"trackIntegrationAnalytics",((t,e)=>{const{organization:n,provider:i}=this.state;n&&i&&(0,y.Db)(t,{integration_type:"first_party",integration:i.key,already_installed:!1,view:"external_install",organization:n},{startSession:!!e})})),(0,i.Z)(this,"getOrgBySlug",(t=>this.state.organizations.find((e=>e.slug===t)))),(0,i.Z)(this,"onSelectOrg",(async t=>{let{value:e}=t;this.setState({selectedOrgSlug:e,reloading:!0,organization:void 0});try{const[t,{providers:n}]=await Promise.all([this.api.requestPromise(`/organizations/${e}/`),this.api.requestPromise(`/organizations/${e}/config/integrations/?provider_key=${this.integrationSlug}`)]);if(0===n.length)throw new Error("Invalid provider");this.setState({organization:t,reloading:!1,provider:n[0]},this.trackOpened)}catch(t){(0,l.Iw)((0,w.t)("Failed to retrieve organization or integration details")),this.setState({reloading:!1})}})),(0,i.Z)(this,"hasAccess",(()=>{const{organization:t}=this.state;return t?.access.includes("org:integrations")})),(0,i.Z)(this,"onInstallWithInstallationId",(t=>{const{organization:e}=this.state,n=e&&e.slug;this.props.router.push((0,x.D)(`/settings/${n}/integrations/${t.provider.key}/${t.id}/`))})),(0,i.Z)(this,"finishInstallation",(()=>{const{selectedOrgSlug:t}=this.state,e={orgSlug:t,...this.queryParams};this.trackInstallationStart(),window.location.assign(`/extensions/${this.integrationSlug}/configure/?${(0,r._j)(e)}`)})),(0,i.Z)(this,"customOption",(t=>{const e=this.getOrgBySlug(t.value);return e?(0,z.tZ)(a.c.Option,{...t,children:(0,z.tZ)(u.Z,{organization:e,avatarSize:20,displayName:e.name,avatarProps:{consistentWidth:!0}})}):null})),(0,i.Z)(this,"customValueContainer",(t=>{const e=t.getValue();if(0===e.length)return(0,z.tZ)(a.c.ValueContainer,{...t});const n=e[0].value,i=this.getOrgBySlug(n);return i?(0,z.tZ)(a.c.ValueContainer,{...t,children:(0,z.tZ)(u.Z,{organization:i,avatarSize:20,displayName:i.name,avatarProps:{consistentWidth:!0}})}):(0,z.tZ)(a.c.ValueContainer,{...t})}))}getEndpoints(){return[["organizations","/organizations/"]]}getTitle(){return(0,w.t)("Choose Installation Organization")}trackOpened(){this.trackIntegrationAnalytics("integrations.integration_viewed",!0)}trackInstallationStart(){this.trackIntegrationAnalytics("integrations.installation_start")}get integrationSlug(){return this.props.params.integrationSlug}get queryParams(){return this.props.location.query}onLoadAllEndpointsSuccess(){const{organizations:t}=this.state;1===t.length&&this.onSelectOrg({value:t[0].slug})}renderAddButton(){const{installationId:t}=this.props.params,{organization:e,provider:n}=this.state;if(!n||!e)return null;const{features:i}=n.metadata,o=i.map((t=>({featureGate:t.featureGate,description:(0,z.tZ)(I,{dangerouslySetInnerHTML:{__html:(0,Z.A)(t.description)}})}))),{IntegrationFeatures:s}=(0,y.bh)();return(0,z.tZ)(s,{organization:e,features:o,children:i=>{let{disabled:o}=i;return(0,z.tZ)(f.Z,{provider:n,onInstall:this.onInstallWithInstallationId,organization:e,children:e=>(0,z.tZ)(S,{children:(0,z.tZ)(c.zx,{priority:"primary",disabled:!this.hasAccess()||o,onClick:()=>t?e({installation_id:t}):this.finishInstallation(),children:(0,w.t)("Install %s",n.name)})})})}})}renderBottom(){const{organization:t,selectedOrgSlug:e,provider:n,reloading:i}=this.state,{FeatureList:o}=(0,y.bh)();return i?(0,z.tZ)(h.Z,{}):(0,z.BX)(s.Fragment,{children:[e&&t&&!this.hasAccess()&&(0,z.BX)(d.bZ,{type:"error",showIcon:!0,children:[(0,z.tZ)("p",{children:(0,w._N)("You do not have permission to install integrations in\n                [organization]. Ask an organization owner or manager to\n                visit this page to finish installing this integration.",{organization:(0,z.tZ)("strong",{children:t.slug})})}),(0,z.tZ)(_,{children:window.location.href})]}),n&&t&&this.hasAccess()&&o&&(0,z.BX)(s.Fragment,{children:[(0,z.tZ)("p",{children:(0,w._N)("The following features will be available for [organization] when installed.",{organization:(0,z.tZ)("strong",{children:t.slug})})}),(0,z.tZ)(o,{organization:t,features:n.metadata.features,provider:n})]}),(0,z.tZ)("div",{className:"form-actions",children:this.renderAddButton()})]})}renderBody(){const{selectedOrgSlug:t}=this.state,e=this.state.organizations.map((t=>({value:t.slug,label:t.name})));return(0,z.BX)(m.Z,{children:[(0,z.tZ)("h3",{children:(0,w.t)("Finish integration installation")}),(0,z.tZ)("p",{children:(0,w._N)("Please pick a specific [organization:organization] to link with\n            your integration installation of [integation].",{organization:(0,z.tZ)("strong",{}),integation:(0,z.tZ)("strong",{children:this.integrationSlug})})}),(0,z.tZ)(p.Z,{label:(0,w.t)("Organization"),inline:!1,stacked:!0,required:!0,children:(0,z.tZ)(g.Z,{onChange:this.onSelectOrg,value:t,placeholder:(0,w.t)("Select an organization"),options:e,components:{Option:this.customOption,ValueContainer:this.customValueContainer}})}),this.renderBottom()]})}}const _=(0,o.Z)("pre",{target:"e1n98fyh2"})({name:"1iee5id",styles:"margin-bottom:0;background:#fbe3e1"}),I=(0,o.Z)("span",{target:"e1n98fyh1"})({name:"1gt2cgk",styles:"line-height:24px"}),S=(0,o.Z)("div",{target:"e1n98fyh0"})({name:"ur67by",styles:"margin-left:auto;align-self:center;display:flex;flex-direction:column;align-items:center"})},"./app/views/organizationIntegrations/addIntegration.tsx":(t,e,n)=>{n.d(e,{Z:()=>c});var i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/react/index.js"),s=n("../node_modules/query-string/index.js"),a=n("./app/actionCreators/indicator.tsx"),r=n("./app/constants/index.tsx"),l=n("./app/locale.tsx"),d=n("./app/utils/integrationUtil.tsx");class c extends o.Component{constructor(){super(...arguments),(0,i.Z)(this,"dialog",null),(0,i.Z)(this,"openDialog",(t=>{const{account:e,analyticsParams:n,modalParams:i,organization:o,provider:a}=this.props;(0,d.Db)("integrations.installation_start",{integration:a.key,integration_type:"first_party",organization:o,...n});const{url:r,width:l,height:c}=a.setupDialog,{left:g,top:p}=this.computeCenteredWindow(l,c);let u={...t};e&&(u.account=e),i&&(u={...u,...i});const h=`${r}?${s.stringify(u)}`,m=`scrollbars=yes,width=${l},height=${c},top=${p},left=${g}`;this.dialog=window.open(h,"sentryAddIntegration",m),this.dialog&&this.dialog.focus()})),(0,i.Z)(this,"didReceiveMessage",(t=>{const{analyticsParams:e,onInstall:n,organization:i,provider:o}=this.props;if(t.origin!==document.location.origin&&"production"===r.lC)return;if(t.source!==this.dialog)return;const{success:s,data:c}=t.data;this.dialog=null,s?c&&((0,d.Db)("integrations.installation_complete",{integration:o.key,integration_type:"first_party",organization:i,...e}),(0,a.S9)((0,l.t)("%s added",o.name)),n(c)):(0,a.Iw)(c.error)}))}componentDidMount(){window.addEventListener("message",this.didReceiveMessage)}componentWillUnmount(){window.removeEventListener("message",this.didReceiveMessage),this.dialog?.close()}computeCenteredWindow(t,e){const n=void 0!==window.screenLeft?window.screenLeft:window.screenX,i=void 0!==window.screenTop?window.screenTop:window.screenY;return{left:(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-t/2+n,top:(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-e/2+i}}render(){const{children:t}=this.props;return t(this.openDialog)}}c.displayName="AddIntegration"}}]);
//# sourceMappingURL=../sourcemaps/app_views_integrationOrganizationLink_tsx.d75a121dc70ae9bb3b5b542cea4412a5.js.map
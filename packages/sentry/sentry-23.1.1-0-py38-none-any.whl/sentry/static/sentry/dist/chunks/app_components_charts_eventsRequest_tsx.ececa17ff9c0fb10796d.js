"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_charts_eventsRequest_tsx"],{"./app/actionCreators/events.tsx":(e,t,s)=>{s.d(t,{JE:()=>u,eV:()=>l,lI:()=>d});var r=s("../node_modules/lodash/pick.js"),a=s.n(r),i=s("./app/components/charts/utils.tsx"),o=s("./app/utils/getPeriod.tsx"),n=s("./app/utils/performance/constants.tsx");const d=(e,t)=>{let{organization:s,project:r,environment:a,team:n,period:d,start:l,end:u,interval:c,comparisonDelta:m,includePrevious:p,query:h,yAxis:g,field:v,topEvents:f,orderby:D,partial:b,withoutZerofill:x,referrer:y,queryBatching:P,generatePathname:j,queryExtras:T,excludeOther:q,includeAllArgs:M}=t;const w=j?.(s)??`/organizations/${s.slug}/events-stats/`,Z=(0,i.Sw)(p,d),_={includeAllArgs:M,query:{...Object.fromEntries(Object.entries({interval:c,comparisonDelta:m,project:r,environment:a,team:n,query:h,yAxis:g,field:v,topEvents:f,orderby:D,partial:b?"1":void 0,withoutZerofill:x?"1":void 0,referrer:y||"api.organization-event-stats",excludeOther:q?"1":void 0}).filter((e=>{let[,t]=e;return void 0!==t}))),...(0,o.X)({period:d,start:l,end:u},{shouldDoublePeriod:Z}),...T}};return P?.batchRequest?P.batchRequest(e,w,_):e.requestPromise(w,_)};function l(e,t,s){const r={...a()(s,Object.values(n.s)),query:s.query};return e.requestPromise(`/organizations/${t}/events-facets/`,{query:r})}function u(e,t,s){const r={...a()(s,Object.values(n.s)),query:s.query};return e.requestPromise(`/organizations/${t}/events-meta/`,{query:r}).then((e=>e.count))}},"./app/components/charts/eventsRequest.tsx":(e,t,s)=>{s.d(t,{Z:()=>y});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=(s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/react/index.js")),i=s("../node_modules/lodash/isEqual.js"),o=s.n(i),n=s("../node_modules/lodash/omitBy.js"),d=s.n(n),l=s("./app/actionCreators/events.tsx"),u=s("./app/actionCreators/indicator.tsx"),c=s("./app/components/charts/loadingPanel.tsx"),m=s("./app/components/charts/utils.tsx"),p=s("./app/locale.tsx"),h=s("./app/utils.tsx"),g=s("./app/utils/discover/fieldRenderers.tsx"),v=s("./app/utils/discover/fields.tsx"),f=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const D=["api","children","organization","loading","queryBatching","generatePathname"],b=e=>d()(e,((e,t)=>D.includes(t)));class x extends a.PureComponent{constructor(){var e;super(...arguments),e=this,(0,r.Z)(this,"state",{reloading:!!this.props.loading,errored:!1,timeseriesData:null,fetchedWithPrevious:!1}),(0,r.Z)(this,"unmounting",!1),(0,r.Z)(this,"fetchData",(async()=>{const{api:e,confirmedQuery:t,onError:s,expired:r,name:a,hideError:i,...o}=this.props;let n,d=null;if(!1!==t){if(this.setState((e=>({reloading:null!==e.timeseriesData,errored:!1,errorMessage:void 0}))),r)n=(0,p.t)("%s has an invalid date range. Please try a more recent date range.",a),(0,u.Iw)(n,{append:!0}),this.setState({errored:!0,errorMessage:n});else try{e.clear(),d=await(0,l.lI)(e,o)}catch(e){n=e&&e.responseJSON&&e.responseJSON.detail?e.responseJSON.detail:(0,p.t)("Error loading chart data"),i||(0,u.Iw)(n),s&&s(n),this.setState({errored:!0,errorMessage:n})}this.unmounting||(this.setState({reloading:!1,timeseriesData:d,fetchedWithPrevious:o.includePrevious}),o.dataLoadedCallback&&o.dataLoadedCallback(d))}})),(0,r.Z)(this,"getData",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{fetchedWithPrevious:s}=e.state,{period:r,includePrevious:a}=e.props,i=s||(0,m.Sw)(a,r),o=Math.floor(t.length/2);return{current:i?t.slice(o):t,previous:i?t.slice(0,o):null}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){o()(b(e),b(this.props))||this.fetchData()}componentWillUnmount(){this.unmounting=!0}calculateTotalsPerTimestamp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>1e3*e;return e.map(((e,s)=>{let[r,a]=e;return{name:t(r,a,s),value:a.reduce(((e,t)=>{let{count:s}=t;return e+s}),0)}}))}transformPreviousPeriodData(e,t,s){return t?{seriesName:s??"Previous",data:this.calculateTotalsPerTimestamp(t,((t,s,r)=>1e3*e[r][0])),stack:"previous"}:null}transformAggregatedTimeseries(e){return{seriesName:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",data:this.calculateTotalsPerTimestamp(e)}}transformTimeseriesData(e,t,s){let r=1;if(s){const e=t?.units?.[(0,v.LY)(s)];r=(e&&(g.a_[e]??g.en[e]))??1}return[{seriesName:s||"Current",data:e.map((e=>{let[t,s]=e;return{name:1e3*t,value:s.reduce(((e,t)=>{let{count:s}=t;return e+s}),0)*r}}))}]}transformComparisonTimeseriesData(e){return[{seriesName:"comparisonCount()",data:e.map((e=>{let[t,s]=e;return{name:1e3*t,value:s.reduce(((e,t)=>{let{comparisonCount:s}=t;return e+(s??0)}),0)}}))}]}processData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;const{data:r,isMetricsData:a,totals:i,meta:o}=e,{includeTransformedData:n,includeTimeAggregation:d,timeAggregationSeriesName:l,currentSeriesNames:u,previousSeriesNames:c,comparisonDelta:p}=this.props,{current:h,previous:g}=this.getData(r);return{data:n?this.transformTimeseriesData(h,o,s??u?.[t]):[],comparisonData:n&&p?this.transformComparisonTimeseriesData(h):[],allData:r,originalData:h,totals:i,isMetricsData:a,originalPreviousData:g,previousData:n?this.transformPreviousPeriodData(h,g,(s?(0,m.TE)(s):void 0)??c?.[t]):null,timeAggregatedData:d?this.transformAggregatedTimeseries(h,l||""):{},timeframe:e.start&&e.end?g?{start:500*(e.start+e.end),end:1e3*e.end}:{start:1e3*e.start,end:1e3*e.end}:void 0}}render(){const{children:e,showLoading:t,...s}=this.props,{topEvents:r,yAxis:a}=this.props,{timeseriesData:i,reloading:o,errored:n,errorMessage:d}=this.state,l=this.props.loading||null===i;if(t&&l)return(0,f.tZ)(c.Z,{"data-test-id":"events-request-loading"});if((0,m.Xe)(i,(0,h.ri)(r))){let t;const r={},a=Object.keys(i).map(((e,s)=>{const a=i[e],o=this.processData(a,s,(0,v.bQ)(e));return t||(t=o.timeframe),o.isMetricsData&&(r[e]={isMetricsData:o.isMetricsData}),[a.order||0,o.data[0],o.previousData,{isMetricsData:o.isMetricsData}]})).sort(((e,t)=>e[0]-t[0])),u={};Object.keys(i).forEach((e=>{const t=i[e].meta?.fields[(0,v.LY)(e)];t&&(u[e]=t)}));const c=a.map((e=>e[1])),m=a.some((e=>null===e[2]))?void 0:a.map((e=>e[2]));return e({loading:l,reloading:o,errored:n,errorMessage:d,results:c,timeframe:t,previousTimeseriesData:m,seriesAdditionalInfo:r,timeseriesResultsTypes:u,...s})}if(i){const t=a&&("string"==typeof a?a:a[0]),r=t&&i.meta?.fields[(0,v.LY)(t)],u=r?{[t]:r}:void 0,{data:c,comparisonData:m,allData:p,originalData:h,totals:g,originalPreviousData:f,previousData:D,timeAggregatedData:b,timeframe:x,isMetricsData:y}=this.processData(i);return e({loading:l,reloading:o,errored:n,errorMessage:d,seriesAdditionalInfo:{[this.props.currentSeriesNames?.[0]??"current"]:{isMetricsData:y}},timeseriesData:c,comparisonTimeseriesData:m,allTimeseriesData:p,originalTimeseriesData:h,timeseriesTotals:g,originalPreviousTimeseriesData:f,previousTimeseriesData:D?[D]:D,timeAggregatedData:b,timeframe:x,timeseriesResultsTypes:u,...s})}return e({loading:l,reloading:o,errored:n,errorMessage:d,...s})}}x.displayName="EventsRequest",(0,r.Z)(x,"defaultProps",{period:void 0,start:null,end:null,interval:"1d",comparisonDelta:void 0,limit:15,query:"",includePrevious:!0,includeTransformedData:!0});const y=x},"./app/components/charts/loadingPanel.tsx":(e,t,s)=>{s.d(t,{Z:()=>n});var r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=s("./app/components/loadingMask.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const o=(0,r.Z)((e=>{let{height:t,...s}=e;return(0,i.tZ)("div",{...s,children:(0,i.tZ)(a.Z,{})})}),{target:"e16jayu70"})("flex:1;flex-shrink:0;overflow:hidden;height:",(e=>e.height),";position:relative;border-color:transparent;margin-bottom:0;");o.defaultProps={height:"200px"};const n=o},"./app/components/loadingMask.tsx":(e,t,s)=>{s.d(t,{Z:()=>r});const r=(0,s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js").Z)("div",{target:"e9w1nku0"})("background-color:",(e=>e.theme.backgroundSecondary),";border-radius:",(e=>e.theme.borderRadius),";position:absolute;top:0;bottom:0;left:0;right:0;")},"./app/utils/getPeriod.tsx":(e,t,s)=>{s.d(t,{X:()=>n}),s("../node_modules/core-js/modules/es.error.cause.js");var r=s("../node_modules/moment/moment.js"),a=s.n(r),i=s("./app/constants/index.tsx"),o=s("./app/utils/dates.tsx");function n(e){let{period:t,start:s,end:r}=e,{shouldDoublePeriod:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t||s||r||(t=i.GY),t){if(!n)return{statsPeriod:t};const[,e,s]=t.match(/([0-9]+)([mhdw])/);return{statsPeriod:`${2*parseInt(e,10)}${s}`}}if(!s||!r)throw new Error("start and end required");const d=(0,o.v5)(s),l=(0,o.v5)(r);if(n){const e=a()(r).diff(a()(s)),t=a()(s).subtract(e);return{start:(0,o.v5)(t),end:l}}return{start:d,end:l}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_charts_eventsRequest_tsx.eecaa20d210bc132ebcea0f4ec34cb63.js.map
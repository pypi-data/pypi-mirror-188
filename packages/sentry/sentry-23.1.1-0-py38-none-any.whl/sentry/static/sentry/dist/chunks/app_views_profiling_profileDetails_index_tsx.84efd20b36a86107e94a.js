"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_profiling_profileDetails_index_tsx"],{"./app/utils/profiling/tableRenderer.tsx":(e,t,r)=>{r.d(t,{w:()=>s});var o=r("./app/components/gridEditable/sortLink.tsx"),n=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function s(e){let{currentSort:t,generateSortLink:r,rightAlignedColumns:s,sortableColumns:a,onClick:i}=e;return(e,l)=>(0,n.tZ)(o.Z,{onClick:t=>i?.(e,t),align:s?.has(e.key)?"right":"left",title:e.name,direction:t?.key===e.key?t?.order:void 0,canSort:a?.has(e.key)||!1,generateSortLink:r?.(e.key)??(()=>{}),replace:!0})}},"./app/views/profiling/profileDetails/index.tsx":(e,t,r)=>{r.r(t),r.d(t,{default:()=>Q});var o=r("../node_modules/react/index.js"),n=r("./app/components/layouts/thirds.tsx"),s=r("./app/components/sentryDocumentTitle.tsx"),a=r("./app/locale.tsx"),i=r("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),l=r("./app/utils/profiling/hooks/useCurrentProjectFromRouteParam.tsx"),u=r("./app/utils/useOrganization.tsx"),c=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),p=(r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.array.push.js"),r("../node_modules/react-router/es/index.js")),d=r("../node_modules/lodash/debounce.js"),m=r.n(d),g=r("./app/components/compactSelect.tsx"),h=r("./app/components/gridEditable/index.tsx"),y=r("./app/components/pagination.tsx"),f=r("./app/components/searchBar.tsx"),k=r("./app/styles/space.tsx"),b=r("./app/utils/discover/styles.tsx"),w=r("./app/utils/profiling/routes.tsx"),C=r("./app/utils/profiling/tableRenderer.tsx"),v=r("./app/utils/profiling/units/units.ts"),S=r("./app/utils/useEffectAfterFirstRender.ts"),x=r("./app/utils/useLocation.tsx"),Z=r("./app/utils/useParams.tsx"),j=r("./app/views/profiling/profileGroupProvider.tsx"),A=r("../node_modules/lodash/groupBy.js"),_=r.n(A);function P(e){const t=[];return e.forEach((e=>{e.selfWeight>0&&t.push(e)}),(()=>{})),t.sort(((e,t)=>t.selfWeight-e.selfWeight)).map((t=>({symbol:t.frame.name,file:t.frame.file,image:t.frame.image,thread:e.threadId,type:t.frame.is_application?"application":"system","self weight":t.selfWeight,"total weight":t.totalWeight})))}function q(e,t){return e.reduce(((e,r)=>{const o=r[t];return o&&!e.includes(o)&&e.push(o),e}),[])}function L(e,t,r){const o=_()(e,(e=>function(e,t){return t.map((t=>e[t])).join(T)}(e,t))),n=[];for(const e in o){const s=z(e,t),a=o[e];r.forEach((e=>{s[e.key]=e.compute(a)})),n.push(s)}return n}const T=String.fromCharCode(31);function z(e,t){const r=e.split(T);return t.reduce(((e,t,o)=>(e[t]=r[o],e)),{})}var F=r("../node_modules/fuse.js/dist/fuse.esm.js"),W=r("../node_modules/query-string/index.js");function $(e){let{key:t,initialState:r}=e;const n=(0,x.T)(),[s,a]=(0,o.useState)(n.query[t]??r),i=(0,o.useCallback)((e=>{const r=p.browserHistory.getCurrentLocation();return{...r,query:{...r.query,[t]:e}}}),[t]),l=(0,o.useCallback)((e=>{p.browserHistory.replace(i(e)),a(e)}),[i]);return(0,o.useEffect)((()=>p.browserHistory.listenBefore((e=>{p.browserHistory.getCurrentLocation().pathname!==e.pathname&&t in e.query&&delete e.query[t]}))),[t]),[s,l,i]}var E=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function H(){const e=(0,x.T)(),t=(0,j.useProfileGroup)(),[r,n]=$({key:"detailView",initialState:"occurrence"}),[s,i]=$({key:"query",initialState:""}),[l,u]=$({key:"cursor",initialState:""}),c=V[r]??V.occurrence,p=l?parseInt(l,10):0,d=(0,o.useMemo)((()=>{const e="resolved"===t.type?t.data.profiles.flatMap(P):[];return c.transform(e)}),[t,c]),{search:k}=function(e,t){const r=(0,o.useMemo)((()=>new F.default(e,t)),[e]);return{search:(0,o.useCallback)(((t,o)=>t?r.search(t,o).map((e=>e.item)):e),[r,e]),searchIndex:r}}(d,{keys:c.search.key,threshold:.3}),b=(0,o.useMemo)((()=>m()((e=>v(k(e))),500)),[k]),[w,v]=(0,o.useState)(d),[Z,A]=$({key:"type"}),[_,L]=$({key:"image"}),{filters:T,columnFilters:z,filterPredicate:H}=function(e,t){const{columns:r}=t,[n,s]=(0,o.useState)((a=t.initialState)?Object.entries(a).reduce(((e,t)=>{let[r,o]=t;return e[r]=void 0,Array.isArray(o)&&(e[r]=o),"string"==typeof o&&(e[r]=[o]),e}),{}):{});var a;const i=(0,o.useMemo)((()=>{function t(e){return t=>{s((r=>({...r,[e]:t.length>0?t.map((e=>e.value)):void 0})))}}return r.reduce(((r,o)=>(r[o]={values:q(e,o).sort(((e,t)=>e.localeCompare(t))),onChange:t(o)},r)),{})}),[e,r]),l=(0,o.useRef)(!1);(0,o.useEffect)((()=>{l.current||0===e.length||(s((e=>Object.entries(e).reduce(((e,t)=>{const[r,o]=t,n=i[r].values,s=o?.filter((e=>n.includes(e)));return e[r]=Array.isArray(s)&&s.length>0?s:void 0,e}),{}))),l.current=!0)}),[e.length,i,n]);const u=(0,o.useCallback)((e=>{let t=!0;for(const r in n){const o=n[r];if(!o)continue;const s=e[r];if(t=o.includes(s),!t)return!1}return t}),[n]);return{filters:n,columnFilters:i,filterPredicate:u}}(d,{columns:["type","image"],initialState:{type:Z,image:_}});(0,o.useEffect)((()=>{A(T.type),L(T.image)}),[T,A,L]);const{currentSort:B,generateSortLink:R,sortCompareFn:G}=function(e){const{sortableColumns:t,querystringKey:r,defaultSort:n}=e,[s,a,i]=$({key:r}),l=(0,o.useMemo)((()=>{let e=s??"";const r="-"===e[0];return r&&(e=e.slice(1)),e&&t.includes(e)?{key:e,order:r?"desc":"asc"}:n}),[t,n,s]),u=(0,o.useCallback)((e=>{if(!t.includes(e))return()=>{};if(!l)return()=>i(e);const r=l.key===e&&"desc"===l.order?"asc":"desc";return()=>i(`${"desc"===r?"-":""}${e}`)}),[l,t,i]),c=(0,o.useCallback)(((e,t)=>{const r=e[l.key],o=t[l.key];return r&&o?"number"==typeof r&&"number"==typeof o?"asc"===l.order?r-o:o-r:"string"==typeof r&&"string"==typeof o?"asc"===l.order?r.localeCompare(o):o.localeCompare(r):1:1}),[l]);return{currentSort:l,generateSortLink:u,sortCompareFn:c}}({...c.sort,querystringKey:"functionsSort"}),O=(0,o.useCallback)((e=>{i(e),u(void 0),b(e)}),[u,i,b]);(0,S.K)((()=>{v(k(s??""))}),[d,k]);const N=(0,o.useMemo)((()=>w.filter(H)),[H,w]),K=(0,o.useMemo)((()=>N.sort(G)),[N,G]),U=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const n=(0,x.T)();return(0,o.useMemo)((()=>{const o=t>=r?"true":"false",s=t>=r?t-r:0,a={...n.query,cursor:s},i=`<${n.pathname}${W.stringify(a)}>; rel="previous"; results="${o}"; cursor="${s}"`,l=t+r<e.length?"true":"false",u=t+r<e.length?t+r:0,c={...n.query,cursor:u};return`${i},<${n.pathname}${W.stringify(c)}>; rel="next"; results="${l}"; cursor="${u}"`}),[t,n,e,r])}(K,p),X=K.slice(p,p+50);return(0,E.BX)(o.Fragment,{children:[(0,E.BX)(I,{children:[(0,E.tZ)(g.Z,{options:Object.values(V).map((e=>e.option)),value:c.option.value,triggerProps:{prefix:(0,a.t)("View")},placement:"bottom right",onChange:e=>{i(""),u(void 0),n(e.value)}}),(0,E.tZ)(f.Z,{defaultQuery:"",query:s,placeholder:c.search.placeholder,onChange:O}),(0,E.tZ)(g.Z,{options:z.type.values.map((e=>({value:e,label:e}))),value:T.type,triggerLabel:!T.type||Array.isArray(T.type)&&T.type.length===z.type.values.length?(0,a.t)("All"):void 0,triggerProps:{prefix:(0,a.t)("Type")},multiple:!0,onChange:z.type.onChange,placement:"bottom right"}),(0,E.tZ)(g.Z,{options:z.image.values.map((e=>({value:e,label:e}))),value:T.image,triggerLabel:!T.image||Array.isArray(T.image)&&T.image.length===z.image.values.length?(0,a.t)("All"):void 0,triggerProps:{prefix:(0,a.t)("Package")},multiple:!0,onChange:z.image.onChange,placement:"bottom right",isSearchable:!0})]}),(0,E.tZ)(h.ZP,{isLoading:"loading"===t.type,error:"errored"===t.type,data:X,columnOrder:c.columns.map((e=>D[e])),columnSortBy:[B],scrollable:!0,stickyHeader:!0,height:"75vh",grid:{renderHeadCell:(0,C.w)({rightAlignedColumns:new Set(c.rightAlignedColumns),sortableColumns:new Set(c.rightAlignedColumns),currentSort:B,generateSortLink:R}),renderBodyCell:M},location:e}),(0,E.tZ)(y.Z,{pageLinks:U,onCursor:e=>{u(e)}})]})}H.displayName="ProfileDetailsTable";const I=(0,c.Z)("div",{target:"e1qhas5a0"})("display:grid;grid-template-columns:auto 1fr auto auto;gap:",(0,k.Z)(2),";margin-bottom:",(0,k.Z)(2),";");function M(e,t,r,o){return(0,E.tZ)(R,{column:e,dataRow:t,rowIndex:r,columnIndex:o})}M.displayName="renderFunctionCell";const B=(0,v.s4)("nanoseconds");function R(e){let{column:t,dataRow:r}=e;const o=r[t.key],{orgId:n,projectId:s,eventId:i}=(0,Z.U)();switch(t.key){case"p75":case"p95":case"self weight":case"total weight":return(0,E.tZ)(b.Hw,{children:B(o)});case"count":return(0,E.tZ)(b.Hw,{children:o});case"image":return(0,E.tZ)(b.W2,{children:o??(0,a.t)("Unknown")});case"thread":return(0,E.tZ)(b.W2,{children:(0,E.tZ)(p.Link,{to:(0,w.TH)({orgSlug:n,projectSlug:s,profileId:i,query:{tid:r.thread}}),children:o})});case"symbol":return(0,E.tZ)(b.W2,{children:(0,E.tZ)(p.Link,{to:(0,w.TH)({orgSlug:n,projectSlug:s,profileId:i,query:{frameName:r.symbol,framePackage:r.image,tid:r.thread??r.tids?.[0]}}),children:o})});default:return(0,E.tZ)(b.W2,{children:o})}}const D={symbol:{key:"symbol",name:(0,a.t)("Symbol"),width:h.z7},image:{key:"image",name:(0,a.t)("Package"),width:h.z7},file:{key:"file",name:(0,a.t)("File"),width:h.z7},thread:{key:"thread",name:(0,a.t)("Thread"),width:h.z7},type:{key:"type",name:(0,a.t)("Type"),width:h.z7},"self weight":{key:"self weight",name:(0,a.t)("Self Weight"),width:h.z7},"total weight":{key:"total weight",name:(0,a.t)("Total Weight"),width:h.z7},p75:{key:"p75",name:(0,a.t)("P75(Self)"),width:h.z7},p95:{key:"p95",name:(0,a.t)("P95(Self)"),width:h.z7},count:{key:"count",name:(0,a.t)("Count"),width:h.z7}},G=(e,t)=>{const r=Array.from(e).sort(((e,t)=>e-t)),o=t*(r.length-1),n=Math.floor(o),s=o%1;return o===n?r[o]:r[n]*(1-s)+r[n+1]*s},O={key:"p75",compute:e=>G(e.map((e=>e["self weight"])),.75)},N={key:"p95",compute:e=>G(e.map((e=>e["self weight"])),.95)},K={key:"count",compute:e=>e.length},U={key:"tids",compute:e=>e.reduce(((e,t)=>{const r=t.thread;return e.includes(r)||e.push(r),e}),[])},V={occurrence:{option:{label:(0,a.t)("Slowest Functions"),value:"occurrence"},columns:["symbol","image","file","thread","type","self weight","total weight"],transform:e=>e.slice(0,500),search:{key:["symbol"],placeholder:(0,a.t)("Search for frames")},sort:{sortableColumns:["self weight","total weight"],defaultSort:{key:"self weight",order:"desc"}},rightAlignedColumns:["self weight","total weight"]},symbol:{option:{label:(0,a.t)("Group by Symbol"),value:"symbol"},columns:["symbol","type","image","p75","p95","count"],search:{key:["symbol"],placeholder:(0,a.t)("Search for frames")},transform:e=>L(e,["symbol","type","image"],[O,N,K,U]),sort:{sortableColumns:["p75","p95","count"],defaultSort:{key:"p75",order:"desc"}},rightAlignedColumns:["p75","p95","count"]},package:{option:{label:(0,a.t)("Group by Package"),value:"package"},columns:["image","type","p75","p95","count"],search:{key:["image"],placeholder:(0,a.t)("Search for packages")},transform:e=>L(e,["type","image"],[O,N,K]),sort:{sortableColumns:["p75","p95","count"],defaultSort:{key:"p75",order:"desc"}},rightAlignedColumns:["p75","p95","count"]},file:{option:{label:(0,a.t)("Group by File"),value:"file"},columns:["file","type","image","p75","p95","count"],search:{key:["file"],placeholder:(0,a.t)("Search for files")},transform:e=>L(e,["type","image","file"],[O,N,K]),sort:{sortableColumns:["p75","p95","count"],defaultSort:{key:"p75",order:"desc"}},rightAlignedColumns:["p75","p95","count"]}};function X(){const e=(0,u.Z)(),t=(0,l.y)();return(0,o.useEffect)((()=>{(0,i.Z)("profiling_views.profile_summary",{organization:e,project_id:t?.id,project_platform:t?.platform})}),[e]),(0,E.tZ)(o.Fragment,{children:(0,E.tZ)(s.Z,{title:(0,a.t)("Profiling — Details"),orgSlug:e.slug,children:(0,E.tZ)(n.uT,{children:(0,E.tZ)(n.or,{fullWidth:!0,children:(0,E.tZ)(H,{})})})})})}X.displayName="ProfileDetails";const Q=X}}]);
//# sourceMappingURL=../sourcemaps/app_views_profiling_profileDetails_index_tsx.9c9fdb481c100d853bce9aaf5cf36b27.js.map
"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_performance_contexts_metricsCardinality_tsx-app_utils_performance_histogram_utils_t-fa896e"],{"./app/utils/performance/contexts/metricsCardinality.tsx":(t,e,n)=>{n.d(e,{BT:()=>x,e0:()=>j}),n("../node_modules/core-js/modules/es.array.includes.js");var r=n("../node_modules/react/index.js"),o=n("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),s=n("./app/utils/dates.tsx"),i=n("./app/utils/discover/eventView.tsx"),a=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),c=n("../node_modules/lodash/omit.js"),l=n.n(c),u=n("./app/utils/discover/genericDiscoverQuery.tsx"),d=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(t){let{eventView:e,location:n}=t;return l()(e.getEventsAPIPayload(n),["field","sort","per_page","query"])}function m(t){let{children:e,...n}=t;return(0,d.tZ)(u.ZP,{route:"metrics-compatibility-sums",getRequestPayload:p,...n,children:t=>{let{tableData:n,...r}=t;return e({tableData:n,...r})}})}function h(t){let{eventView:e,location:n}=t;return l()(e.getEventsAPIPayload(n),["field","sort","per_page","query"])}function f(t){let{children:e,...n}=t;return(0,d.tZ)(u.ZP,{route:"metrics-compatibility",getRequestPayload:h,...n,children:t=>{let{tableData:n,...r}=t;return e({tableData:n,...r})}})}m.displayName="MetricsCompatibilityQuery",f.displayName="MetricsCompatibilitySumsQuery";var y=n("./app/utils/performance/contexts/utils.tsx");const[g,v,b]=(0,y.n)({name:"MetricsCardinalityContext",strict:!1}),x=t=>{if(!(0,a.gp)(t.organization))return(0,d.tZ)(g,{value:{isLoading:!1,outcome:{forceTransactionsOnly:!0}},children:t.children});const e={location:t.location,orgSlug:t.organization.slug,cursor:"0:0:0"},n=i.ZP.fromLocation(t.location);n.fields=[{field:"tpm()"}];const o=function(t){const e=t.clone();return e.start||e.end||(e.statsPeriod?(0,s.YJ)(e.statsPeriod)>1&&(e.statsPeriod="1h",e.start=void 0,e.end=void 0):(e.statsPeriod="1h",e.start=void 0,e.end=void 0)),e}(n);return(0,d.tZ)(r.Fragment,{children:(0,d.tZ)(m,{eventView:o,...e,children:n=>(0,d.tZ)(f,{eventView:o,...e,children:e=>{const r=n.isLoading||e.isLoading,o=n.isLoading||e.isLoading?void 0:function(t,e,n){const r={forceTransactionsOnly:!0},o=n.features.includes("performance-mep-bannerless-ui");if(!t)return r;const s=t.compatible_projects;return e?r:t?function(t){return!S(t).metricsCount}(t)?r:function(t,e){const n=S(t);return e?n.nullCount/n.metricsCount>.01:n.nullCount>0}(t,o)?{shouldWarnIncompatibleSDK:!0,forceTransactionsOnly:!0,compatibleProjects:s}:function(t){const e=S(t);return e.unparamCount>=e.metricsCount}(t)?{shouldNotifyUnnamedTransactions:!0,forceTransactionsOnly:!0,compatibleProjects:s}:function(t,e){const n=S(t);return e?n.unparamCount/n.metricsCount>.01:n.unparamCount>0}(t,o)?{shouldNotifyUnnamedTransactions:!0,compatibleProjects:s,forceTransactionsOnly:!1}:{forceTransactionsOnly:!1}:r}(n.tableData&&e.tableData?{...n.tableData,...e.tableData}:null,!!n.error&&!!e.error,t.organization);return(0,d.tZ)(T,{sendOutcomeAnalytics:t.sendOutcomeAnalytics,organization:t.organization,value:{isLoading:r,outcome:o},children:t.children})}})})})};x.displayName="MetricsCardinalityProvider";const T=t=>{const e=t.value.outcome?.shouldWarnIncompatibleSDK??!1,n=t.value.outcome?.shouldNotifyUnnamedTransactions??!1,s=!t.value.outcome?.forceTransactionsOnly;return(0,r.useEffect)((()=>{!t.value.isLoading&&t.sendOutcomeAnalytics&&(0,o.Z)("performance_views.mep.metrics_outcome",{organization:t.organization,is_on_metrics:s,fallback_from_null:e,fallback_from_unparam:n})}),[t.organization,t.value.isLoading,s,n,e,t.sendOutcomeAnalytics]),(0,d.tZ)(g,{...t,children:t.children})};T.displayName="Provider",b.Consumer;const j=v;function S(t){let{sum:e}=t;try{const t=Number(e.metrics);return{metricsCount:t,unparamCount:Number(e.metrics_unparam),nullCount:Number(e.metrics_null)}}catch(t){return{metricsCount:0,unparamCount:0,nullCount:0}}}},"./app/utils/performance/histogram/utils.tsx":(t,e,n)=>{n.d(e,{GT:()=>i,_W:()=>s,te:()=>o}),n("../node_modules/core-js/modules/es.error.cause.js");var r=n("./app/utils/formatters.tsx");function o(t){return t.length>=2?t[1].bin-t[0].bin:0}function s(t){const e=o(t);return t.map((t=>{const n=t.bin;return{start:n,end:n+e}}))}function i(t){let{precision:e,type:n,additionalFieldsFn:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=t=>{switch(n){case"duration":const o=e??(t<1e3?0:3);return(0,r.g9)(t/1e3,o,!0);case"number":const s=10**(e??0);return(Math.round((t+Number.EPSILON)*s)/s).toLocaleString();default:throw new Error(`Unable to format type: ${n}`)}};return t.map((t=>({value:t.count,name:s(t.bin),...o?.(t.bin)??{}})))}},"./app/views/performance/transactionSummary/transactionEvents/utils.tsx":(t,e,n)=>{n.d(e,{Kc:()=>m,Lc:()=>h,Zq:()=>p,_S:()=>c,q3:()=>a,qg:()=>d,tb:()=>u,xr:()=>l}),n("../node_modules/core-js/modules/es.array.includes.js");var r=n("./app/locale.tsx"),o=n("./app/utils/queryString.tsx"),s=n("./app/views/performance/transactionSummary/filter.tsx"),i=n("./app/views/performance/transactionSummary/utils.tsx");let a;function c(t,e){const{p99:n,p95:o,p75:i,p50:c}=e||{p99:0,p95:0,p75:0,p50:0};return{[a.p50]:{name:a.p50,query:c?[["transaction.duration",`<=${c.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,s.T$)(t)||"transaction.duration"},label:(0,r.t)("p50")},[a.p75]:{name:a.p75,query:i?[["transaction.duration",`<=${i.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,s.T$)(t)||"transaction.duration"},label:(0,r.t)("p75")},[a.p95]:{name:a.p95,query:o?[["transaction.duration",`<=${o.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,s.T$)(t)||"transaction.duration"},label:(0,r.t)("p95")},[a.p99]:{name:a.p99,query:n?[["transaction.duration",`<=${n.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,s.T$)(t)||"transaction.duration"},label:(0,r.t)("p99")},[a.p100]:{name:a.p100,label:(0,r.t)("p100")}}}function l(t){let{orgSlug:e,transaction:n,projectID:r,query:o}=t;return{pathname:`/organizations/${e}/performance/summary/events/`,query:{transaction:n,project:r,environment:o.environment,statsPeriod:o.statsPeriod,start:o.start,end:o.end,query:o.query}}}function u(t){return e=(0,o.ro)(t.query.showTransactions,a.p100),Object.values(a).includes(e)?e:a.p100;var e}function d(t,e){const n=c(e),r=n[t].sort?.kind,o=n[t].sort?.field,s={showTransactions:t};return r&&o&&(s.sort=`${"desc"===r?"-":""}${o}`),s}function p(t){switch(t){case i.K0.OUTLIER:return a.p100;case i.K0.SLOW:return a.p95;default:return}}function m(t){return{p100:t?.["p100()"],p99:t?.["p99()"],p95:t?.["p95()"],p75:t?.["p75()"],p50:t?.["p50()"]}}function h(t){return t.withColumns([{kind:"function",function:["p100","",void 0,void 0]},{kind:"function",function:["p99","",void 0,void 0]},{kind:"function",function:["p95","",void 0,void 0]},{kind:"function",function:["p75","",void 0,void 0]},{kind:"function",function:["p50","",void 0,void 0]}])}!function(t){t.p50="p50",t.p75="p75",t.p95="p95",t.p99="p99",t.p100="p100"}(a||(a={}))},"./app/views/performance/transactionSummary/transactionThresholdModal.tsx":(t,e,n)=>{n.d(e,{ZP:()=>q,fY:()=>P});var r=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/react/index.js"),i=n("../node_modules/lodash/cloneDeep.js"),a=n.n(i),c=n("../node_modules/lodash/set.js"),l=n.n(c),u=n("./app/actionCreators/indicator.tsx"),d=n("./app/components/button.tsx"),p=n("./app/components/buttonBar.tsx"),m=n("./app/components/forms/controls/selectControl.tsx"),h=n("./app/components/forms/fieldGroup/index.tsx"),f=n("./app/components/input.tsx"),y=n("./app/components/links/link.tsx"),g=n("./app/locale.tsx"),v=n("./app/styles/space.tsx"),b=n("./app/utils.tsx"),x=n("./app/utils/withApi.tsx"),T=n("./app/utils/withProjects.tsx"),j=n("./app/views/performance/transactionSummary/utils.tsx"),S=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let C;!function(t){t.TRANSACTION_DURATION="duration",t.LARGEST_CONTENTFUL_PAINT="lcp"}(C||(C={}));const Z=[{label:(0,g.t)("Transaction Duration"),value:"duration"},{label:(0,g.t)("Largest Contentful Paint"),value:"lcp"}];class _ extends s.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{threshold:this.props.transactionThreshold,metric:this.props.transactionThresholdMetric,error:null}),(0,r.Z)(this,"handleApply",(t=>{t.preventDefault();const{api:e,closeModal:n,organization:r,transactionName:o,onApply:s}=this.props,i=this.getProject();if(!(0,b.ri)(i))return;const a=`/organizations/${r.slug}/project-transaction-threshold-override/`;e.requestPromise(a,{method:"POST",includeAllArgs:!0,query:{project:i.id},data:{transaction:o,threshold:this.state.threshold,metric:this.state.metric}}).then((()=>{n(),s&&s(this.state.threshold,this.state.metric)})).catch((t=>{this.setState({error:t});const e=t.responseJSON?.threshold??t.responseJSON?.non_field_errors??null;(0,u.Iw)(e)}))})),(0,r.Z)(this,"handleFieldChange",(t=>e=>{this.setState((n=>{const r=a()(n);return l()(r,t,e),{...r,errors:void 0}}))})),(0,r.Z)(this,"handleReset",(t=>{t.preventDefault();const{api:e,closeModal:n,organization:r,transactionName:o,onApply:s}=this.props,i=this.getProject();if(!(0,b.ri)(i))return;const a=`/organizations/${r.slug}/project-transaction-threshold-override/`;e.requestPromise(a,{method:"DELETE",includeAllArgs:!0,query:{project:i.id},data:{transaction:o}}).then((()=>{const t=`/projects/${r.slug}/${i.slug}/transaction-threshold/configure/`;this.props.api.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{project:i.id}}).then((t=>{let[e]=t;this.setState({threshold:e.threshold,metric:e.metric}),n(),s&&s(this.state.threshold,this.state.metric)})).catch((t=>{const e=t.responseJSON?.threshold??null;(0,u.Iw)(e)}))})).catch((t=>{this.setState({error:t})}))}))}getProject(){const{projects:t,eventView:e,project:n}=this.props;if((0,b.ri)(n))return t.find((t=>t.id===n));const r=String(e.project[0]);return t.find((t=>t.id===r))}renderModalFields(){return(0,S.BX)(s.Fragment,{children:[(0,S.tZ)(h.Z,{"data-test-id":"response-metric",label:(0,g.t)("Calculation Method"),inline:!1,help:(0,g.t)("This determines which duration metric is used for the Response Time Threshold."),showHelpInTooltip:!0,flexibleControlStateSize:!0,stacked:!0,required:!0,children:(0,S.tZ)(m.Z,{required:!0,options:Z.slice(),name:"responseMetric",label:(0,g.t)("Calculation Method"),value:this.state.metric,onChange:t=>{this.handleFieldChange("metric")(t.value)}})}),(0,S.tZ)(h.Z,{"data-test-id":"response-time-threshold",label:(0,g.t)("Response Time Threshold (ms)"),inline:!1,help:(0,g.t)("The satisfactory response time for the calculation method defined above. This is used to calculate Apdex and User Misery scores."),showHelpInTooltip:!0,flexibleControlStateSize:!0,stacked:!0,required:!0,children:(0,S.tZ)(f.Z,{type:"number",name:"threshold",required:!0,pattern:"[0-9]*(\\.[0-9]*)?",onChange:t=>{this.handleFieldChange("threshold")(t.target.value)},value:this.state.threshold,step:100,min:100})})]})}render(){const{Header:t,Body:e,Footer:n,organization:r,transactionName:o,eventView:i}=this.props,a=this.getProject(),c=i.clone();c.query=c.getQueryWithAdditionalConditions();const l=(0,j.e1)({orgSlug:r.slug,transaction:o,query:c.generateQueryStringObject(),projectID:a?.id});return(0,S.BX)(s.Fragment,{children:[(0,S.tZ)(t,{closeButton:!0,children:(0,S.tZ)("h4",{children:(0,g.t)("Transaction Settings")})}),(0,S.BX)(e,{children:[(0,S.tZ)(w,{children:(0,g._N)("The changes below will only be applied to [transaction]. To set it at a more global level, go to [projectSettings: Project Settings].",{transaction:(0,S.tZ)(y.Z,{to:l,children:o}),projectSettings:(0,S.tZ)(y.Z,{to:`/settings/${r.slug}/projects/${a?.slug}/performance/`})})}),this.renderModalFields()]}),(0,S.tZ)(n,{children:(0,S.BX)(p.ZP,{gap:1,children:[(0,S.tZ)(d.zx,{priority:"default",onClick:this.handleReset,"data-test-id":"reset-all",children:(0,g.t)("Reset All")}),(0,S.tZ)(d.zx,{"aria-label":(0,g.t)("Apply"),priority:"primary",onClick:this.handleApply,"data-test-id":"apply-threshold",children:(0,g.t)("Apply")})]})})]})}}_.displayName="TransactionThresholdModal";const w=(0,o.Z)("div",{target:"e16m24dg0"})("margin-bottom:",(0,v.Z)(4),";"),P={name:"1yumxzh",styles:"width:100%;max-width:650px"},q=(0,x.Z)((0,T.Z)(_))},"./app/views/performance/transactionSummary/utils.tsx":(t,e,n)=>{n.d(e,{K0:()=>u,MF:()=>y,PU:()=>p,Z6:()=>h,e1:()=>m,uI:()=>g,vd:()=>f,xf:()=>d});var r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=n("./app/styles/space.tsx"),s=n("./app/utils/discover/urls.tsx"),i=n("./app/utils/getRouteStringFromRoutes.tsx"),a=n("./app/utils/performance/urls.ts"),c=n("./app/utils/tokenizeSearch.tsx"),l=n("./app/views/performance/traceDetails/utils.tsx");let u;function d(t){const e=p(t);return e.removeFilter("transaction"),e}function p(t){const e=new c.MY(t);return e.removeFilter("event.type"),e}function m(t){let{orgSlug:e,transaction:n,projectID:r,query:o,unselectedSeries:s="p100()",display:i,trendFunction:a,trendColumn:c,showTransactions:l,additionalQuery:u,subPath:p}=t;const m=function(t){let{orgSlug:e,subPath:n}=t;return`/organizations/${e}/performance/summary/${n?`${n}/`:""}`}({orgSlug:e,subPath:p});let h;return h="string"==typeof o.query?d(o.query).formatString():o.query,{pathname:m,query:{transaction:n,project:r,environment:o.environment,statsPeriod:o.statsPeriod,start:o.start,end:o.end,query:h,unselectedSeries:s,showTransactions:l,display:i,trendFunction:a,trendColumn:c,referrer:"performance-transaction-summary",...u}}}function h(t){return(e,n,r)=>{const o=`${n.trace}`;return o?(0,l.YA)(e,o,t,{}):{}}}function f(t){return(e,n,r,o)=>{const i=(0,s.JE)(n);return(0,a.D)(e.slug,i,t,r,o)}}function y(t){const e=(0,i.Z)(t);return(t,n,r)=>{const o=n.replayId;if(!o)return{};const s=`${n["project.name"]}:${o}`;if(!n.timestamp)return{pathname:`/organizations/${t.slug}/replays/${s}/`,query:{referrer:e}};const i=new Date(n.timestamp).getTime()-n["transaction.duration"];return{pathname:`/organizations/${t.slug}/replays/${s}/`,query:{event_t:i,referrer:e}}}}!function(t){t.FASTEST="fastest",t.SLOW="slow",t.OUTLIER="outlier",t.RECENT="recent"}(u||(u={}));const g=(0,r.Z)("div",{target:"etoucxl0"})("margin-top:",(0,o.Z)(3),";")}}]);
//# sourceMappingURL=../sourcemaps/app_utils_performance_contexts_metricsCardinality_tsx-app_utils_performance_histogram_utils_t-fa896e.29cb59fa2d5856299153267a5433aff1.js.map
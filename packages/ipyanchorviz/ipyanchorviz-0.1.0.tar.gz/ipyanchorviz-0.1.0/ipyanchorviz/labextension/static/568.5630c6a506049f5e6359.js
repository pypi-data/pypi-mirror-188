(self.webpackChunkipyanchorviz=self.webpackChunkipyanchorviz||[]).push([[568,95],{94:(e,t,n)=>{let o=n(654),i=n(766);const a=n(431);let r=n(729),s=n(988);function c(e){return a.cloneDeep(e.model.get("anchors"))}function l(e,t){e.model.set("anchors",a.cloneDeep(t)),e.touch(),e.localAnchors=a.cloneDeep(t)}n(840),e.exports={create:function(e){let t,n,d=e.model.get("radius"),h=e.model.get("margin"),u=e.model.get("focusIndicatorActionDistance"),g=e.model.get("anchorSize");e.defaultAnchorColor="grey",e.focusIndicatorActionInRange=!1,e.focusIndicatorOverAnchor=!1,e.anchorDragging=!1,e.hoveringOverPoint=!1;let f=function(t){let n=e.localAnchors,o=0,i=0,a=e.model.get("radius")-e.model.get("ringInnerPadding"),s=e.model.get("autoNorm");function c(e){return void 0===e.visible||e.visible}for(let l of n)if(c(l)){if(l.id in t.weights){let n=t.weights[l.id],[s,c]=r.polarToRect(e,a,l.theta,!1);o+=s*n,i+=c*n}}else if(t.weights[l.id]>0){s=!0;break}if(s){o=0,i=0;let s=0;for(let e of n)c(e)&&e.id in t.weights&&(s+=t.weights[e.id]);if(s>0)for(let l of n)if(c(l)&&l.id in t.weights){let n=t.weights[l.id]/s,[c,d]=r.polarToRect(e,a,l.theta,!1);o+=c*n,i+=d*n}}let l=e.getNoise(e,t);return o+=l[0],i+=l[1],[o,i]},v=function(){let[n,i]=o.mouse(e.overlay.node()),a=r.getMouseRadius(e,n,i),s=Math.abs(a-d);e.focusIndicatorActionInRange=s<u,t.classed("ring-focus-indicator-action-possible",e.focusIndicatorActionInRange);let c=r.getMouseTheta(e,n,i),l=r.polarToRect(e,d,c,!0);t.attr("transform",`translate(${l[0]}, ${l[1]})`)};function p(){e.focusIndicatorOverAnchor||e.focusIndicatorActionInRange||e.hoveringOverPoint||e.lasso.items().classed("within-current-lasso-selection",!1).classed("lassoed-point",!1)}function m(){e.focusIndicatorOverAnchor||e.focusIndicatorActionInRange||e.hoveringOverPoint||(e.lasso.possibleItems().classed("within-current-lasso-selection",!0),e.lasso.notPossibleItems().classed("within-current-lasso-selection",!1))}function A(){if(e.focusIndicatorOverAnchor||e.focusIndicatorActionInRange||e.hoveringOverPoint)return;e.lasso.items().classed("within-current-lasso-selection",!1);let t=[];e.lasso.selectedItems().each((e=>{t=[...t,e.id]})),e.model.set("lassoedPointIDs",t),e.touch(),e.model.send({type:"lasso_change",pointIDs:t})}e.addVizAnchor=function(i){e.localAnchors.push(a.cloneDeep(i)),e.svg.append("circle").attr("id","anchor-"+i.id.toString()).classed("anchor",!0).attr("r",g).on("mouseover",(()=>t.classed("ring-focus-indicator-anchor-hover",!0))).on("mouseout",(()=>t.classed("ring-focus-indicator-anchor-hover",!1))).on("mousemove",(()=>e.overlay.node().dispatchEvent(new MouseEvent(o.event.type,o.event)))).on("click",(()=>{let t=e.model.get("selectedAnchorID");""!=t&&e.svg.select("#anchor-"+t).classed("anchor-selected",!1),t=i.id,e.svg.select("#anchor-"+t).classed("anchor-selected",!0),e.model.set("selectedAnchorID",t),e.touch()})).call(o.drag().on("start",(()=>{return o=i,anchorDragging=!0,n=o.theta,e.svg.select("#anchor-"+o.id.toString()).classed("anchor-dragging",!0),void t.classed("ring-focus-indicator-active",!0);var o})).on("drag",(()=>function(t){let n=o.mouse(e.overlay.node()),i=r.getMouseTheta(e,n[0],n[1]);t.theta=i,e.localAnchors[s.anchorIndexByID(t.id,e.localAnchors)].theta=i,e.updateAnchorDisplayPos(t),e.updateDataPointPositionsImmediate(),v()}(i))).on("end",(()=>function(o){anchorDragging=!1;let i=c(e);s.anchorByIndex(o.id,i).theta=o.theta,e.svg.select("#anchor-"+o.id.toString()).classed("anchor-dragging",!1),t.classed("ring-focus-indicator-active",!1),o.theta!==n&&(l(e,i),e.model.send({type:"anchor_drag",theta:o.theta,id:o.id}))}(i)))),e.svg.append("text").classed("anchor-label",!0).attr("id","anchor-text-"+i.id.toString()),e.updateVizAnchorAttrs(i),e.updateAnchorDisplayPos(i)},e.updateVizAnchorAttrs=function(t){let n=e.svg.select("#anchor-"+t.id.toString()),o=e.svg.select("#anchor-text-"+t.id.toString());void 0!==t.color?n.style("fill",t.color):n.style("fill",null),o.text(t.name)},e.updateAnchorDisplayPos=function(t){d=e.model.get("radius");let n=r.polarToRect(e,d,t.theta,!0),o=r.polarToRect(e,d+u,t.theta,!0),i=e.svg.select("#anchor-"+t.id.toString()),a=e.svg.select("#anchor-text-"+t.id.toString());i.attr("cx",n[0]).attr("cy",n[1]),a.attr("x",o[0]).attr("y",o[1]).attr("text-anchor",s.getTextAnchorFromTheta(t.theta))},e.updateDataPointPositionsImmediate=function(){d=e.model.get("radius"),h=e.model.get("margin"),e.svg.selectAll(".datapoint").attr("cx",(e=>f(e)[0]+d+h.left)).attr("cy",(e=>f(e)[1]+d+h.top))},e.getNoise=function(e,t){if(void 0===e.noise&&(e.noise={}),t.id in e.noise)return e.noise[t.id];let n=e.model.get("noiseMagnitude"),o=Math.random()*n-n/2,i=Math.random()*n-n/2;return e.noise[t.id]=[o,i],[o,i]},e.enterDatapoints=function(){let t=e.model.get("data"),n=e.model.get("radius"),a=e.model.get("margin"),r=e.model.get("pointSize"),s=e.svg.selectAll(".datapoint").data(t,(e=>e.id.toString()));s.enter().append("circle").classed("datapoint",!0).attr("cx",(function(){return n+a.left})).attr("cy",(function(){return n+a.top})).attr("r",r).attr("fill",(e=>void 0===e.color?"green":e.color)).classed("labeled-point",(e=>void 0!==e.labeled&&e.labeled)).on("mouseover",(t=>{e.model.set("selectedDataPointID",t.id.toString()),e.touch(),e.model.send({type:"point_hover",pointID:t.id})})).on("mousemove",(()=>e.overlay.node().dispatchEvent(new MouseEvent(o.event.type,o.event)))),s.exit().remove(),function(){let t=e.model.get("data"),n=e.svg.selectAll(".datapoint").data(t);e.lasso=i.lasso().closePathSelect(!0).closePathDistance(100).items(n).targetArea(e.svg).on("start",p).on("draw",m).on("end",A),e.svg.call(e.lasso)}()},e.animateDatapoints=function(){let t=e.model.get("radius"),n=e.model.get("margin"),o=e.model.get("data"),i=e.svg.selectAll(".datapoint").data(o,(e=>e.id.toString()));function a(e){return void 0===e.visible||e.visible}i.style("visibility","visible"),i.transition().duration(e.model.get("animationTime")).attr("cx",(e=>f(e)[0]+t+n.left)).attr("cy",(e=>f(e)[1]+t+n.top)).style("fill",(e=>e.color)).style("opacity",(e=>a(e)?1:0)).on("end",(()=>{this.svg.selectAll(".datapoint").style("visibility",(e=>a(e)?"visible":"hidden"))})),i.classed("labeled-point",(e=>void 0!==e.labeled&&e.labeled))},function(){e.localAnchors=[];let n=document.createElementNS("http://www.w3.org/2000/svg","svg");e.el.appendChild(n),e.el.setAttribute("class","jupyter-widget anchorviz"),e.width=2*d+h.left+h.right,e.height=2*d+h.top+h.bottom,e.svg=o.select(n),e.svg.attr("width",e.width).attr("height",e.height),e.ring=e.svg.append("circle").attr("class","ring").attr("r",d).attr("cx",d+h.left).attr("cy",d+h.top),t=e.svg.append("g").attr("class","ring-focus-indicator"),t.append("circle").attr("r",e.model.get("focusIndicatorSize")),e.overlay=e.svg.append("rect").attr("class","click-overlay").attr("width",e.width).attr("height",e.height).on("mousemove",v).on("click",(function(){!function(){if(e.focusIndicatorActionInRange){let[t,n]=o.mouse(e.overlay.node()),i=r.getMouseTheta(e,t,n),a=e.model.get("anchors"),c={id:(parseInt(s.maxAnchorID(a))+1).toString(),theta:i,name:"New Anchor"};anchors=[...a,c],l(e,anchors),e.model.send({type:"anchor_add",theta:i,newAnchor:c})}}()}));for(let t of c(e))e.addVizAnchor(t);e.enterDatapoints(),e.animateDatapoints()}()},updateAnchors:function(e){let t=e.model.previous("anchors"),n=c(e);for(let o of n)s.anchorInList(o,t)?(console.log("Updating "+o.id.toString()),e.updateVizAnchorAttrs(o),e.updateAnchorDisplayPos(o)):(console.log("Adding from update "+o.id.toString()),e.addVizAnchor(o));for(let o of t)s.anchorInList(o,n)||(console.log("Removing "+o.id.toString()),e.svg.select("#anchor-"+o.id.toString()).remove(),e.svg.select("#anchor-text-"+o.id.toString()).remove())},updateLassoedPoints:function(e){let t=e.model.get("lassoedPointIDs");e.svg.selectAll(".datapoint").classed("lassoed-point",(e=>t.includes(e.id)))},updateSelectedDataPointID:function(e){e.svg.selectAll(".datapoint").classed("selected-point",(t=>t.id===e.model.get("selectedDataPointID")))},updateSelectedAnchorID:function(e){e.svg.selectAll(".anchor").classed("anchor-selected",!1),e.svg.select("#anchor-"+e.model.get("selectedAnchorID").toString()).classed("anchor-selected",!0)},updateData:function(e){e.enterDatapoints(),e.animateDatapoints()}}},568:(e,t,n)=>{e.exports=n(367),e.exports.version=n(147).version},729:e=>{let t=function(e,t,n){let o=e.model.get("radius"),i=e.model.get("margin");return[t-=o+i.left,n-=o+i.top]};e.exports={polarToRect:function(e,t,n,o=!1){let i=e.model.get("radius"),a=e.model.get("margin"),r=t*Math.cos(n),s=t*Math.sin(n);return o&&(r+=i+a.left,s+=i+a.top),[r,s]},adjustMouseCoords:t,getMouseRadius:function(e,n,o){return[n,o]=t(e,n,o),Math.sqrt(n*n+o*o)},getMouseTheta:function(e,n,o){[n,o]=t(e,n,o);let i=Math.atan(o/n);return n<0&&(i+=Math.PI),i}}},988:e=>{let t=function(e,t){for(let n=0;n<t.length;n++)if(t[n].id===e)return n;return-1};e.exports={getTextAnchorFromTheta:function(e){return e>Math.PI/4&&e<3*Math.PI/4||e>5*Math.PI/4&&e<7*Math.PI/4?"middle":e<Math.PI/4||e>7*Math.PI/4?"start":e<5*Math.PI/4&&e>3*Math.PI/4?"end":"ERROR"},anchorInList:function(e,n){return-1!==t(e.id,n)},anchorByIndex:function(e,t){for(let n of t)if(n.id===e)return n;return null},maxAnchorID:function(e){if(0===e.length)return-1;let t=parseInt(e[0].id);for(let n of e)parseInt(n.id)>t&&(t=parseInt(n.id));return t},anchorIndexByID:t}},367:(e,t,n)=>{let o=n(672),i=n(431),a=n(94),r=o.DOMWidgetModel.extend({defaults:i.extend(o.DOMWidgetModel.prototype.defaults(),{_model_name:"AnchorVizModel",_view_name:"AnchorVizView",_model_module:"ipyanchorviz",_view_module:"ipyanchorviz",_model_module_version:"0.1.0",_view_module_version:"0.1.0",anchors:[],selectedAnchorID:"",data:[],selectedDataPointID:"",lassoedPointIDs:[],margin:{left:80,right:80,top:30,bottom:30},radius:275,ringInnerPadding:35,anchorTextOffset:20,pointSize:2,anchorSize:6,focusIndicatorSize:8.5,focusIndicatorActionDistance:20,autoNorm:!1,noiseMagnitude:15,animationTime:2e3})});var s=o.DOMWidgetView.extend({render:function(){a.create(this),this.model.on("change:anchors",this.anchorsChange,this),this.model.on("change:selectedAnchorID",this.selectedAnchorChange,this),this.model.on("change:data",this.dataChange,this),this.model.on("change:selectedDataPointID",this.selectedDataPointChange,this),this.model.on("change:lassoedPointIDs",this.lassoedPointsChange,this)},anchorsChange:function(){a.updateAnchors(this)},selectedAnchorChange:function(){a.updateSelectedAnchorID(this)},dataChange:function(){a.updateData(this)},selectedDataPointChange:function(){a.updateSelectedDataPointID(this)},lassoedPointsChange:function(){a.updateLassoedPoints(this)}});e.exports={AnchorVizModel:r,AnchorVizView:s}},338:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(645),i=n.n(o)()((function(e){return e[1]}));i.push([e.id,".anchorviz .ring {\n    stroke: var(--ringColor, grey);\n    fill: #222222;\n}\n\n.anchorviz .click-overlay {\n    fill: none;\n    pointer-events: all;\n}\n\n.anchorviz .ring-focus-indicator circle {\n    stroke: var(--focusStroke, red);\n    fill: none;\n}\n\n.anchorviz .ring-focus-indicator-action-possible circle {\n    stroke: var(--focusStrokeActionPossible, #44DDFF) !important;\n}\n\n.anchorviz .ring-focus-indicator-anchor-hover circle {\n    stroke: var(--focusStrokeAnchorHover, #FFDD44) !important;\n}\n\n.anchorviz .ring-focus-indicator-active circle {\n    stroke: var(--anchorDraggingColor, #99FFAA) !important;\n}\n\n.anchorviz .anchor {\n    pointer-events: all;\n    fill: var(--defaultAnchorColor, grey);\n}\n\n.anchorviz .anchor-selected {\n    fill: var(--selectedAnchorColor, #99AAFF) !important;\n}\n.anchorviz .anchor-dragging {\n    fill: var(--anchorDraggingColor, #99FFAA) !important;\n}\n\n.anchorviz .anchor-label {\n    fill: var(--textColor, white);\n    font-size: 12px;\n    font-family: arial;\n}\n\n.anchorviz .labeled-point {\n    stroke: var(--labeledPointColor, #FFFFFF) !important;\n    stroke-width: 1px;\n}\n.anchorviz .lassoed-point {\n    stroke: var(--lassoedPointColor, #22AA22) !important;\n    stroke-width: 1px;\n}\n.anchorviz .selected-point {\n    stroke: var(--selectedPointColor, #FF0000) !important;\n}\n.anchorviz .within-current-lasso-selection {\n    stroke: var(--lassoingColor, green) !important;\n    stroke-width: 2px;\n}\n\n.anchorviz .lasso path {\n    stroke: rgb(80, 80, 80);\n    stroke-width: 2px;\n}\n.anchorviz .lasso .drawn {\n    fill-opacity: 0.05;\n}\n.anchorivz .lasso .loop_close {\n    fill: none;\n    stroke-dasharray: 4, 4;\n}\n",""]);const a=i},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,o){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(o)for(var a=0;a<this.length;a++){var r=this[a][0];null!=r&&(i[r]=!0)}for(var s=0;s<e.length;s++){var c=[].concat(e[s]);o&&i[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},840:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var o=n(379),i=n.n(o),a=n(338);i()(a.Z,{insert:"head",singleton:!1});const r=a.Z.locals||{}},379:(e,t,n)=>{"use strict";var o,i=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),a=[];function r(e){for(var t=-1,n=0;n<a.length;n++)if(a[n].identifier===e){t=n;break}return t}function s(e,t){for(var n={},o=[],i=0;i<e.length;i++){var s=e[i],c=t.base?s[0]+t.base:s[0],l=n[c]||0,d="".concat(c," ").concat(l);n[c]=l+1;var h=r(d),u={css:s[1],media:s[2],sourceMap:s[3]};-1!==h?(a[h].references++,a[h].updater(u)):a.push({identifier:d,updater:v(u,t),references:1}),o.push(d)}return o}function c(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var a=n.nc;a&&(o.nonce=a)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var r=i(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var l,d=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function h(e,t,n,o){var i=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=d(t,i);else{var a=document.createTextNode(i),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(a,r[t]):e.appendChild(a)}}function u(e,t,n){var o=n.css,i=n.media,a=n.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var g=null,f=0;function v(e,t){var n,o,i;if(t.singleton){var a=f++;n=g||(g=c(t)),o=h.bind(null,n,a,!1),i=h.bind(null,n,a,!0)}else n=c(t),o=u.bind(null,n,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o));var n=s(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<n.length;o++){var i=r(n[o]);a[i].references--}for(var c=s(e,t),l=0;l<n.length;l++){var d=r(n[l]);0===a[d].references&&(a[d].updater(),a.splice(d,1))}n=c}}}},147:e=>{"use strict";e.exports={version:"0.1.0"}}}]);